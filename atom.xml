<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Hans Chan's Blog]]></title>
  
  <link href="/blog/atom.xml" rel="self"/>
  <link href="http://csbun.github.io/blog/"/>
  <updated>2015-10-27T10:08:48.000Z</updated>
  <id>http://csbun.github.io/blog/</id>
  
  <author>
    <name><![CDATA[Hans Chan]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[Using Contenteditable]]></title>
    <link href="http://csbun.github.io/blog/2015/09/using-contenteditable/"/>
    <id>http://csbun.github.io/blog/2015/09/using-contenteditable/</id>
    <published>2015-09-21T07:14:03.000Z</published>
    <updated>2015-10-27T10:08:48.000Z</updated>
    <content type="html"><![CDATA[<p>&#x6700;&#x8FD1;&#x624D;&#x53D1;&#x73B0;&#x7684;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x554A;&#xFF0C;&#x4F46;&#x662F;&#x67E5;&#x4E86;&#x4E00;&#x4E0B; <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/contentEditable" target="_blank" rel="external">MDN</a>&#xFF0C;&#x8C8C;&#x4F3C;&#x5DF2;&#x7ECF;&#x5F88;&#x666E;&#x53CA;&#x4E86;&#xFF0C;&#x8FDE; IE6 &#x90FD;&#x652F;&#x6301;&#xFF08;&#x867D;&#x7136;&#x6709;&#x4E00;&#x5927;&#x5806;&#x7684; bug&#xFF09;&#x3002;</p>
<a id="more"></a>
<h2 id="&#x7528;&#x6CD5;">&#x7528;&#x6CD5;</h2><h3 id="javascript">JavaScript</h3><p>&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x968F;&#x4FBF;&#x5728;&#x9875;&#x9762;&#x4E0A;&#x641E;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x7136;&#x540E;&#x8BBE;&#x7F6E;&#x4E3A;&#x53EF;&#x7F16;&#x8F91;&#xFF1A;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">p</span> <span class="attribute">id</span>=<span class="value">&quot;editable&quot;</span>&gt;</span>I&apos;m editable!<span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(<span class="string">&apos;editable&apos;</span>);</span><br><span class="line">el.contentEditable = <span class="string">&apos;true&apos;</span>;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D; <code>contentEditable</code> &#x7684;&#x503C;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x6709;&#x4E09;&#x79CD;&#x9009;&#x62E9;&#xFF1A;</p>
<ul>
<li><code>&apos;true&apos;</code> &#x53EF;&#x7F16;&#x8F91;&#x7684;</li>
<li><code>&apos;false&apos;</code> &#x4E0D;&#x53EF;&#x7F16;&#x8F91;&#x7684;</li>
<li><code>&apos;inherit&apos;</code> &#x7EE7;&#x627F;&#x7236;&#x5143;&#x7D20;&#x7684;&#x72B6;&#x6001;</li>
</ul>
<h3 id="attribute">Attribute</h3><p>&#x8FD9;&#x4E2A;&#x662F; HTML5 &#x4E2D;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5168;&#x5C40;&#x5C5E;&#x6027;&#xFF0C;<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/contenteditable" target="_blank" rel="external">MDN</a>&#xFF1A;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">p</span> <span class="attribute">contenteditable</span>=<span class="value">&quot;true&quot;</span>&gt;</span>I&apos;m editable!<span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="&#x7528;&#x9014;">&#x7528;&#x9014;</h2><p>&#x5F53;&#x6211;&#x770B;&#x5230;&#x8FD9;&#x8D27;&#xFF0C;&#x6211;&#x7B2C;&#x4E00;&#x53CD;&#x5E94;&#x5C31;&#x662F;&#x62FF;&#x6765;&#x505A;&#x201C;&#x81EA;&#x5B9A;&#x4E49;&#x9875;&#x9762;&#x201D;&#xFF0C;&#x8FD0;&#x8425;&#x4EBA;&#x5458;&#x5E94;&#x8BE5;&#x4F1A;&#x89C9;&#x5F97;&#x5F88;&#x5B9E;&#x5728;&#xFF0C;&#x5927;&#x81F4;&#x539F;&#x7406;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x8FD0;&#x8425;&#x7AEF;&#x4ECE;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x670D;&#x52A1;&#x8F93;&#x51FA;&#x9875;&#x9762;</li>
<li>&#x9875;&#x9762;&#x4E2D;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x90E8;&#x5206;&#x6807;&#x8BC6;&#x4E3A; contenteditable</li>
<li>&#x8FD0;&#x8425;&#x4EBA;&#x5458;&#x4FEE;&#x6539;&#x8BE5;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x540E;&#x70B9;&#x51FB;&#x4FDD;&#x5B58;</li>
<li>&#x83B7;&#x53D6; contenteditable &#x5143;&#x7D20;&#x7684; innerHTML&#xFF0C;&#x56DE;&#x4F20;&#x81F3;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x670D;&#x52A1;</li>
<li>&#x7EC8;&#x7AEF;&#x7528;&#x6237;&#x4F7F;&#x7528;&#x66F4;&#x65B0;&#x540E;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x670D;&#x52A1;&#x7684;&#x6570;&#x636E;&#x6E32;&#x67D3;&#x9875;&#x9762;</li>
</ul>
<p>&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x6211;&#x7528; localStorage &#x7528;&#x4F5C;&#x865A;&#x62DF;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x670D;&#x52A1;&#xFF1A;</p>
<p></p><p data-height="750" data-theme-id="18973" data-slug-hash="avNpZw" data-default-tab="result" data-user="csbun" class="codepen">See the Pen <a href="http://codepen.io/csbun/pen/avNpZw/" target="_blank" rel="external">avNpZw</a> by csbun (<a href="http://codepen.io/csbun" target="_blank" rel="external">@csbun</a>) on <a href="http://codepen.io" target="_blank" rel="external">CodePen</a>.</p><p></p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<h2 id="&#x5B9E;&#x4F8B;">&#x5B9E;&#x4F8B;</h2><p>&#x8FD9;&#x91CC;&#x6709;&#x66F4;&#x591A;&#x6709;&#x8DA3;&#x7684;&#x5B9E;&#x4F8B;&#xFF1A;</p>
<ul>
<li><a href="http://substance.io/" target="_blank" rel="external">substance</a></li>
<li><a href="http://getcontenttools.com/demo" target="_blank" rel="external">ContentTools</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>最近才发现的这个东西啊，但是查了一下 <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/contentEditable">MDN</a>，貌似已经很普及了，连 IE6 都支持（虽然有一大堆的 bug）。</p>]]>
    
    </summary>
    
      <category term="contentEditable" scheme="http://csbun.github.io/blog/tags/contentEditable/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用 iron-node 进行 Node Debug]]></title>
    <link href="http://csbun.github.io/blog/2015/09/using-iron-node/"/>
    <id>http://csbun.github.io/blog/2015/09/using-iron-node/</id>
    <published>2015-09-15T07:05:33.000Z</published>
    <updated>2015-10-27T10:08:52.000Z</updated>
    <content type="html"><![CDATA[<p>&#x7B80;&#x5355;&#x6298;&#x817E;&#x4E86;&#x4E00;&#x4E0B; <a href="http://s-a.github.io/iron-node/" target="_blank" rel="external">iron-node</a>&#xFF0C;&#x8C03;&#x8BD5; Node &#x518D;&#x4E5F;&#x4E0D;&#x7528;&#x82E6;&#x903C;&#x5730; console.log &#x4E86;&#x3002;</p>
<a id="more"></a>
<h2 id="&#x5B89;&#x88C5;">&#x5B89;&#x88C5;</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g iron-<span class="keyword">node</span><span class="identifier"></span><span class="title"></span></span><br></pre></td></tr></table></figure>
<h2 id="&#x542F;&#x52A8;">&#x542F;&#x52A8;</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iron-<span class="keyword">node</span><span class="identifier"> </span><span class="title">path</span>/to/file.js</span><br></pre></td></tr></table></figure>
<p>&#x8FD0;&#x884C;&#x4E0A;&#x8FF0;&#x547D;&#x4EE4;&#x542F;&#x52A8;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x6253;&#x5F00;&#x4E00;&#x4E2A; Chrome Developer Tools &#x754C;&#x9762;&#xFF0C;&#x8FD0;&#x884C; <code>node path/to/file.js</code> &#x7684;&#x8F93;&#x51FA;&#x4F1A;&#x5728; Console &#x6807;&#x7B7E;&#x9875;&#x4E2D;&#x8F93;&#x51FA;&#x3002;</p>
<h2 id="&#x65AD;&#x70B9;">&#x65AD;&#x70B9;</h2><p>&#x6700;&#x7B80;&#x5355;&#x7684;&#x65AD;&#x70B9;&#x65B9;&#x5F0F;&#x5F53;&#x7136;&#x662F;&#x5728;&#x6E90;&#x7801;&#x4E2D;&#x6DFB;&#x52A0; <code>debugger;</code>&#xFF0C;&#x5982;&#x8FD9;&#x6BB5;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inc = <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>{</span><br><span class="line">    <span class="keyword">debugger</span>; <span class="comment">// break point here</span></span><br><span class="line">    <span class="keyword">return</span> ++num;</span><br><span class="line">};</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&apos;inc(3) = &apos;</span> + inc(<span class="number">3</span>));</span><br></pre></td></tr></table></figure>
<p>&#x540C;&#x65F6;&#xFF0C;&#x4E5F;&#x5728; Sources &#x6807;&#x7B7E;&#x9875; &#x7684; (no domain) &#x5206;&#x7C7B;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD0;&#x884C;&#x7684;&#x6E90;&#x7801;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x50CF;&#x5E73;&#x65F6;&#x8C03;&#x8BD5;&#x9875;&#x9762;&#x4E00;&#x6837;&#x70B9;&#x51FB;&#x884C;&#x53F7;&#x6DFB;&#x52A0;&#x5220;&#x9664;&#x65AD;&#x70B9;&#x3002;</p>
<blockquote>
<p>&#x5C1D;&#x8BD5;&#x4E86;&#x4E00;&#x4E0B;&#x4F7F;&#x7528; Map Workspace &#x65E0;&#x6548;&#xFF0C;&#x6CA1;&#x6709;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#x7ED3;&#x679C;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x6BD4;&#x8F83;&#x75DB;&#x82E6;&#x3002;</p>
</blockquote>
<h2 id="&#x6587;&#x4EF6;&#x66F4;&#x65B0;">&#x6587;&#x4EF6;&#x66F4;&#x65B0;</h2><p>&#x5F53;&#x6587;&#x4EF6;&#x66F4;&#x65B0;&#x65F6;&#xFF0C;&#x53EA;&#x8981;&#x5728; Chrome Developer Tools &#x754C;&#x9762;&#x6309;&#x5FEB;&#x6377;&#x952E; <code>Command+R</code> &#x5237;&#x65B0;&#x5373;&#x53EF;&#xFF0C;&#x800C;&#x4E14;&#x5237;&#x65B0;&#x540E;&#x77ED;&#x70B9;&#x4ECD;&#x7136;&#x5B58;&#x5728;&#x3002;</p>
<blockquote>
<p>&#x7126;&#x70B9;&#x5FC5;&#x987B;&#x5728; DevTool &#x4E0A;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x9884;&#x89C8;&#x754C;&#x9762;&#xFF08;&#x663E;&#x793A; DEBUG.md &#x6216; README.md &#x7684; index.html&#xFF09;</p>
</blockquote>
<h2 id="&#x4F7F;&#x7528;-es6">&#x4F7F;&#x7528; ES6</h2><p>&#x867D;&#x7136; Node &#x5DF2;&#x7ECF;&#x5347;&#x7EA7;&#x7684;&#x5230; v4.0.0&#xFF0C;&#x652F;&#x6301; ES6 &#x4E86;&#xFF0C;&#x4F46;&#x662F; iron-node &#x597D;&#x50CF;&#x8FD8;&#x6CA1;&#x5B8C;&#x5168;&#x8DDF;&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x5F00;&#x542F;&#x4E00;&#x4E9B; <a href="https://github.com/thlorenz/v8-flags/blob/master/flags-0.11.md" target="_blank" rel="external">v8 flags</a>&#x3002;&#x5165;&#x53E3;&#x6587;&#x4EF6;&#x6240;&#x5728;&#x76EE;&#x5F55;&#x521B;&#x5EFA;&#x6587;&#x4EF6; <code>.iron-node.js.</code>&#xFF0C;&#x5982;&#x5728;&#x6211;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x662F;&#x5F00;&#x542F;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">    v8: {</span><br><span class="line">        flags : [</span><br><span class="line">            <span class="string">&apos;--harmony-arrow-functions&apos;</span></span><br><span class="line">        ]</span><br><span class="line">    },</span><br><span class="line">    app: {}</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>&#x8BE6;&#x60C5;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x53C2;&#x8003; <a href="https://github.com/s-a/iron-node/blob/master/.iron-node.js" target="_blank" rel="external">&#x5B98;&#x65B9;&#x4F8B;&#x5B50;</a>&#x3002;&#x5982;&#x679C;&#x60F3;&#x8BBE;&#x7F6E;&#x4E3A;&#x5168;&#x5C40;&#x914D;&#x7F6E;&#xFF0C;&#x5C31;&#x770B; <a href="https://github.com/s-a/iron-node/blob/master/docs/CONFIGURATION.md" target="_blank" rel="external">&#x8FD9;&#x91CC;</a>&#x3002;</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>简单折腾了一下 <a href="http://s-a.github.io/iron-node/">iron-node</a>，调试 Node 再也不用苦逼地 console.log 了。</p>]]>
    
    </summary>
    
      <category term="Node" scheme="http://csbun.github.io/blog/tags/Node/"/>
    
      <category term="debug" scheme="http://csbun.github.io/blog/tags/debug/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Google 换新 Logo 了]]></title>
    <link href="http://csbun.github.io/blog/2015/09/google-new-logo/"/>
    <id>http://csbun.github.io/blog/2015/09/google-new-logo/</id>
    <published>2015-09-02T02:04:36.000Z</published>
    <updated>2015-10-28T01:31:29.000Z</updated>
    <content type="html"><![CDATA[<p>&#x4E3A;&#x4E86;&#x5E86;&#x795D;&#x660E;&#x5929; <strong>&#x4E2D;&#x56FD;&#x4EBA;&#x6C11;&#x6297;&#x65E5;&#x6218;&#x4E89;&#x80DC;&#x5229; 70 &#x5468;&#x5E74;</strong>&#xFF0C;Google &#x51B3;&#x5B9A;&#x5728;&#x4ECA;&#x5929;&#x6362;&#x4E2A;&#x65B0; Logo</p>
<img src="/blog/2015/09/google-new-logo/googles-new-logo.gif" alt="doodle" title="doodle">
<a id="more"></a>
<p>&#x4E5F;&#x4E0D;&#x77E5;&#x9053;&#x8FD9;&#x4E9B;&#x7A0B;&#x5E8F;&#x5458;&#x5728;&#x5174;&#x594B;&#x4EC0;&#x4E48;&#x2026;</p>
<img src="/blog/2015/09/google-new-logo/googles-new-logo-2.gif" alt="doodle" title="doodle">
<p>&#x5176;&#x5B9E;&#xFF0C;&#x770B;&#x5230;&#x90A3;&#x51E0;&#x4E2A;&#x70B9;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x7B2C;&#x4E00;&#x53CD;&#x5E94;&#x662F; <a href="http://www.agoda.com/" target="_blank" rel="external">agoda</a>&#x2026;</p>
<iframe width="640" height="360" src="https://www.youtube.com/embed/olFEpeMwgHk" frameborder="0" allowfullscreen></iframe>

<blockquote>
<p>&#x56FE;&#x7247;&#x548C;&#x89C6;&#x9891;&#x90FD;&#x6765;&#x81EA;&#x4E92;&#x8054;&#x7F51;</p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<p>为了庆祝明天 <strong>中国人民抗日战争胜利 70 周年</strong>，Google 决定在今天换个新 Logo</p>
<img src="/blog/2015/09/google-new-logo/googles-new-logo.gif" alt="doodle" title="doodle">]]>
    
    </summary>
    
      <category term="google" scheme="http://csbun.github.io/blog/tags/google/"/>
    
      <category term="logo" scheme="http://csbun.github.io/blog/tags/logo/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[requestAnimationFrame 和 requestIdleCallback]]></title>
    <link href="http://csbun.github.io/blog/2015/09/raf-and-ric/"/>
    <id>http://csbun.github.io/blog/2015/09/raf-and-ric/</id>
    <published>2015-09-01T13:06:01.000Z</published>
    <updated>2015-10-27T10:11:20.000Z</updated>
    <content type="html"><![CDATA[<h2 id="requestanimationframe">requestAnimationFrame</h2><p><code>requestAnimationFrame</code> &#x5E94;&#x8BE5;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x9C9C;&#x8D27;&#x4E86;&#xFF0C;<a href="https://angularjs.org/" target="_blank" rel="external">Angular</a> &#x5C31;&#x6709; <a href="https://github.com/angular/angular.js/blob/master/src/ng/raf.js" target="_blank" rel="external">$$rAF</a>&#xFF0C;<a href="http://cubiq.org/iscroll-5" target="_blank" rel="external">iScroll</a> &#x4E5F;&#x7528;&#x4ED6;&#x6765;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x529F;&#x80FD;&#xFF0C;&#x5F88;&#x4E45;&#x4E4B;&#x524D;&#x4E5F;&#x5728;&#x67D0;&#x4E9B;&#x535A;&#x5BA2;&#x4E2D;&#x770B;&#x5230;&#x67D0;&#x4E9B; MVVM &#x6846;&#x67B6;&#x7684; <code>nextTick</code> &#x662F;&#x7528; <code>requestAnimationFrame</code> &#x5B9E;&#x73B0;&#x7684;&#xFF08;<a href="http://rubylouvre.github.io/mvvm/" target="_blank" rel="external">Avalon</a> &#x8FD8;&#x662F; <a href="http://vuejs.org/" target="_blank" rel="external">Vue</a> &#x4E0D;&#x8BB0;&#x5F97;&#x4E86;&#xFF09;&#x3002;</p>
<a id="more"></a>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" target="_blank" rel="external">MDN</a> &#x4E0A;&#x662F;&#x8FD9;&#x4E48;&#x4ECB;&#x7ECD;&#x7684;&#xFF1A;</p>
<blockquote>
<p>The window.requestAnimationFrame() method tells the browser that you wish to perform an animation and requests that the browser call a specified function to update an animation before the next repaint.</p>
</blockquote>
<p>&#x975E;&#x5E38;&#x8BE6;&#x7EC6;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5728;&#x4E0B;&#x6B21; repaint &#x4E4B;&#x524D;&#x8D76;&#x7D27;&#x628A; callback &#x7684;&#x5185;&#x5BB9;&#x6267;&#x884C;&#x4E00;&#x904D;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x505A;&#x4E00;&#x4E2A;&#x8FDE;&#x7EED;&#x52A8;&#x753B;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5728; callback &#x91CC;&#x9762;&#x518D;&#x8C03;&#x7528;&#x4E00;&#x6B21; <code>requestAnimationFrame</code>&#xFF0C;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animationCallback</span>(<span class="params"></span>) </span>{</span><br><span class="line">    doSomeAnimation();</span><br><span class="line">    <span class="keyword">if</span> (!animationNotEnd) {</span><br><span class="line">        requestAnimationFrame(animationCallback);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">requestAnimationFrame(animationCallback);</span><br></pre></td></tr></table></figure>
<p>&#x901A;&#x5E38;&#x6211;&#x7684;&#x663E;&#x793A;&#x5668;&#x90FD;&#x662F; 60Hz &#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5237;&#x65B0;&#x9891;&#x7387;&#x4E5F;&#x5C31;&#x662F;&#x6BCF;&#x79D2; 60 &#x6B21;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x6BCF; 16.7 &#x6BEB;&#x79D2;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x4E0A;&#x9762;&#x7684; <code>animationCallback</code>&#x3002;&#x8FD9;&#x4E2A;&#x4E0D;&#x7981;&#x7136;&#x4EBA;&#x60F3;&#x8D77;&#x4E86; <code>setTimeout</code>&#xFF0C;&#x7279;&#x522B;&#x662F;&#x6211;&#x4EEC;&#x5728;&#x5199; canvas &#x7684;&#x65F6;&#x5019;&#x4E5F;&#x7ECF;&#x5E38;&#x4F1A;&#x6709;&#x7C7B;&#x4F3C;&#x7684;&#x7528;&#x6CD5;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animationCallback</span>(<span class="params"></span>) </span>{</span><br><span class="line">    doSomeAnimation();</span><br><span class="line">    <span class="keyword">if</span> (!animationNotEnd) {</span><br><span class="line">        setTimeout(animationCallback, <span class="number">16</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">animationCallback();</span><br></pre></td></tr></table></figure>
<p>&#x7B80;&#x76F4;&#x5C31;&#x662F;&#x4E00;&#x6BDB;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x662F; <code>setTimeout</code> &#x662F;&#x4E0D;&#x53EF;&#x9884;&#x6D4B;&#x7684;&#xFF0C;&#x5F88;&#x4E0D;&#x9760;&#x8C31;&#x54C7;&#xFF0C;&#x5173;&#x4E8E;&#x8FD9;&#x70B9;&#x53EF;&#x4EE5;&#x9605;&#x8BFB;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0; <a href="http://blog.getify.com/on-the-nature-of-timers/" target="_blank" rel="external">On the nature of timers</a>&#x3002;&#x53C8;&#x7531;&#x4E8E;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x6709;&#x4E86;&#x8FD9;&#x4E2A; <a href="https://gist.github.com/paulirish/1579671" target="_blank" rel="external">polyfill</a>&#x3002;</p>
<h2 id="requestidlecallback">requestIdleCallback</h2><p>&#x8FD9;&#x8D27;&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#x9B3C;&#xFF1F;&#x7F51;&#x4E0A;&#x7684;&#x8D44;&#x6E90;&#x975E;&#x5E38;&#x5C11;&#xFF0C;&#x80FD;&#x627E;&#x5230;&#x7684;&#x53EA;&#x6709;&#x8FD9;&#x7BC7; <a href="https://developers.google.com/web/updates/2015/08/27/using-requestidlecallback" target="_blank" rel="external">Using requestIdleCallback</a>&#xFF0C;&#x800C;&#x672C;&#x6587;&#x4E0B;&#x5217;&#x5185;&#x5BB9;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x90FD;&#x662F;&#x53C2;(chao)&#x8003;(xi)&#x4E0A;&#x9762;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x3002;</p>
<p>&#x4ECE;&#x540D;&#x5B57;&#x4E0A;&#x770B;&#xFF0C;<code>requestIdleCallback</code> &#x5E94;&#x8BE5;&#x662F; <strong>&#x8BF7;&#x6C42;</strong>(request) <strong>&#x7A7A;&#x95F2;</strong>(Idle) &#x7684; <strong>&#x56DE;&#x8C03;</strong>(Callback)&#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x5C31;&#x662F;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x7A7A;&#x95F2;&#x7684;&#x65F6;&#x5019;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x3002;<br>&#x6240;&#x8C13;&#x7684;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x8981;&#x56DE;&#x5230;&#x521A;&#x521A;&#x7684;&#x8BF4;&#x5230;&#x5237;&#x65B0;&#x9891;&#x7387;&#x4E2D;&#x6765;&#xFF0C;&#x5F53;&#x6D4F;&#x89C8;&#x5668;&#x5728;&#x8FD9;&#x4E2A; 16.7ms &#x7684;&#x533A;&#x95F4;&#x4E2D;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x8BA1;&#x7B97;&#x3001;&#x91CD;&#x7ED8;&#x7B49;&#x5DE5;&#x4F5C;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x9700;&#x8981;&#x7528;&#x5C3D;&#x8FD9;&#x5168;&#x90E8;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x800C;&#x5269;&#x4E0B;&#x7684;&#x65F6;&#x95F4;&#x5C31;&#x662F;&#x201C;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#x201D;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x6237;&#x5E76;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x4E5F;&#x662F;&#x6709;&#x4E00;&#x5927;&#x5806;&#x7684;&#x201C;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#x201D;&#x7684;&#xFF0C;&#x8FD9;&#x5C31;&#x6CA1;&#x6709;&#x5237;&#x65B0;&#x9891;&#x7387;&#x4EC0;&#x4E48;&#x4E8B;&#x4E86;&#x3002;<br>&#x6709;&#x4E86;&#x8FD9;&#x4E9B;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x4E00;&#x4E9B; <strong>&#x4E0D;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x5DE5;&#x4F5C;</strong>&#xFF0C;&#x5982;&#x8BB0;&#x5F55;&#x7EDF;&#x8BA1;&#x65E5;&#x5FD7;&#x7B49;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x597D;&#x5904;&#x662F;&#x8FD9;&#x4E9B;&#x6240;&#x8C13;&#x7684; <strong>&#x4E0D;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x5DE5;&#x4F5C;</strong> &#x5C31;&#x4E0D;&#x4F1A;&#x548C;&#x7528;&#x6237;&#x64CD;&#x4F5C;&#x51B2;&#x7A81;&#xFF08;&#x4F8B;&#x5982;&#x70B9;&#x51FB;&#x9700;&#x8981;&#x52A8;&#x753B;&#x4E14;&#x8BB0;&#x5F55;&#x65E5;&#x5FD7;&#xFF09;&#xFF0C;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>
<blockquote>
<p>requestIdleCallback &#x73B0;&#x5728;&#x53EA;&#x662F;&#x8349;&#x6848;&#xFF0C;&#x4E0B;&#x9762;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x4EE3;&#x7801;&#x662F;&#x5728; Chrome Canary(47.0.2499.0) &#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x3002;</p>
</blockquote>
<h3 id="&#x4F7F;&#x7528;-requestidlecallback">&#x4F7F;&#x7528; requestIdleCallback</h3><p><code>requestIdleCallback</code> &#x63A5;&#x6536; 2 &#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x4E00;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x548C;&#x4E00;&#x4E2A;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myNonEssentialWork = deadline =&gt; {</span><br><span class="line">    <span class="built_in">console</span>.log(deadline.timeRemaining());</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">};</span><br><span class="line"><span class="keyword">var</span> timeout = <span class="number">2000</span>;</span><br><span class="line">requestIdleCallback(myNonEssentialWork, timeout);</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x5F53;&#x201C;&#x7A7A;&#x95F2;&#x201D;&#x65F6;&#x4F1A;&#x8C03;&#x7528; myNonEssentialWork &#x51FD;&#x6570;</li>
<li>&#x5982;&#x679C;&#x4E00;&#x76F4;&#x201C;&#x4E0D;&#x7A7A;&#x95F2;&#x201D;&#xFF0C;&#x8D85;&#x8FC7; timeout &#x65F6;&#x957F;&#x4E5F;&#x4F1A;&#x6267;&#x884C; myNonEssentialWork</li>
<li>myNonEssentialWork &#x63A5;&#x6536;&#x4E00;&#x4E2A; IdleCallbackDeadline &#x5BF9;&#x8C61;<ul>
<li>deadline.timeRemaining() &#x5F53;&#x524D;&#x7684;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#x8FD8;&#x5269;&#x591A;&#x5C11;</li>
<li>deadline.didTimeout &#x662F;&#x5426;&#x56E0;&#x4E3A;&#x8D85;&#x65F6;&#x5F3A;&#x5236;&#x6267;&#x884C;</li>
</ul>
</li>
</ul>
<h3 id="&#x4F7F;&#x7528;-requestidlecallback-&#x66F4;&#x65B0;-dom">&#x4F7F;&#x7528; requestIdleCallback &#x66F4;&#x65B0; DOM</h3><p>&#x5F53;&#x6211;&#x4EEC;&#x6709;&#x7C7B;&#x4F3C; &#x201C;&#x56FE;&#x7247;&#x61D2;&#x52A0;&#x8F7D;&#x201D; &#x6216;&#x8005; &#x201C;&#x6EDA;&#x52A8;&#x52A0;&#x8F7D;&#x66F4;&#x591A;&#x201D; &#x8FD9;&#x4E00;&#x7C7B;&#x9700;&#x6C42;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x7528; <code>rIC</code> &#x548C; <code>rAF</code> &#x7EC4;&#x5408;&#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x6765;&#x5B8C;&#x6210;&#xFF1A;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x5728;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#x5C06;&#x9700;&#x8981;&#x7684;&#x6587;&#x6863;&#x7247;&#x6BB5;&#x521B;&#x5EFA;&#x597D;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> documentFragment;</span><br><span class="line"><span class="keyword">let</span> myNonEssentialWork = deadline =&gt; {</span><br><span class="line">    <span class="keyword">if</span> (!documentFragment) {</span><br><span class="line">        documentFragment = <span class="built_in">document</span>.createDocumentFragment();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x8FD9;&#x8981;&#x6709;&#x65F6;&#x95F4;&#x4E14;&#x8FD8;&#x6709;&#x6D3B;&#xFF0C;&#x5C31;&#x5E72;</span></span><br><span class="line">    <span class="keyword">while</span> (deadline.timeRemaining() &gt; <span class="number">0</span> &amp;&amp; elementsToAdd.length &gt; <span class="number">0</span>) {</span><br><span class="line">        <span class="comment">// &#x521B;&#x5EFA;&#x4EE3;&#x7801;&#x7247;&#x6BB5;</span></span><br><span class="line">        <span class="keyword">let</span> elToAdd = elementsToAdd.pop();</span><br><span class="line">        <span class="keyword">let</span> el = <span class="built_in">document</span>.createElement(elToAdd.tag);</span><br><span class="line">        el.textContent = elToAdd.content;</span><br><span class="line">        documentFragment.appendChild(el);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// &#x4E0D;&#x8981;&#x7740;&#x6025;&#x63D2;&#x5165; body&#xFF0C;&#x4EA4;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A; rAF</span></span><br><span class="line">        ++countNonEssentialWork;</span><br><span class="line">        scheduleVisualUpdateIfNeeded();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// &#x5982;&#x679C;&#x8FD8;&#x6709;&#x4EFB;&#x52A1;&#xFF0C;&#x5C31;&#x4E0B;&#x4E2A; &#x7A7A;&#x95F2;&#x65F6;&#x95F4; &#x518D;&#x5DE5;&#x4F5C;</span></span><br><span class="line">    <span class="keyword">if</span> (elementsToAdd.length &gt; <span class="number">0</span>) {</span><br><span class="line">        requestIdleCallback(myNonEssentialWork, timeout);</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>&#x901A;&#x8FC7; rAF &#x5C06;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x63D2;&#x5165; body &#x4E2D;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isVisualUpdateScheduled = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">let</span> appendDocumentFragment = () =&gt; {</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(documentFragment);</span><br><span class="line">    documentFragment = <span class="literal">null</span>;</span><br><span class="line">    isVisualUpdateScheduled = <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> scheduleVisualUpdateIfNeeded = () =&gt; {</span><br><span class="line">    <span class="keyword">if</span> (!isVisualUpdateScheduled) {</span><br><span class="line">        isVisualUpdateScheduled = <span class="literal">true</span>;</span><br><span class="line">        requestAnimationFrame(appendDocumentFragment);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x6765;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x4EE3;&#x7801;&#x770B;&#x770B;&#x5427;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> elementsToAdd = [];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">num</span>) </span>{</span><br><span class="line"><span class="pi">    &apos;use strict&apos;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; num; i++) {</span><br><span class="line">        elementsToAdd.push({</span><br><span class="line">            tag: <span class="string">&apos;p&apos;</span>,</span><br><span class="line">            content: <span class="built_in">Math</span>.random()</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">    start();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>{</span><br><span class="line"><span class="pi">    &apos;use strict&apos;</span>;</span><br><span class="line">    <span class="keyword">let</span> documentFragment;</span><br><span class="line">    <span class="keyword">let</span> isVisualUpdateScheduled = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">const</span> timeout = <span class="number">2000</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// &#x8BB0;&#x5F55; appendDocumentFragment &#x8FD0;&#x884C;&#x4E86;&#x591A;&#x5C11;&#x6B21;</span></span><br><span class="line">    <span class="keyword">let</span> countAppendDocument = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// &#x8BB0;&#x5F55; myNonEssentialWork &#x7684; while &#x8FD0;&#x884C;&#x4E86;&#x591A;&#x5C11;&#x6B21;</span></span><br><span class="line">    <span class="keyword">let</span> countNonEssentialWork = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> appendDocumentFragment = () =&gt; {</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&apos;countAppendDocument:&apos;</span>, ++countAppendDocument);</span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(documentFragment);</span><br><span class="line">        documentFragment = <span class="literal">null</span>;</span><br><span class="line">        isVisualUpdateScheduled = <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> scheduleVisualUpdateIfNeeded = () =&gt; {</span><br><span class="line">        <span class="keyword">if</span> (!isVisualUpdateScheduled) {</span><br><span class="line">            isVisualUpdateScheduled = <span class="literal">true</span>;</span><br><span class="line">            requestAnimationFrame(appendDocumentFragment);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> myNonEssentialWork = deadline =&gt; {</span><br><span class="line">        <span class="keyword">if</span> (!documentFragment) {</span><br><span class="line">            documentFragment = <span class="built_in">document</span>.createDocumentFragment();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// &#x8FD9;&#x8981;&#x6709;&#x65F6;&#x95F4;&#x4E14;&#x8FD8;&#x6709;&#x6D3B;&#xFF0C;&#x5C31;&#x5E72;</span></span><br><span class="line">        <span class="keyword">while</span> (deadline.timeRemaining() &gt; <span class="number">0</span> &amp;&amp; elementsToAdd.length &gt; <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// &#x521B;&#x5EFA;&#x4EE3;&#x7801;&#x7247;&#x6BB5;</span></span><br><span class="line">            <span class="keyword">var</span> elToAdd = elementsToAdd.pop();</span><br><span class="line">            <span class="keyword">var</span> el = <span class="built_in">document</span>.createElement(elToAdd.tag);</span><br><span class="line">            el.textContent = elToAdd.content;</span><br><span class="line"></span><br><span class="line">            documentFragment.appendChild(el);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// &#x4E0D;&#x8981;&#x7740;&#x6025;&#x63D2;&#x5165; body&#xFF0C;&#x4EA4;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A; rAF</span></span><br><span class="line">            ++countNonEssentialWork;</span><br><span class="line">            scheduleVisualUpdateIfNeeded();</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&apos;countNonEssentialWork:&apos;</span>, countNonEssentialWork);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&apos;elementsToAdd.length:&apos;</span>, elementsToAdd.length);</span><br><span class="line">        <span class="keyword">if</span> (elementsToAdd.length &gt; <span class="number">0</span>) {</span><br><span class="line">            requestIdleCallback(myNonEssentialWork, timeout);</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    requestIdleCallback(myNonEssentialWork, timeout);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD0;&#x884C; <code>test(10000)</code>&#xFF0C;&#x770B;&#x770B;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">countNonEssentialWork</span>: <span class="string">241</span></span><br><span class="line"><span class="attribute">elementsToAdd.length</span>: <span class="string">9759</span></span><br><span class="line"><span class="attribute">countAppendDocument</span>: <span class="string">1</span></span><br><span class="line"><span class="attribute">countNonEssentialWork</span>: <span class="string">4878</span></span><br><span class="line"><span class="attribute">elementsToAdd.length</span>: <span class="string">5122</span></span><br><span class="line"><span class="attribute">countAppendDocument</span>: <span class="string">2</span></span><br><span class="line"><span class="attribute">countNonEssentialWork</span>: <span class="string">10000</span></span><br><span class="line"><span class="attribute">elementsToAdd.length</span>: <span class="string">0</span></span><br><span class="line"><span class="attribute">countAppendDocument</span>: <span class="string">3</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x6211;&#x8BD5;&#x8FC7;&#x51E0;&#x6B21;&#xFF0C;&#x6BCF;&#x6B21;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x90FD;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;append &#x6B21;&#x6570;&#x6709;&#x591A;&#x6709;&#x5C11;&#xFF0C;&#x770B;&#x6765;&#x771F;&#x7684;&#x662F;&#x770B;&#x6D4F;&#x89C8;&#x5668;&#x662F;&#x4E0D;&#x662F;&#x201C;&#x7A7A;&#x95F2;&#x201D;&#x4E86;&#x3002;</p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="requestAnimationFrame">requestAnimationFrame</h2><p><code>requestAnimationFrame</code> 应该不是一个新鲜货了，<a href="https://angularjs.org/">Angular</a> 就有 <a href="https://github.com/angular/angular.js/blob/master/src/ng/raf.js">$$rAF</a>，<a href="http://cubiq.org/iscroll-5">iScroll</a> 也用他来实现动画功能，很久之前也在某些博客中看到某些 MVVM 框架的 <code>nextTick</code> 是用 <code>requestAnimationFrame</code> 实现的（<a href="http://rubylouvre.github.io/mvvm/">Avalon</a> 还是 <a href="http://vuejs.org/">Vue</a> 不记得了）。</p>]]>
    
    </summary>
    
      <category term="requestAnimationFrame" scheme="http://csbun.github.io/blog/tags/requestAnimationFrame/"/>
    
      <category term="requestIdleCallback" scheme="http://csbun.github.io/blog/tags/requestIdleCallback/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Meteor + React]]></title>
    <link href="http://csbun.github.io/blog/2015/07/meteor-react/"/>
    <id>http://csbun.github.io/blog/2015/07/meteor-react/</id>
    <published>2015-07-17T14:13:05.000Z</published>
    <updated>2015-10-27T10:11:26.000Z</updated>
    <content type="html"><![CDATA[<h2 id="install">Install</h2><p>&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x6709;&#x5B89;&#x88C5; <a href="https://www.meteor.com/" target="_blank" rel="external">Meteor</a>&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x8F93;&#x5165;&#xFF1A;</p>
<p>If you have not yet installed Meteor, do that:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://install.meteor.com | /bin/sh</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="init">Init</h2><p>&#x5B89;&#x88C5;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x521D;&#x59CB;&#x5316;&#x9879;&#x76EE;&#x4E5F;&#x662F;&#x76F8;&#x5F53;&#x5BB9;&#x6613;&#x7684;&#x3002;<br>&#x540C;&#x65F6;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8981;&#x4F7F;&#x7528; <a href="https://atmospherejs.com/meteor/react" target="_blank" rel="external">React &#x63D2;&#x4EF6;</a>&#xFF0C;&#x4E8E;&#x662F;&#x5728;&#x521B;&#x5EFA;&#x9879;&#x76EE;&#x4E4B;&#x540E;&#x5C31;&#x7ACB;&#x9A6C;&#x6DFB;&#x52A0;&#x4E86;&#x63D2;&#x4EF6;&#x3002;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">meteor new project-name</span><br><span class="line"><span class="built_in">cd</span> project-name</span><br><span class="line">meteor add react</span><br></pre></td></tr></table></figure>
<h2 id="structuring">Structuring</h2><h3 id="html">Html</h3><p><a href="https://www.meteor.com/" target="_blank" rel="external">Meteor</a> &#x662F;&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x9700;&#x8981;&#x7684;&#x5305;&#x548C;&#x6587;&#x4EF6;&#x63D2;&#x5165;&#x5230; html &#x4E2D;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>project-name.html</code> &#x4E2D;&#x53EA;&#x58F0;&#x660E;&#x7684;&#x7B80;&#x5355;&#x7684; <code>&lt;head&gt;</code> &#x548C; <code>&lt;body&gt;</code> &#x6CA1;&#x6709;&#x770B;&#x5230;&#x4EFB;&#x4F55;&#x7684; <code>&lt;script&gt;</code> &#x6216; <code>&lt;link&gt;</code> &#x7B49;&#x3002;</p>
<h3 id="server-and-client">Server and Client</h3><p><a href="https://www.meteor.com/" target="_blank" rel="external">Meteor</a> &#x7684;&#x672C;&#x610F;&#x5C31;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x8DD1;&#x540C;&#x4E00;&#x4EFD;&#x4EE3;&#x7801;&#xFF0C;&#x4F46;&#x6709;&#x4E00;&#x4E9B;&#x4EE3;&#x7801;&#x7684;&#x786E;&#x4E5F;&#x662F;&#x53EA;&#x5728;&#x670D;&#x52A1;&#x7AEF;&#x6216;&#x5BA2;&#x6237;&#x7AEF;&#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4EE5;&#x4E0B;&#x65B9;&#x6CD5;&#x533A;&#x522B;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Meteor.isClient) {</span><br><span class="line">  <span class="comment">// do CLIENT things here</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> (Meteor.isServer) {</span><br><span class="line">  <span class="comment">// do SERVER things here</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x7279;&#x522B;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA; <code>client</code> &#x548C; <code>server</code> &#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x5C31;&#x5206;&#x522B;&#x53EA;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x8FD0;&#x884C;&#x3002;&#x5176;&#x4ED6;&#x66F4;&#x590D;&#x6742;&#x7684;&#x60C5;&#x51B5;&#x53EF;&#x4EE5;&#x770B; <a href="http://docs.meteor.com/#/full/structuringyourapp" target="_blank" rel="external">&#x8FD9;&#x91CC;</a></p>
<h3 id="file-load-order">File Load Order</h3><p>&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x5F15;&#x7528;&#x5B98;&#x7F51;&#x7684;&#x4ECB;&#x7ECD;&#x4E86;&#xFF1A;</p>
<blockquote>
<ol>
<li>HTML template files are always loaded before everything else</li>
<li>Files beginning with main. are loaded last</li>
<li>Files inside any lib/ directory are loaded next</li>
<li>Files with deeper paths are loaded next</li>
<li>Files are then loaded in alphabetical order of the entire path</li>
</ol>
</blockquote>
<h2 id="run">Run</h2><p>&#x8FD0;&#x884C;&#x5DE5;&#x7A0B;&#xFF0C;&#x8DD1;&#x8D77;&#x6765;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor</span><br></pre></td></tr></table></figure>
<h2 id="add-reactrouter">Add ReactRouter</h2><p>&#x5E73;&#x5E38;&#x6211;&#x4F7F;&#x7528; <a href="facebook.github.io/react/">React</a> &#x90FD;&#x4F1A;&#x540C;&#x65F6;&#x4F7F;&#x7528; <a href="http://rackt.github.io/react-router/" target="_blank" rel="external">React Router</a>&#xFF0C;&#x4F46;&#x5728; <a href="https://www.meteor.com/" target="_blank" rel="external">Meteor</a> &#x4E2D;&#x5374;&#x6CA1;&#x6709;&#x8FD9;&#x4E48;&#x5BB9;&#x6613;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x81EA;&#x8EAB;&#x7684; npm &#x5F88;&#x4E0D;&#x597D;&#x4F7F;&#xFF08;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x5E73;&#x5E38;&#x7684; <code>npm i</code> &#x80FD;&#x89E3;&#x51B3;&#x7684;&#xFF09;&#x3002;&#x597D;&#x5728; <a href="http://react-in-meteor.readthedocs.org/en/latest/client-npm/" target="_blank" rel="external">&#x6559;&#x7A0B;</a> &#x5199;&#x5F97;&#x6BD4;&#x8F83;&#x6E05;&#x695A;&#xFF1A;</p>
<h3 id="add-the-relevant-meteor-packages">Add the relevant Meteor packages</h3><p>&#x6DFB;&#x52A0; <code>meteorhacks:npm</code> &#x548C; <code>cosmos:browserify</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor add meteorhacks:npm cosmos:browserify</span><br></pre></td></tr></table></figure>
<h3 id="add-the-npm-modules-you-want-to-packagesjson">Add the npm modules you want to packages.json</h3><p>&#x5728;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x521B;&#x5EFA; <code>packages.json</code> &#x6587;&#x4EF6;&#xFF0C;&#x7528;&#x6765;&#x58F0;&#x660E; dependences</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  &quot;<span class="attribute">react-router</span>&quot;: <span class="value"><span class="string">&quot;0.13.3&quot;</span></span>,</span><br><span class="line">  &quot;<span class="attribute">externalify</span>&quot;: <span class="value"><span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"></span>}</span><br></pre></td></tr></table></figure>
<h3 id="configure-browserify-and-transforms-in-appbrowserifyoptionsjson">Configure Browserify and transforms in app.browserify.options.json</h3><p>&#x6DFB;&#x52A0; <code>lib/app.browserify.options.json</code> &#x7528;&#x4E8E;&#x58F0;&#x660E; Browserify &#x7684;&#x914D;&#x7F6E;&#xFF1A;</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  &quot;<span class="attribute">transforms</span>&quot;: <span class="value">{</span><br><span class="line">    &quot;<span class="attribute">externalify</span>&quot;: <span class="value">{</span><br><span class="line">      &quot;<span class="attribute">global</span>&quot;: <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">      &quot;<span class="attribute">external</span>&quot;: <span class="value">{</span><br><span class="line">        &quot;<span class="attribute">react</span>&quot;: <span class="value"><span class="string">&quot;React.require&quot;</span></span><br><span class="line">      </span>}</span><br><span class="line">    </span>}</span><br><span class="line">  </span>}</span><br><span class="line"></span>}</span><br></pre></td></tr></table></figure>
<h3 id="add-the-appropriate-require-statements-to-appbrowserifyjs">Add the appropriate require statements to app.browserify.js</h3><p>&#x521B;&#x5EFA; <code>lib/app.browserify.js</code> &#x6587;&#x4EF6;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x9762;&#x5C31;&#x53EF;&#x4EE5;&#x5F15;&#x7528; npm &#x5305;&#x4E86;&#xFF01;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactRouter = <span class="built_in">require</span>(<span class="string">&quot;react-router&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="use-react-router">Use React Router</h3><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728; <code>client/main.jsx</code> &#x4E2D;&#x5B9A;&#x4E49;&#x8DEF;&#x7531;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> { Link, Route, DefaultRoute, RouteHandler } = ReactRouter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> App = React.createClass({</span><br><span class="line">  render() {</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">nav</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">Link</span> <span class="attribute">to</span>=<span class="value">&quot;home&quot;</span>&gt;</span>HOME<span class="tag">&lt;/<span class="title">Link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">nav</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">RouteHandler</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">div</span>&gt;</span>;</span></span><br><span class="line">  }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Somewhere = React.createClass({</span><br><span class="line">  render() {</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="title">div</span>&gt;</span>Somewhere<span class="tag">&lt;/<span class="title">div</span>&gt;</span>;</span></span><br><span class="line">  }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> routes = (</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="title">Route</span> <span class="attribute">name</span>=<span class="value">&quot;home&quot;</span> <span class="attribute">path</span>=<span class="value">&quot;/&quot;</span> <span class="attribute">handler</span>=<span class="value">{App}</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Route</span> <span class="attribute">name</span>=<span class="value">&quot;somewhere&quot;</span> <span class="attribute">path</span>=<span class="value">&quot;go/to/:somewhere&quot;</span> <span class="attribute">handler</span>=<span class="value">{Somewhere}</span>/&gt;</span></span><br><span class="line">    { /* more <span class="tag">&lt;<span class="title">Route</span>&gt;</span> here */ }</span><br><span class="line">    <span class="tag">&lt;<span class="title">DefaultRoute</span> <span class="attribute">handler</span>=<span class="value">{ProjectList}</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">Route</span>&gt;</span></span><br><span class="line">)</span>;</span><br><span class="line"></span><br><span class="line">Meteor.startup(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  ReactRouter.run(routes, <span class="function"><span class="keyword">function</span> (<span class="params">Handler</span>) </span>{</span><br><span class="line">    React.render(<span class="xml"><span class="tag">&lt;<span class="title">Handler</span>/&gt;</span>, document.body);</span><br><span class="line">  });</span><br><span class="line">});</span></span><br></pre></td></tr></table></figure>
<h2 id="less">less</h2><p>&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528; <a href="http://lesscss.org" target="_blank" rel="external">less</a>&#xFF0C;&#x4E5F;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor add less</span><br></pre></td></tr></table></figure>
<p>&#x4E4B;&#x540E;&#x5728;&#x6839;&#x76EE;&#x5F55;&#x521B;&#x5EFA; less &#x6587;&#x4EF6;&#x5373;&#x53EF;&#x3002;&#x4E0D;&#x9700;&#x8981;&#x624B;&#x52A8;&#x7F16;&#x8BD1;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x63D2;&#x5165;&#x6587;&#x4EF6;&#x5230; html &#x4E2D;&#x3002;</p>
<h2 id="router">Router</h2><p>&#x6BD4;&#x8F83;&#x51FA;&#x540D;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x63D2;&#x4EF6;&#x6709;&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#xFF1A;</p>
<p>There are two main third-party packages to choose between:</p>
<ul>
<li><a href="https://atmospherejs.com/iron/router" target="_blank" rel="external">Iron Router</a></li>
<li><a href="https://atmospherejs.com/meteorhacks/flow-router" target="_blank" rel="external">Flow Router</a></li>
</ul>
<p>&#x4F46;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x8DEF;&#x7531;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x5C31;&#x7528;&#x4E86;&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684; <a href="http://docs.meteor.com/#/full/webapp" target="_blank" rel="external">&#x8FD9;&#x4E2A;</a>&#xFF1A;</p>
<p>But I just want an simple server-side router, so I use the <a href="http://docs.meteor.com/#/full/webapp" target="_blank" rel="external">offical one</a>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor add webapp</span><br></pre></td></tr></table></figure>
<p>&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x4E3A; <code>http://localhost:3000/mock</code> &#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x8FD4;&#x56DE; JSON &#x6570;&#x636E;&#xFF1A;</p>
<p>For example, we create an api on <code>http://localhost:3000/mock</code> which provide a JSON response:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">WebApp.connectHandlers.use(<span class="string">&apos;/mock&apos;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{</span><br><span class="line">  res.writeHead(<span class="number">200</span>, {</span><br><span class="line">    <span class="string">&apos;Content-Type&apos;</span>: <span class="string">&apos;application/json&apos;</span></span><br><span class="line">  });</span><br><span class="line">  <span class="keyword">var</span> mockData = {</span><br><span class="line">    mock: <span class="literal">true</span></span><br><span class="line">  };</span><br><span class="line">  res.end(EJSON.stringify(mockData), <span class="string">&apos;utf-8&apos;</span>);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#x7684; <code>req</code> &#x548C; <code>res</code> &#x5C31; <a href="https://nodejs.org/" target="_blank" rel="external">Node.js</a> &#x7684; <a href="https://nodejs.org/api/http.html#http_http_incomingmessage" target="_blank" rel="external">http.IncomingMessage</a> &#x548C; <a href="https://nodejs.org/api/http.html#http_class_http_serverresponse" target="_blank" rel="external">http.ServerResponse</a>&#xFF0C;&#x7528;&#x6CD5;&#x4E5F;&#x76F8;&#x540C;&#x3002;</p>
<p>The <code>req</code> and <code>res</code> in the callback function is the same on <a href="https://nodejs.org/api/http.html#http_http" target="_blank" rel="external">Node.js</a></p>
<h2 id="reference">Reference</h2><p><a href="http://docs.meteor.com/#/full/" target="_blank" rel="external">METEOR Documentation</a></p>
<p><a href="http://info.meteor.com/blog/two-weeks-with-react-and-meteor" target="_blank" rel="external">Two weeks with React + Meteor</a></p>
<p><a href="http://alexgaribay.com/2015/07/06/getting-started-with-meteor-react-and-react-router/" target="_blank" rel="external">Getting Started with Meteor, React, and React Router</a></p>
<p><a href="http://react-in-meteor.readthedocs.org/en/latest/client-npm/" target="_blank" rel="external">Using client-side modules from NPM with Browserify</a></p>
<p><a href="http://rackt.github.io/react-router/" target="_blank" rel="external">React Router</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="Install">Install</h2><p>如果还没有安装 <a href="https://www.meteor.com/">Meteor</a>，那么在命令行中输入：</p>
<p>If you have not yet installed Meteor, do that:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://install.meteor.com | /bin/sh</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="Meteor" scheme="http://csbun.github.io/blog/tags/Meteor/"/>
    
      <category term="React" scheme="http://csbun.github.io/blog/tags/React/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[JS 单元测试代码覆盖率和持续集成]]></title>
    <link href="http://csbun.github.io/blog/2015/07/js-unit-test-coverage-ci/"/>
    <id>http://csbun.github.io/blog/2015/07/js-unit-test-coverage-ci/</id>
    <published>2015-07-10T11:43:29.000Z</published>
    <updated>2015-10-27T10:11:32.000Z</updated>
    <content type="html"><![CDATA[<p>&#x672C;&#x6765;&#x53EA;&#x662F;&#x60F3;&#x7ED9;&#x6211;&#x7684; <a href="https://github.com/csbun/lazy-cache" target="_blank" rel="external">lazy-cache</a> &#x52A0;&#x4E2A; badge &#x88C5;&#x4E00;&#x4E0B;&#x903C;&#x7684;&#xFF0C;&#x6CA1;&#x60F3;&#x5230;&#x4F1A;&#x626F;&#x5230;&#x8FD9;&#x4E48;&#x591A;&#x4E1C;&#x897F;&#x3002;</p>
<a id="more"></a>
<h2 id="nodeico">NodeICO</h2><p>&#x5C31;&#x662F;&#x8FD9;&#x8D27;</p>
<p><a href="https://nodei.co/npm/lazycache/" target="_blank" rel="external"><img src="https://nodei.co/npm/lazycache.png?compact=true" alt="NPM"></a></p>
<p>&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x6280;&#x672F;&#x542B;&#x91CF;&#xFF0C;&#x53EA;&#x8981;&#x662F; npm &#x5305;&#xFF0C;&#x6309;<a href="https://nodei.co/" target="_blank" rel="external">&#x5B98;&#x7F51;</a>&#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x628A;&#x8FD9;&#x6BB5;&#x5185;&#x5BB9;&#x5199;&#x5728; README &#x91CC;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF1A;</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="link_label">![NPM</span>](<span class="link_url">https://nodei.co/npm/&lt;package&gt;.png</span>)](<span class="link_url">https://nodei.co/npm/&lt;package&gt;/</span>)</span><br></pre></td></tr></table></figure>
<p>&#x81F3;&#x4E8E;&#x5404;&#x79CD; Styles&#xFF0C;&#x90FD;&#x662F;&#x53C2;&#x6570;&#x95EE;&#x9898;&#xFF0C;&#x5B98;&#x7F51;&#x63D0;&#x4F9B;&#x7684;&#x5728;&#x7EBF;&#x5DE5;&#x5177;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;</p>
<h2 id="unit-test">Unit Test</h2><p>&#x56E0;&#x4E3A;&#x53EA;&#x7528;&#x8FC7; <a href="http://mochajs.org/" target="_blank" rel="external">mocha</a>&#xFF0C;&#x6CA1;&#x6709;&#x5BF9;&#x6BD4;&#x8FC7;&#x522B;&#x7684;&#xFF0C;&#x5C31;&#x5728; <code>test/test.js</code> &#x5199;&#x4E86;&#x51E0;&#x4E2A;&#x7528;&#x4F8B;&#xFF0C;&#x8FD9;&#x4E2A;&#x6CA1;&#x4EC0;&#x4E48;&#x597D;&#x8BB2;&#x7684;&#x3002;</p>
<p>&#x53EA;&#x8981;&#x5728; <code>package.json</code> &#x91CC;&#x9762;&#x5199;&#x660E; test &#x7684;&#x547D;&#x4EE4;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF1A;</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  &quot;<span class="attribute">name</span>&quot;: <span class="value"><span class="string">&quot;lazycache&quot;</span></span>,</span><br><span class="line">  &quot;<span class="attribute">version</span>&quot;: <span class="value"><span class="string">&quot;0.0.1&quot;</span></span>,</span><br><span class="line">  &quot;<span class="attribute">description</span>&quot;: <span class="value"><span class="string">&quot;automatic reset cache asynchronously when expired&quot;</span></span>,</span><br><span class="line">  &quot;<span class="attribute">main</span>&quot;: <span class="value"><span class="string">&quot;index.js&quot;</span></span>,</span><br><span class="line">  &quot;<span class="attribute">scripts</span>&quot;: <span class="value">{</span><br><span class="line">    &quot;<span class="attribute">test</span>&quot;: <span class="value"><span class="string">&quot;./node_modules/mocha/bin/_mocha --harmony&quot;</span></span><br><span class="line">  </span>}</span>,</span><br><span class="line">  &quot;<span class="attribute">devDependencies</span>&quot;: <span class="value">{</span><br><span class="line">    &quot;<span class="attribute">mocha</span>&quot;: <span class="value"><span class="string">&quot;^2.2.5&quot;</span></span><br><span class="line">  </span>}</span><br><span class="line"></span>}</span><br></pre></td></tr></table></figure>
<p>&#x56E0;&#x4E3A;&#x6211;&#x7528;&#x4E86; ES6 &#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x9700;&#x8981; <code>--harmony</code>&#xFF0C;&#x8FD9;&#x6837; <code>npm test</code> &#x5C31;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x4E86;&#xFF0C;&#x5F88;&#x597D;&#x3002;</p>
<h2 id="ci">CI</h2><p>&#x7F51;&#x4E0A;&#x627E;&#x5230;&#x4E86; <a href="https://travis-ci.org/" target="_blank" rel="external">Travis CI</a> &#x597D;&#x50CF;&#x5F88;&#x51FA;&#x540D;&#x7684;&#x6837;&#x5B50;&#xFF0C;&#x4E8E;&#x662F;&#x7528; Github &#x5E10;&#x53F7;&#x767B;&#x5F55;&#x4E4B;&#x540E;&#x5C31;&#x80FD;&#x628A;&#x9879;&#x76EE;&#x52FE;&#x9009;&#x8FDB;&#x53BB;&#x3002;</p>
<p><img src="https://travis-ci-org.global.ssl.fastly.net/images/svg/hooks-step-1-01-a62331c87f58ada70c9b273ea15d2215.svg" alt="&#x76D7;&#x4E86;&#x5B98;&#x7F51;&#x7684;&#x4E00;&#x5F20;&#x56FE;"></p>
<p>&#x9879;&#x76EE;&#x7684;&#x8DDF;&#x76EE;&#x5F55;&#x6DFB;&#x52A0; <code>.travis.yml</code> &#x6587;&#x4EF6;&#xFF0C;&#x5177;&#x4F53;&#x5199;&#x6CD5;&#x53EF;&#x4EE5;<a href="http://docs.travis-ci.com/user/getting-started/" target="_blank" rel="external">&#x5728;&#x8FD9;&#x91CC;&#x770B;</a>&#xFF0C;&#x6211;&#x7684; <a href="http://docs.travis-ci.com/user/languages/javascript-with-nodejs/" target="_blank" rel="external">JavaScript &#x9879;&#x76EE;</a>&#x662F;&#x8FD9;&#x6837;&#x5199;&#x7684;&#xFF1A;</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">language:</span> node_js</span><br><span class="line"><span class="label">node_js:</span></span><br><span class="line">  - <span class="string">&quot;0.12&quot;</span></span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x65F6;&#x5019;&#x53EA;&#x8981; push &#x4E0A; Github &#x5C31;&#x4F1A;&#x89E6;&#x53D1;&#x6784;&#x5EFA;&#xFF0C;&#x5728; <a href="https://travis-ci.org/" target="_blank" rel="external">Travis CI</a> &#x7684;&#x63A7;&#x5236;&#x9762;&#x677F;&#x4E0A;&#x5C31;&#x80FD;&#x770B;&#x5230;&#x9879;&#x76EE;&#x7684;&#x6784;&#x5EFA;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x70B9;&#x51FB;&#x9879;&#x76EE;&#x540D;&#x79F0;&#x540E;&#x9762;&#x7684;&#x8FD9;&#x4E2A;&#x6309;&#x94AE; <img src="https://travis-ci.org/csbun/lazy-cache.svg?branch=master" alt="Build Status">&#xFF0C;&#x590D;&#x5236;&#x91CC;&#x9762;&#x7684; Markdown Badge &#x5230; README&#xFF0C;&#x641E;&#x5B9A;&#xFF01;</p>
<h2 id="coverage">Coverage</h2><p>&#x53EA;&#x662F;&#x4E00;&#x4E2A; <code>build|passing</code> &#x80AF;&#x5B9A;&#x6CA1;&#x529E;&#x6CD5;&#x6EE1;&#x8DB3;&#xFF0C;&#x641E;&#x4E2A;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x8986;&#x76D6;&#x7387;&#x60F3;&#x5FC5;&#x662F;&#x6781;&#x597D;&#x7684;&#x3002;<a href="https://coveralls.io/" target="_blank" rel="external">COVERALLS</a> &#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x4E2A;&#x4E1C;&#x897F;&#xFF0C;&#x7F51;&#x7AD9;&#x989C;&#x503C;&#x8FD8;&#x4E0D;&#x9519;~</p>
<p>&#x9879;&#x76EE;&#x8FD8;&#x5F97;&#x518D;&#x52A0;&#x70B9;&#x4E1C;&#x897F;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x662F;&#x7528; mocha &#x7684;&#xFF0C;&#x6309;<a href="https://github.com/nickmerwin/node-coveralls/blob/master/README.md" target="_blank" rel="external">&#x8BF4;&#x660E;</a>&#xFF0C;&#x6211;&#x9700;&#x8981;&#x88C5;&#x8FD9;&#x4E9B;&#xFF1A;</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --<span class="built_in">save</span>-<span class="built_in">dev</span> coveralls mocha-lcov-reporter</span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x7528; <a href="https://github.com/gotwarlost/istanbul" target="_blank" rel="external">istanbul</a> &#x505A;&#x4EE3;&#x7801;&#x8986;&#x76D6;&#x7387;&#xFF0C;&#x518D;&#x88C5;&#x4E0A;&#xFF1A;</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --<span class="built_in">save</span>-<span class="built_in">dev</span> istanbul</span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x6309;&#x7167;<a href="https://github.com/nickmerwin/node-coveralls#user-content-istanbul" target="_blank" rel="external">&#x8BF4;&#x660E;</a>&#xFF0C;&#x6539;&#x4E00;&#x4E0B; test &#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node --harmony node_modules<span class="regexp">/.bin/i</span>stanbul cover .<span class="regexp">/node_modules/m</span>ocha<span class="regexp">/bin/</span>_mocha --report lcovonly -- -R spec &amp;&amp; cat .<span class="regexp">/coverage/</span>lcov.info | .<span class="regexp">/node_modules/</span>coveralls<span class="regexp">/bin/</span>coveralls.js &amp;&amp; rm -rf .<span class="regexp">/coverage</span></span><br></pre></td></tr></table></figure>
<p>&#x518D;&#x63D0;&#x4EA4;&#x4E0A; Github&#xFF0C;<a href="https://travis-ci.org/" target="_blank" rel="external">Travis CI</a> &#x548C; <a href="https://coveralls.io/" target="_blank" rel="external">COVERALLS</a> &#x90FD;&#x5E94;&#x8BE5;&#x80FD;&#x770B;&#x5230;&#x6784;&#x5EFA;&#x7ED3;&#x679C;&#x4E86;&#xFF01;</p>
<p>&#x5728; <a href="https://coveralls.io/" target="_blank" rel="external">COVERALLS</a> &#x7684;&#x9879;&#x76EE;&#x8BE6;&#x60C5;&#x9875;&#xFF0C;&#x53F3;&#x4FA7;&#x72B6;&#x6001;&#x680F;&#x7684; <code>README BADGE</code> &#x70B9;&#x51FB; <code>BADGE URLS</code> &#x628A;&#x4E1C;&#x897F;&#x590D;&#x5236;&#x51FA;&#x53BB;&#x5C31;&#x597D;&#x4E86;&#xFF01;</p>
<h2 id="references">References</h2><ul>
<li><a href="http://bahmutov.calepin.co/project-status-badges.html" target="_blank" rel="external">Project status badges</a></li>
<li><a href="https://cnodejs.org/topic/53145f8b33dbcb076d0b3352" target="_blank" rel="external">Use istanbul test coverage on koa</a></li>
<li><a href="https://nodei.co/" target="_blank" rel="external">NodeICO</a></li>
<li><a href="https://travis-ci.org/" target="_blank" rel="external">Travis CI</a></li>
<li><a href="https://coveralls.io/" target="_blank" rel="external">COVERALLS</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>本来只是想给我的 <a href="https://github.com/csbun/lazy-cache">lazy-cache</a> 加个 badge 装一下逼的，没想到会扯到这么多东西。</p>]]>
    
    </summary>
    
      <category term="ci" scheme="http://csbun.github.io/blog/tags/ci/"/>
    
      <category term="coverage" scheme="http://csbun.github.io/blog/tags/coverage/"/>
    
      <category term="test" scheme="http://csbun.github.io/blog/tags/test/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Less 使用简记]]></title>
    <link href="http://csbun.github.io/blog/2015/07/less/"/>
    <id>http://csbun.github.io/blog/2015/07/less/</id>
    <published>2015-07-08T08:51:48.000Z</published>
    <updated>2015-10-27T10:11:45.000Z</updated>
    <content type="html"><![CDATA[<p>&#x4E00;&#x76F4;&#x4EE5;&#x6765;&#xFF0C;&#x5BF9; css &#x90FD;&#x662F;&#x90A3;&#x4E48;&#x65E0;&#x529B;&#xFF0C;&#x6700;&#x8FD1;&#x9879;&#x76EE;&#x9700;&#x8981;&#xFF0C;&#x6298;&#x817E;&#x4E86;&#x4E00;&#x4E0B; <a href="http://lesscss.org" target="_blank" rel="external">less</a>&#x3002;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x4E00;&#x4E0B;&#x6211;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x719F;&#x6089; less &#x7684;&#x76C6;&#x53CB;&#x53EF;&#x4EE5; cmd+w &#x4E86;&#x3002;</p>
<a id="more"></a>
<h2 id="&#x5B89;&#x88C5;">&#x5B89;&#x88C5;</h2><p>&#x5F88;&#x7B80;&#x5355;&#xFF0C;npm</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="tag">i</span> less</span><br></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x884C;&#x5C31;&#x8981;&#x5168;&#x5C40;&#x5B89;&#x88C5; <code>-g</code>&#x3002;</p>
<h2 id="&#x4F7F;&#x7528;">&#x4F7F;&#x7528;</h2><h3 id="compile">Compile</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> less = <span class="built_in">require</span>(<span class="string">&apos;less&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> sourceCode = <span class="string">&apos;...&apos;</span>; <span class="comment">// &#x6E90;&#x7801;&#x5B57;&#x7B26;&#x4E32;</span></span><br><span class="line"><span class="keyword">var</span> options = {</span><br><span class="line">    compress: <span class="literal">true</span>, <span class="comment">// &#x662F;&#x5426;&#x538B;&#x7F29;</span></span><br><span class="line">    globalVars: {</span><br><span class="line">        var1: <span class="string">&apos;val1&apos;</span></span><br><span class="line">    },</span><br><span class="line">    modifyVars: {</span><br><span class="line">        var2: <span class="string">&apos;val2&apos;</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> lessPromise = less.render(sourceCode, options);</span><br></pre></td></tr></table></figure>
<p><code>less.render</code> &#x8FD4;&#x56DE;&#x7684;&#x662F;&#x4E00;&#x4E2A; <code>Promise</code>&#xFF0C;&#x5982;&#x679C;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#xFF0C;&#x5927;&#x53EF;&#x4EE5;&#x76F4;&#x63A5; <code>.then()</code> &#x7EE7;&#x7EED;&#x3002;&#x8FD8;&#x53EF;&#x4EE5;&#x5145;&#x5206;&#x5229;&#x7528; <code>Promise</code> &#x7684;&#x4F18;&#x52BF;&#xFF0C;&#x5982;&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#x65F6; <code>Promise.all([...])</code>&#x3002;</p>
<h3 id="globalvars-modifyvars">globalVars &amp; modifyVars</h3><p>&#x5B98;&#x65B9;&#x7684;&#x5B9A;&#x4E49;&#xFF1A;</p>
<blockquote>
<h4 id="globalvars">globalVars</h4><p>List of global variables to be injected into the code. Keys of the object are variables names, values are variables values. Variables of &#x201C;string&#x201D; type must explicitly include quotes if needed.</p>
<h4 id="modifyvars">modifyVars</h4><p>As opposed to the globalVars option, this puts the declaration at the end of your base file, meaning it will override anything defined in your Less file.</p>
</blockquote>
<p><code>globalVars</code> &#x548C; <code>modifyVars</code> &#x975E;&#x5E38;&#x597D;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x4E86;&#x8FD9;&#x4E24;&#x4E2A;&#x914D;&#x7F6E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x628A; js &#x91CC;&#x9762;&#x7684;&#x4E00;&#x4E9B;&#x53D8;&#x91CF;&#x4F20;&#x9012;&#x5230; less &#x4E2D;&#x3002;<code>globalVars</code> &#x53EF;&#x4EE5;&#x505A;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;<code>modifyVars</code>&#x505A;&#x91CD;&#x7F6E;&#x503C;&#x3002;</p>
<h3 id="&#x547D;&#x4EE4;&#x884C;">&#x547D;&#x4EE4;&#x884C;</h3><p><code>lessc</code> &#x662F;&#x6807;&#x51C6;&#x8F93;&#x51FA;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">lessc</span> <span class="tag">file</span><span class="class">.less</span> &gt; <span class="tag">out</span><span class="class">.css</span></span><br></pre></td></tr></table></figure>
<p>&#x5177;&#x4F53;&#x7528;&#x6CD5;&#x8FD8;&#x662F;&#x770B;<a href="http://lesscss.org/#using-less-command-line-usage" target="_blank" rel="external">&#x5B98;&#x7F51;</a>&#x5427;&#x3002;</p>
<h2 id="&#x8BED;&#x6CD5;">&#x8BED;&#x6CD5;</h2><h3 id="&#x5D4C;&#x5957;">&#x5D4C;&#x5957;</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">body {</span><br><span class="line">    color: #333;</span><br><span class="line">    .main {</span><br><span class="line">        background: #eee;</span><br><span class="line">        p {</span><br><span class="line">            color: #666;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x7F16;&#x8BD1;&#x540E;&#xFF1A;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">body</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#333</span></span></span>;</span><br><span class="line">}</span></span><br><span class="line"><span class="tag">body</span> <span class="class">.main</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#eee</span></span></span>;</span><br><span class="line">}</span></span><br><span class="line"><span class="tag">body</span> <span class="class">.main</span> <span class="tag">p</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#666</span></span></span>;</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<h3 id="&#x53D8;&#x91CF;">&#x53D8;&#x91CF;</h3><h4 id="&#x503C;">&#x503C;</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@<span class="keyword">var1:</span> #fff</span>;</span><br><span class="line"><span class="tag">body</span> <span class="rules">{</span><br><span class="line">    <span class="rule"><span class="attribute">color</span>:<span class="value"> @var1</span></span>;</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<h4 id="&#x9009;&#x62E9;&#x5668;">&#x9009;&#x62E9;&#x5668;</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@<span class="keyword">my-selector:</span> banner</span>;</span><br><span class="line">.<span class="at_rule">@<span class="keyword">{my-selector}</span> </span>{</span><br><span class="line">    <span class="tag">color</span>: <span class="id">#fff</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="&#x7279;&#x6B8A;&#x5B57;&#x7B26;">&#x7279;&#x6B8A;&#x5B57;&#x7B26;</h4><ul>
<li>&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x9700;&#x8981;&#x7528;&#x5F15;&#x53F7; <code>&quot;</code> &#x5305;&#x4F4F;&#x5B57;&#x7B26;&#x4E32;</li>
<li>&#x4F7F;&#x7528;&#x65F6;&#x7528;&#x5927;&#x62EC;&#x53F7; <code>{}</code> &#x5305;&#x4F4F;&#x53D8;&#x91CF;</li>
<li>&#x53D8;&#x91CF;&#x5FC5;&#x987B;&#x5728;&#x5B57;&#x7B26;&#x4E32;&#x5185; <code>&apos;@{var}&apos;</code></li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@<span class="keyword">imgPath:</span> <span class="string">&quot;/path/to/bg.png&quot;</span></span>;</span><br><span class="line"><span class="class">.bg</span> <span class="rules">{</span><br><span class="line">    <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="function">url</span>(<span class="string">&apos;@{imagePath}&apos;</span>)</span></span>;</span><br><span class="line">}</span></span><br><span class="line"><span class="class">.bg2</span> <span class="rules">{</span><br><span class="line">    <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="function">url</span>(<span class="string">&apos;append/url/@{imagePath}&apos;</span>)</span></span>;</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x4F7F;&#x7528; <code>globalVars</code> &#x548C; <code>modifyVars</code> &#x65F6;&#xFF0C;&#x4E5F;&#x8981;&#x6CE8;&#x610F;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">less.render(sourceCode, {</span><br><span class="line">    modifyVars: {</span><br><span class="line">        imgPath: <span class="string">&apos;&quot;/path/to/bg.png&quot;&apos;</span> <span class="comment">// &#x6CE8;&#x610F;&#xFF0C;&#x91CC;&#x9762;&#x8FD8;&#x6709;&#x4E00;&#x5BF9;&#x53CC;&#x5F15;&#x53F7;</span></span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h3 id="when">When</h3><p>&#x53EA;&#x80FD;&#x7528;&#x4E8E;&#x5224;&#x65AD; boolean &#x503C;&#x7684;&#x6761;&#x4EF6;&#x8BED;&#x53E5;&#xFF1A;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@<span class="keyword">condition1:</span> true</span>;</span><br><span class="line"><span class="at_rule">@<span class="keyword">condition2:</span> #fff</span>;</span><br><span class="line"><span class="class">.btn</span> <span class="tag">when</span> (<span class="at_rule">@<span class="keyword">condition1)</span> </span>{ <span class="comment">/* &#x8FD9;&#x91CC;&#x5224;&#x65AD;&#x6210;&#x529F; */</span></span><br><span class="line">    <span class="tag">width</span>: 100<span class="tag">px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="class">.btn</span> <span class="tag">when</span> (<span class="at_rule">@<span class="keyword">condition2)</span> </span>{ <span class="comment">/* &#x8FD9;&#x91CC;&#x5224;&#x65AD;&#x5931;&#x8D25; */</span></span><br><span class="line">    <span class="tag">height</span>: 25<span class="tag">px</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x7F16;&#x8BD1;&#x540E;&#xFF1A;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.btn</span> <span class="rules">{</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<p>&#x540C;&#x6837;&#x4E5F;&#x6709; <code>when not</code> &#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF1A;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@<span class="keyword">img:</span> <span class="string">&quot;path/to/img.png&quot;</span></span>;</span><br><span class="line"><span class="class">.btn</span> <span class="tag">when</span> (<span class="at_rule">@<span class="keyword">img</span> = <span class="string">&quot;&quot;</span>) </span>{</span><br><span class="line">    <span class="tag">background-color</span>: <span class="id">#fff</span>;</span><br><span class="line">}</span><br><span class="line"><span class="class">.btn</span> <span class="tag">when</span> <span class="tag">not</span> (<span class="at_rule">@<span class="keyword">img</span> = <span class="string">&quot;&quot;</span>) </span>{</span><br><span class="line">    <span class="tag">background-image</span>: <span class="tag">url</span>(<span class="at_rule">@<span class="keyword">img);</span></span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<p>&#x7F16;&#x8BD1;&#x540E;&#xFF1A;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.btn</span> <span class="rules">{</span><br><span class="line">    <span class="rule"><span class="attribute">background-image</span>:<span class="value"> <span class="function">url</span>(path/to/img.png)</span></span>;</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<h3 id="extend">Extend</h3><p>&#x9002;&#x7528;&#x4E00;&#x4E9B;&#x5171;&#x540C;&#x6837;&#x5F0F;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#xFF1A;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.btn</span> <span class="rules">{</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">25px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">}</span></span><br><span class="line"></span><br><span class="line"><span class="class">.btn-red</span><span class="pseudo">:extend(</span><span class="class">.btn</span>) <span class="rules">{</span><br><span class="line">    <span class="rule"><span class="attribute">background</span>:<span class="value"> red</span></span>;</span><br><span class="line">}</span></span><br><span class="line"><span class="class">.btn-blue</span><span class="pseudo">:extend(</span><span class="class">.btn</span>) <span class="rules">{</span><br><span class="line">    <span class="rule"><span class="attribute">background</span>:<span class="value"> blue</span></span>;</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<p>&#x7F16;&#x8BD1;&#x540E;&#xFF1A;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.btn</span>,</span><br><span class="line"><span class="class">.btn-red</span>,</span><br><span class="line"><span class="class">.btn-blue</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">25px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">}</span></span><br><span class="line"><span class="class">.btn-red</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> red</span></span>;</span><br><span class="line">}</span></span><br><span class="line"><span class="class">.btn-blue</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> blue</span></span>;</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<h4 id="&#x5728;&#x5D4C;&#x5957;&#x91CC;&#x9762;&#x4F7F;&#x7528;">&#x5728;&#x5D4C;&#x5957;&#x91CC;&#x9762;&#x4F7F;&#x7528;</h4><p>&#x5982;&#x4E0B; less &#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.main {</span><br><span class="line">    .title {</span><br><span class="line">        color: #ccc;</span><br><span class="line">    }</span><br><span class="line">    .subtitle:extend(.title) {</span><br><span class="line">        font-size: 14px;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x4F1A;&#x62A5;&#x9519;&#x8BEF; <code>extend &apos; .title&apos; has no matches</code>&#xFF0C;&#x9700;&#x8981;&#x8FD9;&#x6837;&#x5B9E;&#x73B0;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.main {</span><br><span class="line">    .title {</span><br><span class="line">        color: #ccc;</span><br><span class="line">    }</span><br><span class="line">    .subtitle:extend(.main .title) { // &#x6CE8;&#x610F;&#x8FD9;&#x91CC;</span><br><span class="line">        font-size: 14px;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6211;&#x5C31;&#x4E0D;&#x592A;&#x80FD;&#x63A5;&#x53D7;&#x4E86;&#xFF0C;&#x5D4C;&#x5957;&#x91CC;&#x9762;&#x5C45;&#x7136;&#x8FD8;&#x8981;&#x6211;&#x77E5;&#x9053;&#x8FD9;&#x4E2A; <code>.title</code> &#x7684;&#x4E0A;&#x4E00;&#x7EA7;&#x662F; <code>.main</code> &#x624D;&#x80FD;&#x5D4C;&#x5957;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x66F4;&#x591A;&#x7EA7;&#x7684;&#x5C31;&#x5F88;&#x522B;&#x626D;&#x4E86;&#x3002;&#x770B;&#x5230; Github &#x4E0A;&#x7684;&#x8FD9;&#x4E2A; <a href="https://github.com/less/less.js/issues/1730" target="_blank" rel="external">issue #1730</a> &#x4E5F;&#x6CA1;&#x6709;&#x5B8C;&#x7F8E;&#x7684;&#x7B54;&#x6848;&#x3002;</p>
<h3 id="mixin">Mixin</h3><p>mixin &#x540C;&#x6837;&#x80FD;&#x5B9E;&#x73B0;&#x4E0A;&#x9762;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F46;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x7F16;&#x8BD1;&#x7ED3;&#x679C;&#x4EE3;&#x7801;&#x91CF;&#x4F1A;&#x66F4;&#x591A;&#xFF0C;&#x56E0;&#x4E3A; mixin &#x662F;&#x884C;&#x5185;&#x7684;&#x3002;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.btn {</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 25px;</span><br><span class="line">    color: #fff;</span><br><span class="line">}</span><br><span class="line">.btn-red {</span><br><span class="line">    .btn();</span><br><span class="line">    background: red;</span><br><span class="line">}</span><br><span class="line">.btn-blue {</span><br><span class="line">    .btn();</span><br><span class="line">    background: blue;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x7F16;&#x8BD1;&#x540E;&#xFF1A;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.btn</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">25px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">}</span></span><br><span class="line"><span class="class">.btn-red</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">25px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> red</span></span>;</span><br><span class="line">}</span></span><br><span class="line"><span class="class">.btn-blue</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">25px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> blue</span></span>;</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<p>&#x800C; mixin &#x771F;&#x6B63;&#x7684;&#x4F18;&#x52BF;&#x5728;&#x4E8E;&#x5176; <em>&#x51FD;&#x6570;&#x5316;</em> &#x65B9;&#x6CD5;&#xFF0C;&#x540C;&#x6837;&#x662F;&#x4E0A;&#x9762;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x5199;&#xFF1A;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.btn(@bgColor) { // &#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x62EC;&#x53F7;&#xFF0C;&#x91CC;&#x9762;&#x5E26;&#x6709;&#x53C2;&#x6570;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 25px;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background: @bgColor;</span><br><span class="line">}</span><br><span class="line">.btn-red {</span><br><span class="line">    .btn(red);</span><br><span class="line">}</span><br><span class="line">.btn-blue {</span><br><span class="line">    .btn(blue);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x7F16;&#x8BD1;&#x540E;&#xFF1A;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.btn-red</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">25px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> red</span></span>;</span><br><span class="line">}</span></span><br><span class="line"><span class="class">.btn-blue</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">25px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> blue</span></span>;</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x8FD9;&#x6B21;&#x7684;&#x7F16;&#x8BD1;&#x7ED3;&#x679C;&#x5DF2;&#x7ECF;&#x6CA1;&#x6709; <code>.btn</code> &#x4E86;&#xFF0C;&#x6211;&#x7406;&#x89E3; <code>()</code> &#x4F7F;&#x5176;&#x4F5C;&#x4E3A;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x5B58;&#x5728;&#xFF0C;&#x672C;&#x8EAB;&#x4E0D;&#x4EA7;&#x751F; css&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x88AB;&#x8C03;&#x7528;&#x65F6;&#x624D;&#x5C06;&#x5176;&#x51FD;&#x6570;&#x4F53; <code>{}</code> &#x91CC;&#x7684;&#x5185;&#x5BB9;&#x8D4B;&#x4E88;&#x8C03;&#x7528;&#x8005;&#x3002;</p>
<h4 id="&#x5728;&#x5D4C;&#x5957;&#x4E2D;&#x4F7F;&#x7528;">&#x5728;&#x5D4C;&#x5957;&#x4E2D;&#x4F7F;&#x7528;</h4><p>mixin &#x5728;&#x5D4C;&#x5957;&#x4E2D;&#x5C31;&#x6CA1;&#x6709;&#x90A3;&#x4E48;&#x591A;&#x95EE;&#x9898;&#x4E86;&#xFF1A;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.main {</span><br><span class="line">    .title {</span><br><span class="line">        color: #ccc;</span><br><span class="line">    }</span><br><span class="line">    .subtitle {</span><br><span class="line">        .title;</span><br><span class="line">        font-size: 14px;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6216;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.main {</span><br><span class="line">    .title(@color) {</span><br><span class="line">        color: @color;</span><br><span class="line">    }</span><br><span class="line">    .subtitle {</span><br><span class="line">        .title(#ccc);</span><br><span class="line">        font-size: 14px;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x90FD;&#x80FD;&#x5206;&#x522B;&#x5F97;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4F46;&#x8FD9;&#x4E24;&#x8005;&#x662F;&#x6709;&#x533A;&#x522B;&#x7684;&#xFF0C;&#x524D;&#x8005;&#x4F1A;&#x4EA7;&#x751F; <code>.main .title</code> &#x800C;&#x540E;&#x8005;&#x4E0D;&#x4F1A;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8981;&#x5728;&#x5D4C;&#x5957;&#x5916;&#x8C03;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x4E5F;&#x5F88;&#x5408;&#x7406;&#xFF1A;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.main {</span><br><span class="line">    .title(@color) {</span><br><span class="line">        color: @color;</span><br><span class="line">    }</span><br><span class="line">    .subtitle {</span><br><span class="line">        .title(#ccc);</span><br><span class="line">        font-size: 14px;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.other {</span><br><span class="line">    .main .title(#ccc); // &#x6CE8;&#x610F;&#x8FD9;&#x91CC;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[<p>一直以来，对 css 都是那么无力，最近项目需要，折腾了一下 <a href="http://lesscss.org">less</a>。这里只是记录一下一下我使用过程中的问题，熟悉 less 的盆友可以 cmd+w 了。</p>]]>
    
    </summary>
    
      <category term="less" scheme="http://csbun.github.io/blog/tags/less/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Docker With Node]]></title>
    <link href="http://csbun.github.io/blog/2015/06/docker-with-node/"/>
    <id>http://csbun.github.io/blog/2015/06/docker-with-node/</id>
    <published>2015-06-18T12:41:05.000Z</published>
    <updated>2015-10-27T10:11:49.000Z</updated>
    <content type="html"><![CDATA[<h2 id="install-docker">Install Docker</h2><p>We can use docker CLI by install <a href="http://docs.docker.com/installation/mac/" target="_blank" rel="external">Boot2Docker</a> or GUI via <a href="https://kitematic.com/" target="_blank" rel="external">Kitematic</a></p>
<a id="more"></a>
<h3 id="install-boot2docker">Install <a href="http://docs.docker.com/installation/mac/" target="_blank" rel="external">Boot2Docker</a></h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boot2docker </span>init</span><br></pre></td></tr></table></figure>
<blockquote>
<p>This creates a new virtual machine. You only need to run this command once.</p>
</blockquote>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boot2docker </span>start</span><br></pre></td></tr></table></figure>
<p>Then u will see at the first time</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">To connect the Docker client to the Docker daemon, please <span class="built_in">set</span>:</span><br><span class="line">    <span class="keyword">export</span> DOCKER_HOST=tcp:<span class="comment">//192.168.59.103:2376</span></span><br><span class="line">    <span class="keyword">export</span> DOCKER_CERT_PATH=/Users/xxx/.boot2docker/certs/boot2docker-vm</span><br><span class="line">    <span class="keyword">export</span> DOCKER_TLS_VERIFY=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>Do it then run <code>boot2docker start</code> again. this time we get</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">Waiting</span> for <span class="variable">VM</span> <span class="keyword">and</span> <span class="variable">Docker</span> daemon to start...</span><br><span class="line">.o</span><br><span class="line"><span class="variable">Started</span>.</span><br><span class="line">...</span><br><span class="line"><span class="variable">Your</span> environment variables are already set correctly.</span><br></pre></td></tr></table></figure>
<p>Now we get <code>docker</code> in our cli, next time we will just run <code>boot2docker start</code> to get it. (Or just run the <code>boot2docker</code> Application)</p>
<h3 id="install-kitematic">Install <a href="https://kitematic.com/" target="_blank" rel="external">Kitematic</a></h3><p>click <code>Docker CLI</code> at bottom left and run the cli</p>
<h2 id="get-node-image">Get Node Image</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull <span class="keyword">node</span><span class="identifier"></span><span class="title"></span></span><br></pre></td></tr></table></figure>
<h2 id="run-node">Run Node</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir docker-<span class="keyword">node</span><span class="identifier"></span><span class="title">-test</span></span><br><span class="line">cd docker-<span class="keyword">node</span><span class="identifier"></span><span class="title">-test</span></span><br><span class="line">touch index.js</span><br><span class="line">touch Dockerfile</span><br><span class="line">npm init</span><br></pre></td></tr></table></figure>
<p>Edit index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&apos;Hello World&apos;</span>);</span><br></pre></td></tr></table></figure>
<p>Edit Dockerfile</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM <span class="keyword">node</span><span class="identifier"></span><span class="title">:onbuild</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>The &#x2018;onbuild&#x2019; version is based on the plain &#x2018;iojs&#x2019; version used above, but it copies your node application to the container and then runs its. Creating a derivative of this image can be as simple as referencing it and specifying the port you want to expose.</p>
</blockquote>
<h2 id="build-and-push">Build and Push</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">docker</span> login</span><br></pre></td></tr></table></figure>
<p>This will run only once if we did not login</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -t csbun/docker-<span class="keyword">node</span><span class="identifier"></span><span class="title">-test</span> .</span><br><span class="line">...</span><br><span class="line">docker push csbun/docker-<span class="keyword">node</span><span class="identifier"></span><span class="title">-test</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Then u can see ur repo on <a href="https://registry.hub.docker.com/repos/" target="_blank" rel="external">Docker Hub</a> and <a href="https://kitematic.com/" target="_blank" rel="external">Kitematic</a></p>
<h2 id="run-a-web-app">Run a Web App</h2><h3 id="edit-project">Edit Project</h3><p>In this example we use <a href="http://koajs.com/" target="_blank" rel="external">Koa</a> as a server:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="tag">i</span> koa &#x2014;save</span><br></pre></td></tr></table></figure>
<p>Update index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&apos;use strict&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)();</span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> * (<span class="params">next</span>) </span>{</span><br><span class="line">  <span class="keyword">this</span>.body = <span class="string">&apos;Hello World&apos;</span>;</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> port = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line">app.listen(port, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&apos;Koa server listening on port &apos;</span> + port);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>Update Dockerfile</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM <span class="keyword">node</span><span class="identifier"></span><span class="title">:onbuild</span></span><br><span class="line">expose <span class="number">3000</span></span><br></pre></td></tr></table></figure>
<p>Here are something about <a href="https://docs.docker.com/reference/builder/#expose" target="_blank" rel="external">expose</a></p>
<h3 id="build-and-run">Build and Run</h3><p>This time, we build it in our local VM. First we need to get the IP of the virtual host:</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boot2docker </span><span class="literal">ip</span></span><br></pre></td></tr></table></figure>
<p>The VM&#x2019;s Host only interface IP address is: <code>192.168.59.103</code>. Then build and run:</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t docker-<span class="keyword">node</span><span class="identifier"></span><span class="title">-test</span> .</span><br><span class="line">...</span><br><span class="line">docker run --rm  -p <span class="number">40100</span>:<span class="number">3000</span> docker-<span class="keyword">node</span><span class="identifier"></span><span class="title">-test</span></span><br></pre></td></tr></table></figure>
<p>Now test it on <code>http://192.168.59.103:40100/</code>.</p>
<blockquote>
<p>If we use Kitematic, the ip of it is different from what we get from boot2docker.</p>
</blockquote>
<h2 id="stop-container">Stop Container</h2><p>See what&#x2019;s running in docker</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">docker</span> ps</span><br></pre></td></tr></table></figure>
<p>Then we can something like this:</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID        IMAGE                           ...</span><br><span class="line"><span class="number">678</span>e64c1fe45        docker-<span class="keyword">node</span><span class="identifier">-test:</span><span class="title">latest</span>   ...</span><br></pre></td></tr></table></figure>
<p>To stop this image, run</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop <span class="number">678e64</span>c1fe45</span><br></pre></td></tr></table></figure>
<h2 id="references">References</h2><ul>
<li><a href="http://blog.codefresh.io/up-and-running-with-io-js-and-docker/" target="_blank" rel="external">Up and running with io.js and Docker</a></li>
<li><a href="https://github.com/lukebond/requirelx-dockerlisbon-talk-2015-05/blob/master/requirelx-2015-05.md" target="_blank" rel="external">Introduction to Docker for the Node.js Developer</a></li>
<li><a href="https://github.com/wsargent/docker-cheat-sheet" target="_blank" rel="external">Docker Cheat Sheet</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="Install_Docker">Install Docker</h2><p>We can use docker CLI by install <a href="http://docs.docker.com/installation/mac/">Boot2Docker</a> or GUI via <a href="https://kitematic.com/">Kitematic</a></p>]]>
    
    </summary>
    
      <category term="Docker" scheme="http://csbun.github.io/blog/tags/Docker/"/>
    
      <category term="Node" scheme="http://csbun.github.io/blog/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ServiceWorker]]></title>
    <link href="http://csbun.github.io/blog/2015/06/service-worker/"/>
    <id>http://csbun.github.io/blog/2015/06/service-worker/</id>
    <published>2015-06-02T12:57:35.000Z</published>
    <updated>2015-10-27T10:11:56.000Z</updated>
    <content type="html"><![CDATA[<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x662F;&#x5355;&#x7EBF;&#x7A0B;&#x7684;&#xFF0C;&#x4F7F;&#x7528; ServiceWorker &#x53EF;&#x4EE5;&#x5728;&#x540E;&#x53F0;&#x521B;&#x5EFA;&#x8131;&#x79BB;&#x4E8E;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684; <a href="https://developer.mozilla.org/en-US/docs/Web/API/" target="_blank" rel="external">worker</a> &#x7EBF;&#x7A0B;&#xFF0C;&#x7528;&#x4E8E;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x4E00;&#x4E9B;&#x4E0E;&#x9875;&#x9762;&#x5143;&#x7D20;&#x3001;&#x754C;&#x9762;&#x4EA4;&#x4E92;&#x65E0;&#x5173;&#x7684;&#x5DE5;&#x4F5C;&#x3002;</p>
<a id="more"></a>
<h2 id="&#x8FD0;&#x884C;&#x73AF;&#x5883;">&#x8FD0;&#x884C;&#x73AF;&#x5883;</h2><h3 id="&#x6D4F;&#x89C8;&#x5668;&#x652F;&#x6301;">&#x6D4F;&#x89C8;&#x5668;&#x652F;&#x6301;</h3><ul>
<li>Chrome &gt;= 40.0</li>
<li>Firefox &gt;= 33.0</li>
<li>Opera &gt;= 24</li>
<li>IE&#x3001;Safari &#x4E0D;&#x652F;&#x6301;</li>
</ul>
<h3 id="&#x9700;&#x8981;-https">&#x9700;&#x8981; HTTPS</h3><p>&#x7531;&#x4E8E;&#x5B89;&#x5168;&#x95EE;&#x9898;&#xFF0C;ServiceWorker &#x53EA;&#x80FD;&#x5728; HTTPS &#x73AF;&#x5883;&#x4E0B;&#x8FD0;&#x884C;&#x3002;&#x4F46;&#x662F;&#x5728;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF0C;<code>localhost</code> &#x548C; <code>127.0.0.1</code> &#x4E5F;&#x662F;&#x5141;&#x8BB8;&#x7684;&#x3002;</p>
<h3 id="&#x8C03;&#x8BD5;">&#x8C03;&#x8BD5;</h3><p>Chrome DevTools &#x63D0;&#x4F9B;&#x4E86;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x8FD0;&#x884C;&#x4E2D;&#x7684; ServiceWorker &#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x6253;&#x5F00; <a href="chrome://inspect/#service-workers" target="_blank" rel="external">chrome://inspect/#service-workers</a> &#x5373;&#x53EF;&#x3002;</p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x5728;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;&#x7684; Sources &#x754C;&#x9762;&#x6709;&#x4E00;&#x4E2A; Service Workers &#x7684; tab&#xFF0C;&#x5728;&#x90A3;&#x4E5F;&#x53EF;&#x4EE5; Unregister &#x5F53;&#x524D;&#x4F7F;&#x7528;&#x7684; ServiceWorker&#x3002;</p>
<h2 id="&#x751F;&#x547D;&#x5468;&#x671F;">&#x751F;&#x547D;&#x5468;&#x671F;</h2><p>ServiceWorker &#x4E00;&#x822C;&#x4F1A;&#x7ECF;&#x5386;&#x4E0B;&#x9762;&#x4E00;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF1A;</p>
<ul>
<li>Download</li>
<li>Install</li>
<li>Activate</li>
</ul>
<p>&#x5F53;&#x6D4F;&#x89C8;&#x5668;&#x4E0B;&#x8F7D;&#x597D; ServiceWorker &#x4E4B;&#x540E;&#x4F1A;&#x9A6C;&#x4E0A; install&#xFF0C;install &#x6210;&#x529F;&#x540E;&#x6807;&#x8BB0;&#x4E3A; activated&#xFF0C;&#x4E4B;&#x540E;&#x8FDB;&#x5165;&#x95F2;&#x7F6E;&#x72B6;&#x6001;&#xFF0C;&#x7B49;&#x5F85;&#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x3002;&#x539F;&#x5219;&#x4E0A;&#xFF0C;&#x540C;&#x4E00;&#x4E2A; ServiceWorker &#x5728;&#x5176;&#x6CE8;&#x518C;&#xFF08;Register&#xFF09;&#x7684;&#x57DF;&#xFF08;Scope&#xFF09;&#x4E0B;&#x53EA;&#x4F1A; install &#x548C; activate &#x4E00;&#x6B21;&#xFF0C;&#x5373;&#x4FBF;&#x91CD;&#x65B0;&#x9875;&#x9762;&#x5237;&#x65B0;&#x3001;&#x540C;&#x65F6;&#x591A;&#x5F00;&#x90FD;&#x4E0D;&#x4F1A;&#xFF08;&#x56E0;&#x4E3A; ServiceWorker &#x662F;&#x5B8C;&#x5168;&#x8131;&#x79BB;&#x9875;&#x9762;&#x4E3B;&#x7EBF;&#x7A0B;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x7684;&#xFF09;&#x3002;</p>
<p>&#x6D4F;&#x89C8;&#x5668;&#x5728;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#x4F1A;&#x91CD;&#x65B0;&#x4E0B;&#x8F7D; ServiceWorker&#xFF08;MDN &#x4E0A;&#x8BF4;<a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker_API#Download.2C_install_and_activate" target="_blank" rel="external">&#x4E0D;&#x8D85;&#x8FC7;24&#x5C0F;&#x65F6;</a>&#xFF0C;&#x6211;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;&#xFF09;&#x3002;&#x82E5;&#x4E0B;&#x8F7D;&#x540E;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x6709;&#x66F4;&#x65B0;&#xFF0C;&#x4F1A;&#x5728;&#x540E;&#x53F0;&#x8FDB;&#x884C; install&#xFF0C;&#x4F46;&#x4E0D;&#x4F1A;&#x7ACB;&#x5373; activate &#x800C;&#x662F;&#x5904;&#x4E8E; waiting &#x72B6;&#x6001;&#x3002;&#x5F53;&#x6CA1;&#x6709;&#x9875;&#x9762;&#x52A0;&#x8F7D;&#x65E7;&#x7684; ServiceWorker &#x65F6;&#xFF0C;&#x65B0;&#x7684; ServiceWorker &#x624D;&#x4F1A; activate&#xFF08;&#x4F46;&#x6211;&#x5173;&#x6389; chrome &#x7684;&#x6240;&#x6709; tab &#x518D;&#x6253;&#x5F00;&#x5E76;&#x6CA1;&#x6709;&#x89E6;&#x53D1;&#x65B0;&#x7684; ServiceWorker&#xFF0C;&#x5927;&#x6982;&#x662F;&#x8FD8;&#x6CA1;&#x6709;&#x4E0B;&#x8F7D;&#x65B0;&#x7684;&#x6587;&#x4EF6;&#x5427;&#xFF0C;&#x6709;&#x5FC5;&#x8981;&#x5C31;&#x5728;&#x8C03;&#x8BD5;&#x5DE5;&#x5177;&#x4E2D;&#x5E72;&#x6389;&#x5C31;&#x597D;&#xFF09;&#x3002;</p>
<h2 id="&#x4F7F;&#x7528;-serviceworker">&#x4F7F;&#x7528; ServiceWorker</h2><h3 id="register">register</h3><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x9875;&#x9762;&#x4E0A;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x5F0F;&#x6CE8;&#x518C;&#xFF08;<a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/register" target="_blank" rel="external">register</a>&#xFF09;&#x4E00;&#x4E2A; ServiceWorker&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&apos;serviceWorker&apos;</span> <span class="keyword">in</span> navigator) {</span><br><span class="line">  navigator.serviceWorker.register(<span class="string">&apos;/sw-test/sw.js&apos;</span>, {</span><br><span class="line">    scope: <span class="string">&apos;/sw-test/&apos;</span></span><br><span class="line">  }).then(<span class="function"><span class="keyword">function</span> (<span class="params">reg</span>) </span>{</span><br><span class="line">    <span class="comment">// registration worked</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&apos;Registration succeeded. Scope is &apos;</span> + reg.scope);</span><br><span class="line">  }).catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">    <span class="comment">// registration failed</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&apos;Registration failed with &apos;</span> + error);</span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x91CC;&#x6307;&#x5B9A;&#x4E86; scope &#x662F; <code>/sw-test/</code>&#xFF0C;&#x4E0D;&#x6307;&#x5B9A;&#x7684;&#x8BDD;&#x9ED8;&#x8BA4;&#x662F;&#x6700;&#x540E;&#x8FD9;&#x4E2A; <code>.js</code> &#x6587;&#x4EF6;&#x6240;&#x5728;&#x7684; path&#xFF08;MDN &#x4E0A;&#x8BF4;&#x9ED8;&#x8BA4;&#x662F; <code>/</code> &#x662F;&#x4E0D;&#x5BF9;&#x7684;&#xFF09;&#xFF0C;&#x4F8B;&#x5982; <code>register(&apos;/s/w/sw.js&apos;)</code> &#x7684; scope &#x4E3A; <code>location.origin/s/w/</code>&#x3002;&#x800C;&#x4E14;&#x6307;&#x5B9A;&#x7684; scope &#x53EA;&#x80FD;&#x5728;&#x9ED8;&#x8BA4;&#x7684;&#x76EE;&#x5F55;&#x6216;&#x4E4B;&#x4E0B;&#xFF0C;&#x4E0D;&#x80FD;&#x5728;&#x5176;&#x7236;&#x7EA7;&#x76EE;&#x5F55;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x4E0D;&#x80FD;&#x8FD9;&#x6837; <code>register(&apos;/s/w/sw.js&apos;, {scope: &apos;/s/&apos;})</code>&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x8FD9;&#x4E2A;&#x5730;&#x5740;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x3002;</p>
<p><code>register()</code> &#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x4E00;&#x4E2A; <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="external">Promise</a>&#xFF0C;&#x5982;&#x679C;&#x80FD;&#x591F;&#x4E0B;&#x8F7D;&#x5230;&#x8FD9;&#x4E2A; <code>/sw-test/sw.js</code> &#x6587;&#x4EF6;&#x5C31;&#x4F1A;&#x8FDB;&#x5165; <code>then</code> &#x5426;&#x5219; <code>catch</code>&#x3002;</p>
<h3 id="install">install</h3><p>register &#x6210;&#x529F;&#x4E4B;&#x540E;&#x5C31;&#x4F1A;&#x89E6;&#x53D1; ServiceWorker &#x7684; <a href="https://developer.mozilla.org/en-US/docs/Web/API/InstallEvent" target="_blank" rel="external">install &#x4E8B;&#x4EF6;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x5728; <code>sw.js</code> &#x6587;&#x4EF6;&#x4E2D;&#x7ED1;&#x5B9A;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set the callback for the install step</span></span><br><span class="line"><span class="comment">// &#x8FD9;&#x91CC;&#x7684; `self` &#x5373;&#x4E3A;&#x5F53;&#x524D;&#x7684; ServiceWorker&#xFF0C;&#x7528; `this` &#x4E5F;&#x53EF;&#x4EE5;</span></span><br><span class="line">self.addEventListener(<span class="string">&apos;install&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>{</span><br><span class="line">    <span class="comment">// Perform install steps</span></span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x5728; ServiceWorker &#x91CC;&#x9762;&#x9700;&#x8981;&#x7F13;&#x5B58;&#x6216;&#x8005;&#x9884;&#x52A0;&#x8F7D;&#x4E00;&#x4E9B;&#x9759;&#x6001;&#x8D44;&#x6E90;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F00;&#x542F;&#x4E00;&#x4E2A; <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache" target="_blank" rel="external">cache</a> &#x6765;&#x4FDD;&#x5B58;&#x4ED6;&#x4EEC;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CACHE_NAME = <span class="string">&apos;v1&apos;</span>;</span><br><span class="line">self.addEventListener(<span class="string">&apos;install&apos;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>{</span><br><span class="line">  event.waitUntil(</span><br><span class="line">    caches.open(CACHE_NAME)</span><br><span class="line">      .then(<span class="function"><span class="keyword">function</span> (<span class="params">cache</span>) </span>{</span><br><span class="line">        cache.addAll(urlsToCache).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&apos;cache success.&apos;</span>);</span><br><span class="line">        });</span><br><span class="line">      }).catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">        <span class="comment">// TODO &#x6211;&#x5728; chrome &#x4E0A;&#x9762;&#x8DD1;&#x4F1A;&#x62A5; cache.addAll is not a function</span></span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">&apos;cache failed:&apos;</span>, error);</span><br><span class="line">      })</span><br><span class="line">  );</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h3 id="activate">activate</h3><p>&#x4E0A;&#x9762;&#x8BF4;&#x8FC7;&#x65E7;&#x7684; ServiceWorker &#x5168;&#x90E8;&#x5931;&#x6548;&#x540E;&#x65B0;&#x7684; ServiceWorker &#x624D;&#x4F1A; activated&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728; activate &#x65F6;&#x5C06;&#x65E7;&#x7684;&#x4E0D;&#x9700;&#x8981;&#x7684; cache &#x6E05;&#x9664;&#x6389;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> expectedCacheNames = [<span class="string">&apos;v2&apos;</span>, <span class="string">&apos;v3&apos;</span>];</span><br><span class="line">self.addEventListener(<span class="string">&apos;activate&apos;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>{</span><br><span class="line">  <span class="comment">// Active worker won&apos;t be treated as activated until promise resolves successfully.</span></span><br><span class="line">  event.waitUntil(</span><br><span class="line">    caches.keys().then(<span class="function"><span class="keyword">function</span> (<span class="params">cacheNames</span>) </span>{</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.all(</span><br><span class="line">        cacheNames.map(<span class="function"><span class="keyword">function</span> (<span class="params">cacheName</span>) </span>{</span><br><span class="line">          <span class="keyword">if</span> (expectedCacheNames.indexOf(cacheName) == -<span class="number">1</span>) {</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&apos;Deleting out of date cache:&apos;</span>, cacheName);</span><br><span class="line">            <span class="keyword">return</span> caches.delete(cacheName);</span><br><span class="line">          }</span><br><span class="line">        })</span><br><span class="line">      );</span><br><span class="line">    })</span><br><span class="line">  );</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h3 id="fetch">fetch</h3><p>&#x5728; ServiceWorker &#x95F2;&#x7F6E;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BA9;&#x5176;&#x76D1;&#x542C;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E0A;&#x7684; request&#xFF0C;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x4E00;&#x4E9B;&#x8BF7;&#x6C42;&#x7684;&#x8FD4;&#x56DE;&#x6570;&#x636E; cache &#x4E0B;&#x6765;&#xFF0C;&#x8FD9;&#x6837;&#x5373;&#x4F7F;&#x5E94;&#x7528;&#x5728;&#x79BB;&#x7EBF;&#x72B6;&#x6001;&#x4E0B;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x3002;&#xFF08;&#x542C;&#x8D77;&#x6765;&#x548C; Application Cache &#x597D;&#x50CF;&#x5416;&#xFF09;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CACHE_NAME = <span class="string">&apos;v1&apos;</span>;</span><br><span class="line">self.addEventListener(<span class="string">&apos;fetch&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> eventResponse = caches.match(event.request)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>{</span><br><span class="line">      <span class="comment">// &#x547D;&#x4E2D; cache&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span></span><br><span class="line">      <span class="keyword">if</span> (response) {</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="comment">// &#x6CA1;&#x6709;&#x547D;&#x4E2D;&#xFF0C;&#x5219;&#x514B;&#x9686;&#x4E00;&#x4E2A; request &#x51FA;&#x6765;&#xFF08;&#x56E0;&#x4E3A; request &#x662F; stream&#xFF09;</span></span><br><span class="line">      <span class="keyword">var</span> fetchRequest = event.request.clone();</span><br><span class="line">      <span class="comment">// &#x771F;&#x5B9E;&#x8BF7;&#x6C42;</span></span><br><span class="line">      <span class="keyword">return</span> fetch(fetchRequest).then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>{</span><br><span class="line">        <span class="comment">// &#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x53EA; cache &#x6709;&#x6548;&#x7684; response</span></span><br><span class="line">        <span class="keyword">if</span>(!response || response.status !== <span class="number">200</span> || response.type !== <span class="string">&apos;basic&apos;</span>) {</span><br><span class="line">          <span class="keyword">return</span> response;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// &#x56E0;&#x4E3A; response &#x662F; stream&#xFF0C;&#x6240;&#x4EE5;&#x8981; clone &#x8BA9;&#x6D4F;&#x89C8;&#x5668;&#x548C; cache &#x5206;&#x522B;&#x81EA;&#x884C;&#x5904;&#x7406;</span></span><br><span class="line">        <span class="keyword">var</span> responseToCache = response.clone();</span><br><span class="line">        <span class="comment">// &#x8BF7;&#x6C42;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x653E;&#x5165; cache</span></span><br><span class="line">        caches.open(CACHE_NAME).then(<span class="function"><span class="keyword">function</span> (<span class="params">cache</span>) </span>{</span><br><span class="line">          cache.put(event.request, responseToCache);</span><br><span class="line">        });</span><br><span class="line">        <span class="comment">// &#x540C;&#x65F6;&#x8F93;&#x51FA;</span></span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">      });</span><br><span class="line">    });</span><br><span class="line">  <span class="comment">// &#x54CD;&#x5E94; fetch &#x4E8B;&#x4EF6;&#x8F93;&#x51FA;</span></span><br><span class="line">  event.respondWith(eventResponse);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x91CC;&#x7684; fetch &#x4F1A;&#x5C06;&#x9875;&#x9762;&#x4E0A;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x90FD;&#x622A;&#x83B7;&#xFF0C;&#x5305;&#x62EC;&#x5F53;&#x524D;&#x9875;&#x9762;&#x7684; http&#x3001;img&#x3001;css&#x3001;script &#x548C; XMLHttpRequest &#x7B49;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x6211;&#x628A;&#x670D;&#x52A1;&#x505C;&#x6389;&#xFF0C;&#x5237;&#x65B0;&#x9875;&#x9762;&#x65F6;&#x90FD;&#x80FD;&#x6B63;&#x5E38;&#x8BBF;&#x95EE;&#xFF01;&#x56E0;&#x4E3A;&#x4E0A;&#x8FF0;&#x8D44;&#x6E90;&#x90FD;&#x88AB; cache &#x4E86;&#xFF0C;&#x4E0D;&#x4F1A;&#x6709;&#x8BF7;&#x6C42;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x56E0;&#x6B64;&#x66F4;&#x65B0;&#x9875;&#x9762;&#x4E4B;&#x540E;&#x4E5F;&#x4E0D;&#x4F1A;&#x7ACB;&#x5373;&#x66F4;&#x65B0;&#xFF01;&#x56E0;&#x6B64;&#x4F7F;&#x7528;&#x9700;&#x8C28;&#x614E;&#xFF0C;&#x6216;&#x8005;&#x66F4;&#x6539;&#x903B;&#x8F91;&#xFF0C;&#x533A;&#x5206;&#x8D44;&#x6E90;&#xFF0C;&#x4E0D;&#x8981;&#x5168;&#x90E8;&#x90FD; cache&#x3002;</p>
<h2 id="&#x53C2;&#x8003;&#x8D44;&#x6599;">&#x53C2;&#x8003;&#x8D44;&#x6599;</h2><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker" target="_blank" rel="external">ServiceWorker on MDN</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker_API" target="_blank" rel="external">ServiceWorker API on MDN</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker_API/Using_Service_Workers" target="_blank" rel="external">Using Service Workers</a></li>
<li><a href="http://www.html5rocks.com/en/tutorials/service-worker/introduction/" target="_blank" rel="external">Introduction to Service Worker</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>我们知道，浏览器是单线程的，使用 ServiceWorker 可以在后台创建脱离于主线程的 <a href="https://developer.mozilla.org/en-US/docs/Web/API/">worker</a> 线程，用于异步处理一些与页面元素、界面交互无关的工作。</p>]]>
    
    </summary>
    
      <category term="ServiceWorker" scheme="http://csbun.github.io/blog/tags/ServiceWorker/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[用 MutationObserver 和 Mutation events 监听 DOM 变化]]></title>
    <link href="http://csbun.github.io/blog/2015/05/mutation-observer-and-event/"/>
    <id>http://csbun.github.io/blog/2015/05/mutation-observer-and-event/</id>
    <published>2015-05-13T06:44:37.000Z</published>
    <updated>2015-10-27T10:12:01.000Z</updated>
    <content type="html"><![CDATA[<p>&#x6700;&#x8FD1;&#x9700;&#x8981;&#x505A;&#x4E00;&#x4E2A;&#x529F;&#x80FD;&#xFF0C;&#x68C0;&#x67E5;&#x9875;&#x9762; DOM &#x53D8;&#x5316;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x53D8;&#x5316;&#x7684;&#x67D0;&#x4E9B; DOM &#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x3002;&#x4E8E;&#x662F;&#x4E0A;&#x7F51;&#x641C;&#x7D22;&#x5230; <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver" target="_blank" rel="external">MutationObserver</a>&#xFF0C;&#x4E2D;&#x6587;&#x6587;&#x6863;&#x5DF2;&#x7ECF;&#x5F88;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x4F7F;&#x7528;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4E8E;&#x662F;&#x5C31;&#x5199;&#x4E0B;&#x8FD9;&#x4E48;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF1A;</p>
<a id="more"></a>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observeDOMChanges = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="comment">// &#x5BF9;&#x53D8;&#x5316;&#x7684; dom &#x7684;&#x64CD;&#x4F5C;</span></span><br><span class="line">    <span class="keyword">var</span> changedHandler = <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>{</span><br><span class="line">        <span class="comment">// do with element ...</span></span><br><span class="line">    };</span><br><span class="line">    <span class="comment">// &#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x524D;&#x7F00;</span></span><br><span class="line">    <span class="keyword">var</span> MutationObserver = <span class="built_in">window</span>.MutationObserver ||</span><br><span class="line">                           <span class="built_in">window</span>.WebKitMutationObserver ||</span><br><span class="line">                           <span class="built_in">window</span>.MozMutationObserver;</span><br><span class="line">    <span class="comment">// MutationObserver &#x914D;&#x7F6E;</span></span><br><span class="line">    <span class="keyword">var</span> MutationObserverConfig = {</span><br><span class="line">        <span class="comment">// &#x76D1;&#x542C;&#x5B50;&#x8282;&#x70B9;</span></span><br><span class="line">        childList: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// &#x76D1;&#x542C; href &#x5C5E;&#x6027;</span></span><br><span class="line">        attributes: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// &#x76D1;&#x542C;&#x6574;&#x68F5;&#x6811;</span></span><br><span class="line">        subtree: <span class="literal">true</span></span><br><span class="line">    };</span><br><span class="line">    <span class="comment">// &#x76D1;&#x542C;&#x5668;</span></span><br><span class="line">    <span class="keyword">var</span> observer = MutationObserver ? <span class="keyword">new</span> MutationObserver(<span class="function"><span class="keyword">function</span> (<span class="params">mutations</span>) </span>{</span><br><span class="line">        mutations.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">mutation</span>) </span>{</span><br><span class="line">            <span class="comment">// &#x5904;&#x7406; &#x53D8;&#x5316;&#x7684; DOM</span></span><br><span class="line">            changedHandler(mutation.target);</span><br><span class="line">            <span class="comment">// &#x5904;&#x7406; &#x65B0;&#x589E;&#x7684; DOM</span></span><br><span class="line">            <span class="keyword">if</span> (mutation.addedNodes) {</span><br><span class="line">                mutation.addedNodes.forEach(changedHandler);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// &#x5220;&#x9664;&#x7684; DOM &#x65E0;&#x9700;&#x5904;&#x7406; (mutation.removedNodes)</span></span><br><span class="line">        });</span><br><span class="line">    }) : <span class="literal">undefined</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> observer ? <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">            observer.observe(<span class="built_in">document</span>.body, MutationObserverConfig);</span><br><span class="line">        } : <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&apos;MutationObserver not support!&apos;</span>);</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">})();</span><br></pre></td></tr></table></figure>
<p>&#x4F46;&#x662F;&#x770B;&#x770B;&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;&#x60C5;&#x51B5;&#xFF0C;IE &#x8981; 11+ &#x5416;&#xFF01;&#x641E;&#x4E0D;&#x6765;&#xFF0C;&#x4E8E;&#x662F;&#x53EA;&#x80FD;&#x628A;&#x88AB;&#x629B;&#x5F03;&#x7684; <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events" target="_blank" rel="external">Mutation events</a> &#x6361;&#x8FC7;&#x6765;&#xFF0C;&#x636E;&#x8BF4;&#x6027;&#x80FD;&#x4E5F;&#x4E0D;&#x662F;&#x5F88;&#x597D;&#x3002;</p>
<blockquote>
<p>This feature has been removed from the Web. Though some browsers may still support it, it is in the process of being dropped. Do not use it in old or new projects. Pages or Web apps using it may break at any time.</p>
</blockquote>
<p>&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observeDOMChanges = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">var</span> bindMutationEvents = <span class="function"><span class="keyword">function</span> (<span class="params">eventName</span>) </span>{</span><br><span class="line">        <span class="built_in">document</span>.body.addEventListener(eventName, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>{</span><br><span class="line">            changedHandler(e.target);</span><br><span class="line">        });</span><br><span class="line">    };</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        bindMutationEvents(<span class="string">&apos;DOMSubtreeModified&apos;</span>);</span><br><span class="line">        bindMutationEvents(<span class="string">&apos;DOMNodeInserted&apos;</span>);</span><br><span class="line">    };</span><br><span class="line">})();</span><br></pre></td></tr></table></figure>
<p>&#x56E0;&#x4E3A; Mutation events &#x4E5F;&#x53EA;&#x652F;&#x6301;&#x5230; IE9+&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; <code>addEventListener</code> &#x6765;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#xFF0C;&#x5C06;&#x517C;&#x5BB9;&#x5224;&#x65AD;&#x52A0;&#x8D77;&#x6765;&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observeDOMChanges = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="comment">// &#x5BF9;&#x53D8;&#x5316;&#x7684; dom &#x7684;&#x64CD;&#x4F5C;</span></span><br><span class="line">    <span class="keyword">var</span> changedHandler = <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>{</span><br><span class="line">        <span class="comment">// do with element ...</span></span><br><span class="line">    };</span><br><span class="line">    <span class="comment">// &#x68C0;&#x67E5; MutationObserver &#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;</span></span><br><span class="line">    <span class="keyword">var</span> MutationObserver = <span class="built_in">window</span>.MutationObserver ||</span><br><span class="line">                           <span class="built_in">window</span>.WebKitMutationObserver ||</span><br><span class="line">                           <span class="built_in">window</span>.MozMutationObserver;</span><br><span class="line">    <span class="keyword">if</span> (MutationObserver) {</span><br><span class="line">        <span class="comment">// MutationObserver &#x914D;&#x7F6E;</span></span><br><span class="line">        <span class="keyword">var</span> MutationObserverConfig = {</span><br><span class="line">            <span class="comment">// &#x76D1;&#x542C;&#x5B50;&#x8282;&#x70B9;</span></span><br><span class="line">            childList: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">// &#x76D1;&#x542C; href &#x5C5E;&#x6027;</span></span><br><span class="line">            attributes: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">// &#x76D1;&#x542C;&#x6574;&#x68F5;&#x6811;</span></span><br><span class="line">            subtree: <span class="literal">true</span></span><br><span class="line">        };</span><br><span class="line">        <span class="comment">// &#x76D1;&#x542C;&#x5668;</span></span><br><span class="line">        <span class="keyword">var</span> observer = <span class="keyword">new</span> MutationObserver(<span class="function"><span class="keyword">function</span> (<span class="params">mutations</span>) </span>{</span><br><span class="line">            mutations.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">mutation</span>) </span>{</span><br><span class="line">                <span class="comment">// &#x5904;&#x7406; &#x53D8;&#x5316;&#x7684; DOM</span></span><br><span class="line">                changedHandler(mutation.target);</span><br><span class="line">                <span class="comment">// &#x5904;&#x7406; &#x65B0;&#x589E;&#x7684; DOM</span></span><br><span class="line">                <span class="keyword">if</span> (mutation.addedNodes) {</span><br><span class="line">                    mutation.addedNodes.forEach(changedHandler);</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// &#x5220;&#x9664;&#x7684; DOM &#x65E0;&#x9700;&#x5904;&#x7406; (mutation.removedNodes)</span></span><br><span class="line">            });</span><br><span class="line">        });</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">            <span class="comment">// &#x5F00;&#x59CB;&#x76D1;&#x542C;</span></span><br><span class="line">            observer.observe(<span class="built_in">document</span>.body, MutationObserverConfig);</span><br><span class="line">        };</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.body.addEventListener) {</span><br><span class="line">        <span class="comment">// addEventListener &#x548C; Mutation events &#x90FD;&#x662F; IE 9 &#x4EE5;&#x4E0A;&#x624D;&#x652F;&#x6301;</span></span><br><span class="line">        <span class="keyword">var</span> bindMutationEvents = <span class="function"><span class="keyword">function</span> (<span class="params">eventName</span>) </span>{</span><br><span class="line">            <span class="built_in">document</span>.body.addEventListener(eventName, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>{</span><br><span class="line">                changedHandler(e.target);</span><br><span class="line">            });</span><br><span class="line">        };</span><br><span class="line">        <span class="keyword">var</span> binded = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">            <span class="keyword">if</span> (binded) {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            binded = <span class="literal">true</span>;</span><br><span class="line">            bindMutationEvents(<span class="string">&apos;DOMSubtreeModified&apos;</span>);</span><br><span class="line">            bindMutationEvents(<span class="string">&apos;DOMNodeInserted&apos;</span>);</span><br><span class="line">        };</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// IE 8- &#x5C31;&#x4E0D;&#x7BA1;&#x4E86;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&apos;MutationObserver not support!&apos;</span>);</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">})();</span><br></pre></td></tr></table></figure>
<p>&#x55EF;&#xFF0C;IE8- &#x600E;&#x4E48;&#x5C31;&#x53EF;&#x4EE5;&#x653E;&#x5F03;&#x4E86;&#x5462;&#xFF1F;&#x4F46;&#x662F;&#x5B9E;&#x5728;&#x662F;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x7528; <code>setTimeout</code> &#x5B9A;&#x65F6;&#x53BB;&#x68C0;&#x67E5;&#x5427;&#xFF0C;&#x4F46;&#x4F30;&#x8BA1;&#x5199;&#x8D77;&#x6765;&#x53C8;&#x4E00;&#x5927;&#x5806;&#x4E86; &#x256E;(&#x256F;_&#x2570;)&#x256D;</p>
<p>&#x53E6;&#x5916;&#x5728;&#x5410;&#x69FD;&#x4E00;&#x70B9;&#xFF0C;Mutation events &#x5728; webkit &#x4E0A;&#x652F;&#x6301;&#x7684;&#x60C5;&#x51B5;&#x548C; IE &#x4E0A;&#x662F;&#x4E0D;&#x540C;&#x7684;&#xFF0C;<code>DOMSubtreeModified</code> &#x5728; IE &#x4E0A;&#x53EF;&#x4EE5;&#x76D1;&#x542C;&#x5230; attr &#x53D8;&#x5316;&#x7684;&#xFF0C;&#x4F46; webkit &#x4E0A;&#x662F;&#x4E0D;&#x884C;&#xFF08;&#x4E0D;&#x7528; MutationObserver &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF09;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// definition ...</span></span><br><span class="line">observeDOMChanges();</span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="keyword">var</span> el = <span class="built_in">document</span>.createElement(<span class="string">&apos;a&apos;</span>);</span><br><span class="line"><span class="comment">// works in IE and webkit via `DOMNodeInserted`</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(el);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="comment">// &lt;a&gt; -&gt; &lt;a href=&quot;xxx&quot;&gt;</span></span><br><span class="line">    <span class="comment">// works in IE and webkit via `DOMSubtreeModified`</span></span><br><span class="line">    el.href = <span class="string">&apos;path/to/somewhere&apos;</span>;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">        <span class="comment">// &lt;a href=&quot;a&quot;&gt; -&gt; &lt;a href=&quot;b&quot;&gt;</span></span><br><span class="line">        <span class="comment">// works in IE via `DOMSubtreeModified`</span></span><br><span class="line">        <span class="comment">// NOT works in webkit</span></span><br><span class="line">        el.href = <span class="string">&apos;path/to/somewhere/else&apos;</span>;</span><br><span class="line">    }, <span class="number">1000</span>);</span><br><span class="line">}, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>&#x6240;&#x4EE5;&#xFF0C;wekit &#x5185;&#x6838;&#x8001;&#x8001;&#x5B9E;&#x5B9E;&#x7528; MutationObserver&#xFF0C;&#x662F;&#x6700;&#x597D;&#x7684;&#x3002;&#x4F46;&#x67D0;&#x4E9B; webkit &#x5185;&#x6838;&#x6D4F;&#x89C8;&#x5668;&#x65E2;&#x4E0D;&#x652F;&#x6301; MutationObserver&#xFF0C;Mutation events &#x53C8;&#x652F;&#x6301;&#x4E0D;&#x597D;&#xFF0C;&#x8001;&#x8872;&#x5C31;&#x65E0;&#x80FD;&#x4E3A;&#x529B;&#x4E86;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x63D0;&#x9192;&#x4E00;&#x70B9;&#xFF1A;&#x76D1;&#x542C; DOM &#x53D8;&#x5316;&#x4FEE;&#x6539; DOM &#x6709;&#x98CE;&#x9669;&#xFF0C;&#x5BB9;&#x6613;&#x9020;&#x6210;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#xFF0C;&#x4E0A;&#x8FF0;&#x4F8B;&#x5B50;&#x7684; <code>changedHandler</code> &#x5FC5;&#x987B;&#x505A;&#x597D;&#x5224;&#x65AD;&#xFF0C;&#x907F;&#x514D;&#x9677;&#x5165;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x4E2D;&#x3002;</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>最近需要做一个功能，检查页面 DOM 变化，然后对变化的某些 DOM 进行一些操作。于是上网搜索到 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver">MutationObserver</a>，中文文档已经很清楚了，看起来使用也很简单，于是就写下这么一个方法：</p>]]>
    
    </summary>
    
      <category term="DOM" scheme="http://csbun.github.io/blog/tags/DOM/"/>
    
      <category term="Mutation Observer" scheme="http://csbun.github.io/blog/tags/Mutation-Observer/"/>
    
      <category term="events" scheme="http://csbun.github.io/blog/tags/events/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用 Selenium 进行 UI 测试]]></title>
    <link href="http://csbun.github.io/blog/2015/04/use-selenium-for-ui-test/"/>
    <id>http://csbun.github.io/blog/2015/04/use-selenium-for-ui-test/</id>
    <published>2015-04-16T09:58:21.000Z</published>
    <updated>2015-10-27T10:07:15.000Z</updated>
    <content type="html"><![CDATA[<p><code>&#x6CE8;&#xFF1A;</code> &#x672C;&#x6587;<strong>&#x672A;&#x5B8C;&#x6210;</strong>&#x3002;<br>&#x770B;&#x770B;&#x8FD9;&#x4E2A; <a href="http://csbun.github.io/blog/browser-perf/selenium/performance/2015/02/10/use-browser-perf.html">http://csbun.github.io/blog/browser-perf/selenium/performance/2015/02/10/use-browser-perf.html</a> &#x4E5F;&#x7528;&#x4E86; Selenium</p>
<a id="more"></a>
<h2 id="&#x51C6;&#x5907;&#x73AF;&#x5883;">&#x51C6;&#x5907;&#x73AF;&#x5883;</h2><p><a href="http://www.seleniumhq.org/" target="_blank" rel="external">Selenium</a> &#x867D;&#x7136;&#x5B98;&#x7F51;&#x505A;&#x5F97;&#x5F88;&#x4E11;&#xFF0C;&#x4F46;&#x662F;&#x4ED6;&#x6240;&#x652F;&#x6301;&#x7684;&#x73AF;&#x5883;&#x8FD8;&#x662F;&#x5F88;&#x5168;&#x9762;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x6211;&#x5728; node &#x4E0A;&#x7684;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; npm &#x9879;&#x76EE;&#xFF0C;&#x7136;&#x540E;&#x4E0B;&#x8F7D; <a href="https://www.npmjs.com/package/selenium-webdriver" target="_blank" rel="external">selenium-webdriver</a></p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> init</span><br><span class="line"><span class="built_in">npm</span> i --save selenium-webdriver</span><br></pre></td></tr></table></figure>
<h2 id="&#x6700;&#x7B80;&#x5355;&#x7684;&#x6D4B;&#x8BD5;">&#x6700;&#x7B80;&#x5355;&#x7684;&#x6D4B;&#x8BD5;</h2><p>&#x55EF;&#xFF0C;&#x5B89;&#x88C5; npm &#x4E0A;&#x7684;&#x4ECB;&#x7ECD;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x5199;&#x4E00;&#x4E9B;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x4E86;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; index.js&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webdriver = <span class="built_in">require</span>(<span class="string">&apos;selenium-webdriver&apos;</span>),</span><br><span class="line">    By = <span class="built_in">require</span>(<span class="string">&apos;selenium-webdriver&apos;</span>).By,</span><br><span class="line">    until = <span class="built_in">require</span>(<span class="string">&apos;selenium-webdriver&apos;</span>).until;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> driver = <span class="keyword">new</span> webdriver.Builder()</span><br><span class="line">    .forBrowser(<span class="string">&apos;firefox&apos;</span>)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">&apos;http://www.google.com/ncr&apos;</span>);</span><br><span class="line">driver.findElement(By.name(<span class="string">&apos;q&apos;</span>)).sendKeys(<span class="string">&apos;webdriver&apos;</span>);</span><br><span class="line">driver.findElement(By.name(<span class="string">&apos;btnG&apos;</span>)).click();</span><br><span class="line">driver.wait(until.titleIs(<span class="string">&apos;webdriver - Google Search&apos;</span>), <span class="number">1000</span>);</span><br><span class="line">driver.quit();</span><br></pre></td></tr></table></figure>
<p>&#x8FD0;&#x884C; <code>node index.js</code> &#x5C31;&#x4F1A;&#x770B;&#x5230;&#x4F60;&#x7684; Firefox &#x5F39;&#x51FA;&#x6765;&#x7136;&#x540E;&#x6253;&#x5F00;&#x4E86; google &#x9996;&#x9875;&#xFF0C;&#x63A5;&#x7740;&#x641C;&#x7D22;&#x4E86; &#x2018;webdriver&#x2019; &#x4E4B;&#x540E;&#x5C31;&#x5173;&#x95ED;&#x4E86;&#x3002;</p>
<blockquote>
<p>&#x5047;&#x5982;&#x4F60;&#x7684;&#x7F51;&#x901F;&#x4E0D;&#x591F;&#x5FEB;&#xFF0C;&#x5728; 1000ms &#x5185;&#x8FD8;&#x6CA1;&#x8DF3;&#x8F6C;&#x5230;&#x641C;&#x7D22;&#x9875;&#xFF08;until.titleIs(&#x2018;webdriver - Google Search&#x2019;)&#xFF09;&#x5C31;&#x4F1A;&#x7206;&#x4E00;&#x4E2A; timeout &#x7684;&#x9519;&#x8BEF;&#x3002;</p>
</blockquote>
<h2 id="firefox-ide">Firefox IDE</h2><p>&#x4E0D;&#x60F3;&#x5199;&#x4EE3;&#x7801;&#x7684;&#x8BDD;&#xFF0C;&#x8FD8;&#x6709; <a href="http://www.seleniumhq.org/projects/ide/" target="_blank" rel="external">Selenium IDE</a> &#x53EF;&#x4EE5;&#x7528;&#x3002;&#x88C5;&#x5230; Firefox &#x91CC;&#x9762;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x70B9;&#x51FB;&#x63D2;&#x4EF6;&#x6309;&#x94AE;&#x5F39;&#x51FA;&#x5DE5;&#x5177;&#x6846;&#xFF0C;&#x7136;&#x540E;&#x9009;&#x62E9;&#x9700;&#x8981;&#x7684; Command &#x7B49;&#xFF0C;&#x6267;&#x884C;&#x4E5F;&#x80FD;&#x5728; Log &#x4E2D;&#x770B;&#x5230;&#x6267;&#x884C;&#x6548;&#x679C;&#x3002;</p>
<h2 id="&#x6DFB;&#x52A0;-webdriver">&#x6DFB;&#x52A0; webdriver</h2><p>&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x7528;&#x5230;&#x7684;&#x662F;&#x9ED8;&#x8BA4;&#x7684; Firefox&#xFF0C;&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;&#x522B;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5C31;&#x5F97;&#x4E0B;&#x8F7D;&#x4E00;&#x4E2A;&#x6269;&#x5C55;&#x7684; webdriver&#xFF0C;&#x5B98;&#x7F51;&#x4E0A;&#x7684; <a href="http://www.seleniumhq.org/download/" target="_blank" rel="external">Third Party Browser Drivers</a> &#x53EF;&#x4EE5;&#x4E0B;&#x8F7D;&#x5F97;&#x5230;&#x3002;&#x89E3;&#x538B;&#x4E0B;&#x6765;&#x662F;&#x4E2A;&#x53EF;&#x6267;&#x884C;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5B98;&#x65B9;&#x5EFA;&#x8BAE;&#x653E;&#x5728;&#x73AF;&#x5883;&#x53D8;&#x91CF; PATH &#x76EE;&#x5F55;&#x4E0B;&#x3002;&#x4F46;&#x6211;&#x6CA1;&#x8FD9;&#x4E48;&#x505A;&#xFF08;&#x6211;&#x5C31;&#x662F;&#x60F3;&#x8BD5;&#x8BD5;&#x800C;&#x5DF2;&#xFF09;&#xFF0C;&#x6211;&#x76F4;&#x63A5;&#x628A;&#x89E3;&#x538B;&#x51FA;&#x6765;&#x7684; <a href="http://chromedriver.storage.googleapis.com/index.html?path=2.15/" target="_blank" rel="external">chromedriver</a> &#x653E;&#x5728;&#x6267;&#x884C; node &#x7684;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x8FBE;&#x5230;&#x540C;&#x6837;&#x7684;&#x6548;&#x679C;&#x3002;</p>
<p>&#x7136;&#x540E;&#x4FEE;&#x6539;&#x4E00;&#x4E0B; index.js </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> driver = <span class="keyword">new</span> webdriver.Builder()</span><br><span class="line">    .forBrowser(<span class="string">&apos;chrome&apos;</span>)</span><br></pre></td></tr></table></figure>
<p>&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x65F6;&#x5F39;&#x51FA;&#x6765;&#x7684;&#x5C31;&#x662F; chrome &#x4E86;&#x3002;</p>
<h3 id="selenium-for-android">Selenium for Android</h3><p>TODO <a href="http://selendroid.io/" target="_blank" rel="external">selendroid</a><br>&#x8FD9;&#x90E8;&#x5206;&#x6709;&#x70B9;&#x9EBB;&#x70E6;&#xFF0C;&#x540E;&#x7EED;&#x518D;&#x505A;&#x3002;</p>
<h2 id="the-standalone-selenium-server">The Standalone Selenium Server</h2><p>&#x5982;&#x679C;&#x5168;&#x90E8;&#x5DE5;&#x4F5C;&#x90FD;&#x662F;&#x5728;&#x5F53;&#x524D;&#x4E00;&#x53F0;&#x673A;&#x5668;&#x4E0A;&#x5B8C;&#x6210;&#xFF0C;&#x5176;&#x5B9E;&#x4E0D;&#x9700;&#x8981; Selenium Server&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5C06;&#x8FD9;&#x4E9B;&#x4E1C;&#x897F;&#x90E8;&#x7F72;&#x5728;&#x67D0;&#x4E2A;&#x8FDC;&#x7A0B;&#x673A;&#x5668;&#x4E0A;&#xFF0C;&#x53C8;&#x6CA1;&#x529E;&#x6CD5;&#x8FD0;&#x884C;&#x5176;&#x547D;&#x4EE4;&#x884C;&#xFF0C;&#x90A3;&#x4E48; Selenium Server &#x5C31;&#x63D0;&#x4F9B;&#x4E86;&#x8FD9;&#x4E48;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x7684; proxy&#xFF0C;&#x8BA9;&#x4F60;&#x53EF;&#x4EE5;&#x8FDC;&#x7A0B;&#x8FD0;&#x884C;&#x4F60;&#x7684;&#x6D4B;&#x8BD5;&#x811A;&#x672C;&#x3002;&#xFF08;&#x5B98;&#x7F51;&#x8FD8;&#x4ECB;&#x7ECD;&#x4E86;<a href="http://www.seleniumhq.org/docs/03_webdriver.jsp#webdriver-and-the-selenium-server" target="_blank" rel="external">&#x5176;&#x4ED6;&#x60C5;&#x51B5;</a>&#xFF09;</p>
<h3 id="&#x5B89;&#x88C5;&#x53CA;&#x542F;&#x52A8;">&#x5B89;&#x88C5;&#x53CA;&#x542F;&#x52A8;</h3><p>&#x5728;&#x5B89;&#x88C5;&#x53EF; JDK&#x4E4B;&#x540E;&#xFF0C;&#x5728;<a href="http://selenium-release.storage.googleapis.com/index.html" target="_blank" rel="external">&#x8FD9;&#x91CC;&#x4E0B;&#x8F7D;</a>&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684; jar &#x5305;&#xFF08;&#x5047;&#x8BBE;&#x6211;&#x73B0;&#x5728;&#x4E0B;&#x8F7D;&#x7684;&#x662F; 2.45&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">java</span> <span class="tag">-jar</span> <span class="tag">selenium-server-standalone-2</span><span class="class">.45</span><span class="class">.0</span><span class="class">.jar</span></span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x65F6;&#x5019;&#x8BBF;&#x95EE; <a href="http://localhost:4444/wd/hub" target="_blank" rel="external">http://localhost:4444/wd/hub</a> &#x5C31;&#x80FD;&#x770B;&#x5230; Server &#x4E86;&#xFF01;</p>
<h3 id="&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;">&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;</h3><p>&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6709; chromedriver&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x754C;&#x9762;&#x4E0A; <strong>Create Session</strong> &#x9009;&#x62E9; Browser &#x4E3A; <strong>chrome</strong>&#x3002;</p>
<p>TODO &#x6CA1;&#x641E;&#x61C2;&#x600E;&#x4E48;&#x7528;</p>
<h2 id="&#x53C2;&#x8003;&#x8D44;&#x6599;">&#x53C2;&#x8003;&#x8D44;&#x6599;</h2><ul>
<li><a href="https://github.com/fool2fish" target="_blank" rel="external">&#x6C89;&#x9C7C;</a> &#x7FFB;&#x8BD1;&#x7684; <a href="https://github.com/fool2fish/selenium-doc" target="_blank" rel="external">selenium &#x4E2D;&#x6587;&#x6587;&#x6863;</a></li>
<li><a href="http://randomjavascript.blogspot.co.uk/2015/04/look-no-hands-using-selenium-and-nodejs.html" target="_blank" rel="external">Look! No Hands! - Using Selenium and Node.js for interactive UI testing</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p><code>注：</code> 本文<strong>未完成</strong>。<br>看看这个 <a href="http://csbun.github.io/blog/browser-perf/selenium/performance/2015/02/10/use-browser-perf.html">http://csbun.github.io/blog/browser-perf/selenium/performance/2015/02/10/use-browser-perf.html</a> 也用了 Selenium</p>]]>
    
    </summary>
    
      <category term="Selenium" scheme="http://csbun.github.io/blog/tags/Selenium/"/>
    
      <category term="test" scheme="http://csbun.github.io/blog/tags/test/"/>
    
      <category term="ui" scheme="http://csbun.github.io/blog/tags/ui/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[用 navigator.permissions 检查浏览器权限]]></title>
    <link href="http://csbun.github.io/blog/2015/04/navigator-permissions/"/>
    <id>http://csbun.github.io/blog/2015/04/navigator-permissions/</id>
    <published>2015-04-15T13:27:51.000Z</published>
    <updated>2015-10-27T10:07:30.000Z</updated>
    <content type="html"><![CDATA[<p>Chrome 43 &#x589E;&#x52A0;&#x4E86; <code>navigator.permissions</code> &#x63A5;&#x53E3;&#x7528;&#x4E8E;&#x68C0;&#x67E5;&#x5F53;&#x524D;&#x6D4F;&#x89C8;&#x5668;&#x6743;&#x9650;&#x72B6;&#x6001;&#x3002;</p>
<a id="more"></a>
<p><code>query()</code> &#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x6307;&#x5B9A;&#x7684;&#x6743;&#x9650;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x662F; ES6 &#x7684; Promise &#x5BF9;&#x8C61;&#xFF0C;&#x800C; permission &#x7684;&#x503C;&#x6709;&#xFF1A;</p>
<ul>
<li>granted: the user has explicitly accepted the application to send notification</li>
<li>denied: the user has explicitly denied the application to send notification</li>
<li>default: the user decision is unknown, but the application will act as if denied were picked</li>
</ul>
<blockquote>
<p>&#x6211;&#x5728; 44.0.2367.0 canary (64-bit) &#x6D4B;&#x8BD5;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x5E76;&#x4E0D;&#x662F; <code>default</code> &#x800C;&#x662F; <code>prompt</code>&#x3002;<br>&#x76EE;&#x524D; Firefox &#x548C; Safari &#x8C8C;&#x4F3C;&#x8FD8;&#x6CA1;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x3002;</p>
</blockquote>
<p>&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x67E5;&#x770B;&#x662F;&#x5426;&#x6709; geolocation &#x6743;&#x9650;&#xFF0C;&#x4E14;&#x76D1;&#x542C;&#x8BE5;&#x6743;&#x9650;&#x7684;&#x53D8;&#x5316;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">navigator.permissions.query({</span><br><span class="line">  name: <span class="string">&apos;geolocation&apos;</span></span><br><span class="line">}).then(<span class="function"><span class="keyword">function</span> (<span class="params">permissionStatus</span>) </span>{</span><br><span class="line">  <span class="comment">// &#x5F53;&#x524D;&#x6743;&#x9650;</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&apos;geolocation permission status is &apos;</span>, permissionStatus.status);</span><br><span class="line">  <span class="comment">// &#x76D1;&#x542C;&#x6539;&#x53D8;</span></span><br><span class="line">  permissionStatus.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&apos;geolocation permission status has changed to &apos;</span>, <span class="keyword">this</span>.status);</span><br><span class="line">  };</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>&#x53C2;&#x8003;&#x6587;&#x7AE0;&#xFF1A;</p>
<p><a href="http://updates.html5rocks.com/2015/04/permissions-api-for-the-web" target="_blank" rel="external">Permissions API for the Web</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Chrome 43 增加了 <code>navigator.permissions</code> 接口用于检查当前浏览器权限状态。</p>]]>
    
    </summary>
    
      <category term="permissions" scheme="http://csbun.github.io/blog/tags/permissions/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用 NW.js 创建桌面应用]]></title>
    <link href="http://csbun.github.io/blog/2015/03/create-desktop-app-with-nwjs/"/>
    <id>http://csbun.github.io/blog/2015/03/create-desktop-app-with-nwjs/</id>
    <published>2015-03-10T11:50:29.000Z</published>
    <updated>2015-10-27T10:07:35.000Z</updated>
    <content type="html"><![CDATA[<p>&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x7B80;&#x5355;&#x7814;&#x7A76;&#x4E86;&#x4E00;&#x4E0B; <a href="http://nwjs.io/" target="_blank" rel="external">NW.js</a>&#xFF0C;&#x57FA;&#x4E8E; Chromium &#x548C; node.js&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Web &#x6280;&#x672F;&#x6765;&#x7F16;&#x5199;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#x684C;&#x9762;&#x5E94;&#x7528;&#x3002;</p>
<a id="more"></a>
<h2 id="&#x5B89;&#x88C5;">&#x5B89;&#x88C5;</h2><p>&#x5176;&#x5B9E;&#x7406;&#x8BBA;&#x4E0A;&#x662F;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x5B89;&#x88C5; NW.js &#x5230;&#x672C;&#x5730;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x5F00;&#x53D1;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6309;&#x7167;&#x5176;<a href="https://github.com/nwjs/nw.js#downloads" target="_blank" rel="external">&#x5728; GitHub &#x4E0A;&#x7684;&#x4ECB;&#x7ECD;</a>&#x8FDB;&#x884C;&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;&#x3002;</p>
<h3 id="sublime-&#x5DE5;&#x5177;">sublime &#x5DE5;&#x5177;</h3><p>&#x8FD9;&#x91CC;&#x6211;&#x8FD8;&#x5B89;&#x88C5;&#x4E86;&#x4E2A; <a href="https://github.com/nwjs/nw.js/wiki/Debugging-with-Sublime-Text-2-and-3" target="_blank" rel="external">sublime &#x5DE5;&#x5177;</a>&#xFF0C;&#x914D;&#x7F6E;&#x597D;&#x540E;&#x5728;&#x6839;&#x76EE;&#x5F55;&#x4F7F;&#x7528;&#x5FEB;&#x6377;&#x952E; <code>&#x2318; B</code> &#x5C31;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x5E94;&#x7528;&#x3002;</p>
<h2 id="&#x521B;&#x5EFA;&#x9879;&#x76EE;">&#x521B;&#x5EFA;&#x9879;&#x76EE;</h2><p>&#x5E76;&#x6CA1;&#x6709;&#x7279;&#x522B;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x53EA;&#x8981;&#x6709; package.json &#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF1A;</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  &quot;<span class="attribute">name</span>&quot;: <span class="value"><span class="string">&quot;nw-demo&quot;</span></span>,</span><br><span class="line">  &quot;<span class="attribute">version</span>&quot;: <span class="value"><span class="string">&quot;0.0.1&quot;</span></span>,</span><br><span class="line">  &quot;<span class="attribute">main</span>&quot;: <span class="value"><span class="string">&quot;index.html&quot;</span></span>,</span><br><span class="line">  &quot;<span class="attribute">window</span>&quot;: <span class="value">{</span><br><span class="line">    &quot;<span class="attribute">toolbar</span>&quot;: <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">    &quot;<span class="attribute">width</span>&quot;: <span class="value"><span class="number">660</span></span>,</span><br><span class="line">    &quot;<span class="attribute">height</span>&quot;: <span class="value"><span class="number">500</span></span><br><span class="line">  </span>}</span><br><span class="line"></span>}</span><br></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D; <code>&quot;main&quot;: &quot;index.html&quot;</code> &#x6307;&#x5B9A;&#x4E86;&#x5165;&#x53E3;&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A; index.html &#x4E5F;&#x662F;&#x5FC5;&#x987B;&#x8981;&#x5B58;&#x5728;&#x7684;&#xFF1A;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>demo<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">h1</span>&gt;</span>demo<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="&#x542F;&#x52A8;&#x9879;&#x76EE;">&#x542F;&#x52A8;&#x9879;&#x76EE;</h2><p>&#x5728; package.json &#x6240;&#x5728;&#x76EE;&#x5F55;&#x6267;&#x884C;&#xFF08;Mac&#xFF09;&#xFF1A;</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/Applications/</span>nwjs.app<span class="regexp">/Contents/</span>MacOS<span class="regexp">/nwjs .</span></span><br></pre></td></tr></table></figure>
<p>&#x5C31;&#x4F1A;&#x5F39;&#x51FA;&#x5E94;&#x7528;&#x7A97;&#x53E3;&#xFF08;&#x5185;&#x5BB9;&#x4E3A;&#x4E0A;&#x8FF0; index.html&#xFF09;&#x3002;&#x5176;&#x4ED6;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x770B;<a href="https://github.com/nwjs/nw.js#quick-start" target="_blank" rel="external">&#x8FD9;&#x91CC;</a>&#xFF0C;&#x6211;&#x4E5F;&#x6CA1;&#x8BD5;&#x8FC7;&#x3002;</p>
<h2 id="&#x4F7F;&#x7528;-js">&#x4F7F;&#x7528; JS</h2><p>&#x5728; index.html &#x5185;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x4F7F;&#x7528; JS&#xFF1A;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">&quot;path/to/index.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x548C;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="actionscript"></span><br><span class="line"><span class="comment">// do something</span></span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x65E0;&#x5DEE;&#x5F02;&#x7684;&#x3002;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F;&#x5C31;&#x662F;&#x7B2C;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x7B49;&#x540C;&#x4E8E;&#x628A; index.js &#x7684;&#x5185;&#x5BB9;&#x76F4;&#x63A5;&#x6309;&#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x5F0F;&#x7684;&#x65B9;&#x6CD5;&#x8D34;&#x5728;&#x9875;&#x9762; <code>&lt;script&gt;</code> &#x6807;&#x7B7E;&#x4E2D;&#xFF0C;&#x548C; index.js &#x672C;&#x8EAB;&#x6240;&#x5728;&#x7684;&#x8DEF;&#x5F84;&#x65E0;&#x5173;&#x3002;</p>
<h2 id="&#x6A21;&#x5757;&#x5316;">&#x6A21;&#x5757;&#x5316;</h2><p>&#x770B;&#x8D77;&#x6765;&#x8FD9;&#x4E2A;&#x8FD9;&#x4E2A; index.js &#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x65F6;&#x5019;&#x6CA1;&#x591A;&#x5927;&#x5173;&#x7CFB;&#xFF0C;&#x4F46;&#x5F53;&#x9879;&#x76EE;&#x5927;&#x8D77;&#x6765;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6A21;&#x5757;&#x5316;&#x7684;&#x6982;&#x5FF5;&#x8FD8;&#x662F;&#x5F97;&#x5F15;&#x5165;&#xFF0C;&#x800C;&#x6B64;&#x65F6;&#x6A21;&#x5757;&#x8DEF;&#x5F84;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x5F97;&#x4E0D;&#x5173;&#x6CE8;&#x7684;&#x8BDD;&#x9898;&#x4E86;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x6211;&#x7FFB;&#x4E86;&#x597D;&#x51E0;&#x4E2A; <a href="https://github.com/zcbenz/nw-sample-apps" target="_blank" rel="external">demos repository</a> &#x548C; <a href="https://github.com/nwjs/nw.js/wiki/List-of-apps-and-companies-using-nw.js" target="_blank" rel="external">List of apps and companies using nw.js</a> &#x53D1;&#x73B0;&#x90FD;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x6A21;&#x5757;&#x5316;&#x5DE5;&#x5177;&#xFF1A;&#x65E0;&#x4E00;&#x4F8B;&#x5916;&#x5730;&#x662F;&#x628A;&#x5168;&#x90E8; js &#x4EE5; <code>&lt;script src=&quot;...&quot;&gt;</code> &#x7684;&#x65B9;&#x5F0F;&#x63D2;&#x5165;&#x9875;&#x9762;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x6211;&#x8FD8;&#x662F;&#x4E0D;&#x7518;&#x5FC3;&#xFF0C;&#x8FD8;&#x662F;&#x8BD5;&#x4E86;&#x4E00;&#x4E0B;&#xFF1A;&#x9274;&#x4E8E; NW.js &#x662F;&#x57FA;&#x4E8E; Node &#x7684;&#xFF0C;&#x90A3;&#x81EA;&#x7136;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; CommonJS &#x89C4;&#x8303;&#xFF1A;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span><br><span class="line">    &#x8FD9;&#x91CC;&#x4E0D;&#x7528; &lt;script src=&quot;...&quot;&gt;</span><br><span class="line">    &#x662F;&#x4E3A;&#x4E86;&#x8BA9;&#x8FD9;&#x4E2A;&#x65E0;&#x6548;&#x7684; src &#x5728; require &#x65F6;&#x4E0D;&#x4EA7;&#x751F;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x7684;&#x56F0;&#x60D1;</span><br><span class="line">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&apos;./js/index&apos;</span>);</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * js/index.js</span><br><span class="line"> */</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&apos;./cmp/alert&apos;</span>)();</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * js/cmp/alert.js</span><br><span class="line"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    alert(<span class="string">&apos;something&apos;</span>);</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>&#x5B8C;&#x7F8E;&#x8FD0;&#x884C;&#xFF0C;&#x4E00;&#x5207;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x597D;&#x3002;</p>
<h2 id="&#x4F7F;&#x7528;-node-module">&#x4F7F;&#x7528; Node Module</h2><p>&#x56DE;&#x5230; NW.js &#x57FA;&#x4E8E; Node &#x4E0A;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Node &#x672C;&#x8EAB;&#x7684; Module&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528; <a href="https://npm.com" target="_blank" rel="external">npm</a> &#x4E0A;&#x7684;&#xFF1A;</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="tag">i</span> --save jquery</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">ul</span> <span class="attribute">id</span>=<span class="value">&quot;files&quot;</span>&gt;</span><span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"><span class="built_in">require</span>(<span class="string">&apos;./js/files&apos;</span>)();</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * js/files.js</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&apos;fs&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">&apos;jquery&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> $files = $(<span class="string">&apos;#files&apos;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    fs.readdir(process.cwd(), <span class="function"><span class="keyword">function</span> (<span class="params">err, files</span>) </span>{</span><br><span class="line">        files.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">f</span>) </span>{</span><br><span class="line">            $(<span class="string">&apos;&lt;li&gt;&apos;</span>).html(f).appendTo($files);</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5B8C;&#x7F8E;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x91CC;&#x7684; <code>require(&apos;fs&apos;)</code> &#x548C; <code>process.cwd()</code> &#x90FD;&#x5982;&#x540C;&#x5199; Node &#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x5207;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x597D;&#x3002;</p>
<h2 id="&#x4F7F;&#x7528;-nwgui">&#x4F7F;&#x7528; nw.gui</h2><p>&#x505A;&#x684C;&#x9762;&#x5E94;&#x7528;&#x96BE;&#x514D;&#x8981;&#x4F7F;&#x7528;&#x5230;&#x4E00;&#x4E9B; <a href="https://github.com/nwjs/nw.js/wiki/Native-UI-API-Manual" target="_blank" rel="external">Native UI</a>&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x505A;&#x4E2A;&#x53F3;&#x51FB;&#x83DC;&#x5355;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * js/menu.js</span><br><span class="line"> */</span></span><br><span class="line"><span class="comment">// Load native UI library</span></span><br><span class="line"><span class="keyword">var</span> gui = <span class="built_in">require</span>(<span class="string">&apos;nw.gui&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an empty menu</span></span><br><span class="line"><span class="keyword">var</span> menu = <span class="keyword">new</span> gui.Menu({ type: <span class="string">&apos;menubar&apos;</span> });</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a normal item with label and icon</span></span><br><span class="line"><span class="keyword">var</span> item = <span class="keyword">new</span> gui.MenuItem({</span><br><span class="line">    type: <span class="string">&apos;normal&apos;</span>, </span><br><span class="line">    label: <span class="string">&apos;I\&apos;m a menu item&apos;</span>,</span><br><span class="line">    click: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">        alert(<span class="string">&apos;WaW!&apos;</span>);</span><br><span class="line">    },</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add some items</span></span><br><span class="line">menu.append(item);</span><br><span class="line">menu.append(<span class="keyword">new</span> gui.MenuItem({ type: <span class="string">&apos;separator&apos;</span> }));</span><br><span class="line">menu.append(<span class="keyword">new</span> gui.MenuItem({ label: <span class="string">&apos;Item C&apos;</span> }));</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">&apos;contextmenu&apos;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>{ </span><br><span class="line">    ev.preventDefault();</span><br><span class="line">    menu.popup(ev.x, ev.y);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">&quot;js/menu.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x7528;&#x8FD9;&#x6837;&#x7684;&#x65B9;&#x6CD5;&#x63D2;&#x5165; js &#x5230; html &#x91CC;&#xFF0C;&#x4F9D;&#x65E7;&#x662F;&#x5B8C;&#x7F8E;&#x8FD0;&#x884C;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E0A;&#x9762;&#x7684; require &#x7684;&#x65B9;&#x5F0F;&#x5462;&#xFF1A;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"><span class="built_in">require</span>(<span class="string">&apos;./js/menu&apos;</span>);</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x7ED3;&#x679C;&#x5C31;&#x662F;&#xFF0C;&#x62A5;&#x9519;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Error</span>: Cannot find <span class="built_in">module</span> <span class="string">&apos;nw.gui&apos;</span></span><br></pre></td></tr></table></figure>
<p>&#x55EF;&#xFF0C;&#x6211;&#x4F3C;&#x4E4E;&#x660E;&#x767D;&#x4E3A;&#x4EC0;&#x4E48;&#x522B;&#x4EBA;&#x4E0D;&#x7528;&#x6A21;&#x5757;&#x5316;&#x4E86;&#x2026;</p>
<h2 id="&#x6253;&#x5305;&#x5E94;&#x7528;">&#x6253;&#x5305;&#x5E94;&#x7528;</h2><p>&#x5B98;&#x65B9;&#x7684;<a href="https://github.com/nwjs/nw.js/wiki/How-to-package-and-distribute-your-apps" target="_blank" rel="external">&#x4ECB;&#x7ECD;</a>&#x8001;&#x957F;&#x8001;&#x957F;&#x4E86;&#xFF0C;&#x6211;&#x7528;&#x4E86; <a href="https://github.com/mllrsohn/node-webkit-builder" target="_blank" rel="external">node-webkit-builder</a></p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save-dev <span class="keyword">node</span><span class="identifier"></span><span class="title">-webkit-builder</span></span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x5199;&#x4E2A; build.js&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> NwBuilder = <span class="built_in">require</span>(<span class="string">&apos;node-webkit-builder&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> nw = <span class="keyword">new</span> NwBuilder({</span><br><span class="line">    files: [</span><br><span class="line">        <span class="string">&apos;./package.json&apos;</span>,</span><br><span class="line">        <span class="string">&apos;./css/*&apos;</span>,</span><br><span class="line">        <span class="string">&apos;./img/*&apos;</span>,</span><br><span class="line">        <span class="string">&apos;./index.html&apos;</span>,</span><br><span class="line">        <span class="string">&apos;./js/**/**&apos;</span>,</span><br><span class="line">        <span class="string">&apos;./node_modules/jquery/dist/jquery.js&apos;</span></span><br><span class="line">    ],</span><br><span class="line">    macIcns: <span class="string">&apos;./logo.icns&apos;</span>,</span><br><span class="line">    platforms: [<span class="string">&apos;osx64&apos;</span>] <span class="comment">// &apos;osx32&apos;, &apos;osx64&apos;, &apos;win32&apos;, &apos;win64&apos;</span></span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">//Log stuff you want</span></span><br><span class="line">nw.on(<span class="string">&apos;log&apos;</span>,  <span class="built_in">console</span>.log);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build returns a promise</span></span><br><span class="line">nw.build().then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&apos;all done!&apos;</span>);</span><br><span class="line">}).catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.error(error);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>&#x6267;&#x884C; <code>node build.js</code> &#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x751F;&#x6210;&#x7684;&#x5E94;&#x7528;&#x4F1A;&#x5728;&#x76EE;&#x5F55; <code>build/&lt;package.name&gt;/</code> &#x4E0B;&#x9762;&#xFF0C;&#x6309;&#x5E73;&#x53F0;&#x5206;&#x6210;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x3002;</p>
<blockquote>
<p>&#x8FD9;&#x91CC;&#x914D;&#x7F6E;&#x4E86;&#x5E94;&#x7528;&#x7684;&#x56FE;&#x6807;&#xFF0C;&#x968F;&#x4FBF;&#x627E;&#x4E2A;&#x53EF;&#x4EE5;&#x8F6C;&#x6362; icns &#x6587;&#x4EF6;&#x7684;&#x7F51;&#x7AD9;&#x628A;&#x81EA;&#x5DF1;&#x7684;&#x8BBE;&#x8BA1;&#x56FE;&#x641E;&#x4E0A;&#x53BB;&#x751F;&#x6210;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<p>前段时间简单研究了一下 <a href="http://nwjs.io/">NW.js</a>，基于 Chromium 和 node.js，可以使用 Web 技术来编写跨平台的桌面应用。</p>]]>
    
    </summary>
    
      <category term="NW.js" scheme="http://csbun.github.io/blog/tags/NW-js/"/>
    
      <category term="Node" scheme="http://csbun.github.io/blog/tags/Node/"/>
    
      <category term="desktop" scheme="http://csbun.github.io/blog/tags/desktop/"/>
    
      <category term="webkit" scheme="http://csbun.github.io/blog/tags/webkit/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Angular 1.3.14 开始支持 CommonJS]]></title>
    <link href="http://csbun.github.io/blog/2015/02/angular-commonjs/"/>
    <id>http://csbun.github.io/blog/2015/02/angular-commonjs/</id>
    <published>2015-02-27T12:19:06.000Z</published>
    <updated>2015-10-27T10:07:48.000Z</updated>
    <content type="html"><![CDATA[<p>&#x5E74;&#x524D;&#x624D;&#x521A;&#x521A;&#x5199;&#x4E86;&#x7BC7;&#x5173;&#x4E8E;<a href="http://csbun.github.io/blog/angular/requirejs/2015/02/15/ng-with-requirejs.html">AngularJS with RequireJS</a>&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x6CA1;&#x60F3;&#x5230;&#x524D;&#x4E24;&#x5929; Angular &#x5728;&#x6700;&#x65B0;&#x7684; <a href="http://angularjs.blogspot.com/2015/02/new-angularjs-releases-140-beta5-and.html" target="_blank" rel="external">1.3.14 &#x66F4;&#x65B0;&#x6587;&#x6863;</a>&#x4E2D;&#x5C31;&#x63D0;&#x5230;&#x652F;&#x6301; CommonJS &#x4E86;&#x3002;</p>
<a id="more"></a>
<p>&#x4ECA;&#x5929;&#x6709;&#x7A7A;&#xFF0C;&#x5C31;&#x628A;&#x6B63;&#x5728;&#x5199;&#x7684;&#x4F7F;&#x7528; RequireJS &#x7684;&#x7CFB;&#x7EDF;&#x4ECE;&#x4E4B;&#x524D;&#x7684; CommonJS &#x6A21;&#x5F0F;&#xFF0C;&#x7136;&#x540E;&#x7528; Browserify &#x6784;&#x5EFA;&#x3002;</p>
<h2 id="&#x6A21;&#x5757;&#x52A0;&#x8F7D;">&#x6A21;&#x5757;&#x52A0;&#x8F7D;</h2><h3 id="requirejs-&#x6A21;&#x5F0F;">RequireJS &#x6A21;&#x5F0F;</h3><p>&#x5148;&#x770B;&#x8FD9;&#x4E00;&#x6BB5;&#x7528; RequireJS &#x5199;&#x7684;&#x4EE3;&#x7801;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">define([</span><br><span class="line">    <span class="string">&apos;angular&apos;</span>,</span><br><span class="line">    <span class="string">&apos;angular-route&apos;</span></span><br><span class="line">], <span class="function"><span class="keyword">function</span> (<span class="params">angular</span>) </span>{</span><br><span class="line"><span class="pi">    &apos;use strict&apos;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ape = angular.module(<span class="string">&apos;ape&apos;</span>, [</span><br><span class="line">        <span class="string">&apos;ngRoute&apos;</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">return</span> ape;</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#x7684; <code>&apos;angular&apos;</code> &#x548C; <code>&apos;angular-route&apos;</code> &#x90FD;&#x662F;&#x7528; bower &#x4E0B;&#x8F7D;&#x5E76;&#x5728; <code>require.config()</code> &#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>.config({</span><br><span class="line">    paths: {</span><br><span class="line">        <span class="string">&apos;angular&apos;</span>: <span class="string">&apos;public/bower_components/angular/angular&apos;</span>,</span><br><span class="line">        <span class="string">&apos;angular-route&apos;</span>: <span class="string">&apos;public/bower_components/angular-route/angular-route&apos;</span>,</span><br><span class="line">    },</span><br><span class="line">    shim: {</span><br><span class="line">        <span class="string">&apos;angular&apos;</span>: {</span><br><span class="line">            exports : <span class="string">&apos;angular&apos;</span></span><br><span class="line">        },</span><br><span class="line">        <span class="string">&apos;angular-route&apos;</span>: {</span><br><span class="line">            deps: [<span class="string">&apos;angular&apos;</span>],</span><br><span class="line">            exports: <span class="string">&apos;angular-route&apos;</span></span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line">    deps: [<span class="string">&apos;public/routes&apos;</span>]</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x89C1;&#x8FD9;&#x91CC;&#x7684;&#x914D;&#x7F6E;&#x6BD4;&#x8F83;&#x7E41;&#x7410;&#xFF0C;&#x800C;&#x4E14;&#x6211;&#x4EEC;&#x8FD8;&#x8981;&#x88AB;&#x5F3A;&#x8FEB;&#x8981;&#x53BB;&#x4E86;&#x89E3; <code>angular-route</code> &#x7684; module &#x5B9A;&#x4E49;&#x662F; <code>&apos;ngRoute&apos;</code>&#x3002;</p>
<h3 id="commonjs-&#x6A21;&#x5F0F;">CommonJS &#x6A21;&#x5F0F;</h3><p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6539;&#x7528; CommonJS&#xFF0C;&#x9996;&#x5148;&#xFF0C;&#x4E0B;&#x8F7D;&#x4E0D;&#x4F7F;&#x7528; bower&#x4E86;&#xFF0C;&#x76F4;&#x63A5;&#x4E0A; npm&#xFF1A;</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="tag">i</span> --save angular</span><br><span class="line">npm <span class="tag">i</span> --save angular-router</span><br></pre></td></tr></table></figure>
<p>&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x4E5F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF08;index.js&#xFF09;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&apos;use strict&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> angular = <span class="built_in">require</span>(<span class="string">&apos;angular&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> ape = angular.module(<span class="string">&apos;ape&apos;</span>, [<span class="built_in">require</span>(<span class="string">&apos;angular-route&apos;</span>)]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = ape;</span><br></pre></td></tr></table></figure>
<p>&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x914D;&#x7F6E;&#x3002;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F; Browserify &#x7684;&#x4E8B;&#x4E86;&#xFF1A;</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">browserify <span class="keyword">public</span>/<span class="keyword">index</span>.js -o build/bundle.js</span><br></pre></td></tr></table></figure>
<h2 id="&#x6A21;&#x5757;&#x5B9A;&#x4E49;">&#x6A21;&#x5757;&#x5B9A;&#x4E49;</h2><p>&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x8BA9;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x7684; module &#x4E5F;&#x53EF;&#x4EE5;&#x50CF;&#x4E0A;&#x9762;&#x90A3;&#x6837;&#x4F7F;&#x7528;&#xFF0C;&#x5047;&#x5B9A;&#x6211;&#x4EEC;&#x8981;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x522B;&#x7684;&#x4EC0;&#x4E48;&#x6A21;&#x5757;&#xFF08;my.module.js&#xFF09;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&apos;use strict&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> MODULE_NAME = <span class="string">&apos;my-module&apos;</span>;</span><br><span class="line"><span class="keyword">var</span> angular = <span class="built_in">require</span>(<span class="string">&apos;angular&apos;</span>);</span><br><span class="line"></span><br><span class="line">angular.module(MODULE_NAME, []);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = MODULE_NAME;</span><br></pre></td></tr></table></figure>
<p>&#x90A3;&#x4E48;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x90A3;&#x4E2A; index.js &#x4E2D;&#x5C31;&#x53EF;&#x4EE5;&#x7528;&#x540C;&#x6837;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ape = angular.module(<span class="string">&apos;ape&apos;</span>, [</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&apos;angular-route&apos;</span>),</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&apos;./my.module&apos;</span>),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<h2 id="&#x66F4;&#x591A;&#x6280;&#x5DE7;">&#x66F4;&#x591A;&#x6280;&#x5DE7;</h2><p>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x8FD9;&#x4E2A;&#x6280;&#x5DE7;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x505A;&#x66F4;&#x591A;&#xFF0C;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A; Service&#xFF08;my.service.js&#xFF09;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&apos;use strict&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> SERVICE_NAME = <span class="string">&apos;MyService&apos;</span>;</span><br><span class="line"><span class="keyword">var</span> angular = <span class="built_in">require</span>(<span class="string">&apos;angular&apos;</span>);</span><br><span class="line"></span><br><span class="line">angular.module(<span class="built_in">require</span>(<span class="string">&apos;./my.module&apos;</span>))</span><br><span class="line">    .service(SERVICE_NAME, [<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            someMethod: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = SERVICE_NAME;</span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x5728;&#x540C;&#x6837;&#x5728; index.js &#x4E2D;&#x4F7F;&#x7528;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ape = angular.module(<span class="string">&apos;ape&apos;</span>, [</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">&apos;angular-route&apos;</span>),</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">&apos;./my.module&apos;</span>),</span><br><span class="line">    ])</span><br><span class="line">    .controller(<span class="string">&apos;AppCtrl&apos;</span>, [</span><br><span class="line">        <span class="built_in">require</span>(./my.service),  <span class="comment">// &#x8FD9;&#x91CC;&#x76F8;&#x5F53;&#x4E8E; SERVICE_NAME (= &apos;MyService&apos;)</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params">MyServiceArgName</span>) </span>{</span><br><span class="line">            <span class="comment">// &#x8FD9;&#x91CC;&#x7684; MyServiceArgName &#x662F;&#x5F62;&#x53C2;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x548C;&#x4E0A;&#x9762;&#x7684; SERVICE_NAME &#x76F8;&#x540C;</span></span><br><span class="line">            MyServiceArgName.someMethod();</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        }</span><br><span class="line">    ]);;</span><br></pre></td></tr></table></figure>
<p>&#x4F9D;&#x65E7;&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x914D;&#x7F6E;&#xFF0C;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x5173;&#x6CE8; my.module &#x548C; my.service &#x5230;&#x5E95;&#x8D77;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x540D;&#x5B57;&#xFF0C;&#x53EA;&#x8981;&#x77E5;&#x9053;&#x6587;&#x4EF6;&#x540D;&#xFF08;&#x8DEF;&#x5F84;&#xFF09;&#x4E0E;&#x5176;&#x63D0;&#x4F9B;&#x7684; API &#x5373;&#x53EF;&#xFF08;&#x8FD9;&#x91CC;&#x7684; API &#x6307; someMethod&#xFF09;&#x3002;</p>
<h2 id="&#x95EE;&#x9898;">&#x95EE;&#x9898;</h2><p>&#x7528; Browserify &#x662F;&#x723D;&#x4E86;&#x5F88;&#x591A;&#xFF0C;&#x914D;&#x7F6E;&#x5C11;&#x4E86;&#xFF0C;&#x4EE3;&#x7801;&#x7B80;&#x6D01;&#x4E86;&#x3002;&#x867D;&#x7136;&#x5F88;&#x4E45;&#x4E4B;&#x524D;&#x5C31;&#x662F;&#x77E5;&#x9053; Browserify&#xFF0C;&#x4F46;&#x771F;&#x6B63;&#x5F00;&#x59CB;&#x7528;&#x8FD8;&#x662F;&#x6700;&#x8FD1;&#xFF0C;&#x96BE;&#x514D;&#x8FD8;&#x662F;&#x4F1A;&#x9047;&#x5230;&#x6709;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#xFF1A;</p>
<h3 id="requirecontroller-&#x95EE;&#x9898;">require(controller) &#x95EE;&#x9898;</h3><p>&#x6309;&#x4E0A;&#x9762;&#x7684;&#x4F5C;&#x6CD5;&#x6211;&#x5199;&#x4E86;&#x4E2A; my.controller.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CTRL_NAME = <span class="string">&apos;MyCtrl&apos;</span>;</span><br><span class="line"><span class="keyword">var</span> angular = <span class="built_in">require</span>(<span class="string">&apos;angular&apos;</span>);</span><br><span class="line"></span><br><span class="line">angular.module(<span class="string">&apos;activity&apos;</span>)</span><br><span class="line">    .controller(CTRL_NAME, [<span class="string">&apos;$scope&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$scope</span>) </span>{</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    }]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = CTRL_NAME;</span><br></pre></td></tr></table></figure>
<p>&#x4F46;&#x5728; index.js &#x4E2D;&#x5374;&#x65E0;&#x6CD5;&#x8FD9;&#x6837;&#x4F7F;&#x7528;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ape.config([<span class="string">&apos;$routeProvider&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$routeProvider</span>) </span>{</span><br><span class="line">    <span class="comment">// &#x914D;&#x7F6E;&#x8DEF;&#x7531;</span></span><br><span class="line">    $routeProvider</span><br><span class="line">        .when(<span class="string">&apos;/my&apos;</span>, {</span><br><span class="line">            controller: <span class="built_in">require</span>(<span class="string">&apos;./my.controller&apos;</span>),</span><br><span class="line">            templateUrl: <span class="string">&apos;path/to/my.controller/tpl.html&apos;</span></span><br><span class="line">        });</span><br><span class="line">}])</span><br></pre></td></tr></table></figure>
<p>&#x53EA;&#x80FD;&#x8FD9;&#x6837;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CTRL_NAME = <span class="built_in">require</span>(<span class="string">&apos;./my.controller&apos;</span>);</span><br><span class="line">ape.config([<span class="string">&apos;$routeProvider&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$routeProvider</span>) </span>{</span><br><span class="line">    <span class="comment">// &#x914D;&#x7F6E;&#x8DEF;&#x7531;</span></span><br><span class="line">    $routeProvider</span><br><span class="line">        .when(<span class="string">&apos;/my&apos;</span>, {</span><br><span class="line">            controller: CTRL_NAME,</span><br><span class="line">            templateUrl: <span class="string">&apos;path/to/my.controller/tpl.html&apos;</span></span><br><span class="line">        });</span><br><span class="line">}])</span><br></pre></td></tr></table></figure>
<h3 id="&#x975E;&#x6807;&#x51C6;&#x7684;&#x6A21;&#x5757;">&#x975E;&#x6807;&#x51C6;&#x7684;&#x6A21;&#x5757;</h3><p>&#x5F88;&#x591A;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; bower, component, duo &#x53EF;&#x4EE5;&#x4E0B;&#x8F7D;&#x7684;&#x5305;&#xFF0C;&#x5E76;&#x4E0D;&#x90FD;&#x53D1;&#x5E03;&#x5230; npm &#x4E0A;&#xFF0C;&#x751A;&#x81F3;&#x6CA1;&#x6709; package.json &#x6587;&#x4EF6;&#x3002;&#x8FD9;&#x4F7F;&#x6211;&#x611F;&#x89C9; js &#x7684;&#x5404;&#x4E2A;&#x751F;&#x6001;&#x5708;&#x7684;&#x6DF7;&#x4E71;&#xFF0C;&#x60F3;&#x5355;&#x72EC;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5305;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x662F;&#x6709;&#x4E00;&#x5B9A;&#x96BE;&#x5EA6;&#x7684;&#x3002;</p>
<p>&#x5F53;&#x7136;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x7684;&#x5305;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x8FD8;&#x662F;&#x63D0;&#x4F9B;&#x5404;&#x7EC4;&#x914D;&#x7F6E;&#x6765;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;Browserify &#x6709; <code>browser</code> &#x914D;&#x7F6E;&#x3002;&#x5BF9;&#x4E8E;&#x4E0D;&#x662F; CommonJS &#x7684;&#x6A21;&#x5757;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <a href="https://github.com/thlorenz/browserify-shim" target="_blank" rel="external">browserify-shim</a>&#xFF08;&#x4F46;&#x6211;&#x76EE;&#x524D;&#x6CA1;&#x7528;&#x5230;&#xFF09;&#x3002;</p>
<h3 id="&#x8D44;&#x6E90;&#x5B9A;&#x4F4D;&#x95EE;&#x9898;">&#x8D44;&#x6E90;&#x5B9A;&#x4F4D;&#x95EE;&#x9898;</h3><p>&#x5728;&#x6211;&#x770B;&#x6765; Browserify &#x6700;&#x521D;&#x662F;&#x8BBE;&#x8BA1;&#x7ED9; js &#x4F7F;&#x7528;&#xFF0C;&#x5BF9;&#x5176;&#x4ED6;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x8BF8;&#x5982; css&#x3001;font&#x3001;image &#x7B49;&#x7684;&#x652F;&#x6301;&#x5E76;&#x4E0D;&#x597D;&#x3002;</p>
<p>&#x867D;&#x7136;&#x6709;&#x7C7B;&#x4F3C; <a href="https://www.npmjs.com/package/cssify" target="_blank" rel="external">cssify</a>&#x3001;<a href="https://www.npmjs.com/package/browserify-css" target="_blank" rel="external">browserify-css</a>&#x3001;<a href="https://www.npmjs.com/package/insert-css" target="_blank" rel="external">insert-css</a> &#x7B49;&#x5DE5;&#x5177;&#xFF0C;&#x4F46;&#x662F;&#x5176;&#x8D44;&#x6E90;&#x5B9A;&#x4F4D;&#x8FD8;&#x662F;&#x6CA1;&#x6709;&#x89E3;&#x51B3;&#xFF1A;</p>
<p>&#x4F8B;&#x5982; css &#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A; <code>background-image</code> &#x5730;&#x5740;&#xFF0C;&#x90A3;&#x4E48;&#x5408;&#x5E76;&#x540E;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x5730;&#x5740;&#x8BE5;&#x600E;&#x4E48;&#x529E;&#xFF0C;&#x4F3C;&#x4E4E;&#x4E0A;&#x9762;&#x7684;&#x5DE5;&#x5177;&#x6CA1;&#x6709;&#x5F88;&#x597D;&#x5730;&#x89E3;&#x51B3;&#x3002;&#x81F3;&#x5C11;&#x6211;&#x4F7F;&#x7528; cssify &#x53BB;&#x52A0;&#x8F7D; <a href="https://www.npmjs.com/package/font-awesome" target="_blank" rel="external">font-awesome</a> &#x65F6;&#x5C31;&#x9047;&#x5230;&#x4E86;&#x627E;&#x4E0D;&#x5230;&#x5B57;&#x4F53;&#x6587;&#x4EF6;&#x7684;&#x5C34;&#x5C2C;&#xFF08;&#x8DEF;&#x5F84;&#x5B8C;&#x5168;&#x4E0D;&#x5BF9;&#xFF09;&#x3002;</p>
<p>&#x53EF;&#x80FD;&#x662F;&#x6211;&#x521A;&#x4F7F;&#x7528; Browserify &#x4E0D;&#x4E45;&#xFF0C;&#x4E0D;&#x662F;&#x975E;&#x5E38;&#x4E86;&#x89E3;&#xFF0C;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x540E;&#x7EED;&#x5E94;&#x8BE5;&#x8BE6;&#x7EC6;&#x7814;&#x7A76;&#x4E00;&#x4E0B;&#x3002;</p>
<h3 id="&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x5927;&#x6587;&#x4EF6;">&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x5927;&#x6587;&#x4EF6;</h3><p>Browserify &#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x5927;&#x6587;&#x4EF6;&#xFF08;&#x751A;&#x81F3;&#x5305;&#x542B; css&#xFF09;&#xFF0C;&#x4F53;&#x79EF;&#x4E0D;&#x5C0F;&#xFF0C;&#x4F3C;&#x4E4E;&#x548C;&#x60EF;&#x7528;&#x7684;&#x201C;&#x6309;&#x9700;&#x52A0;&#x8F7D;&#x201D;&#x6709;&#x77DB;&#x76FE;&#x7684;&#x5730;&#x65B9;&#x3002;</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>年前才刚刚写了篇关于<a href="http://csbun.github.io/blog/angular/requirejs/2015/02/15/ng-with-requirejs.html">AngularJS with RequireJS</a>的文章，没想到前两天 Angular 在最新的 <a href="http://angularjs.blogspot.com/2015/02/new-angularjs-releases-140-beta5-and.html">1.3.14 更新文档</a>中就提到支持 CommonJS 了。</p>]]>
    
    </summary>
    
      <category term="Angular" scheme="http://csbun.github.io/blog/tags/Angular/"/>
    
      <category term="Browserify" scheme="http://csbun.github.io/blog/tags/Browserify/"/>
    
      <category term="CommonJS" scheme="http://csbun.github.io/blog/tags/CommonJS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Angular Stateful Filters]]></title>
    <link href="http://csbun.github.io/blog/2015/02/angular-stateful-filters/"/>
    <id>http://csbun.github.io/blog/2015/02/angular-stateful-filters/</id>
    <published>2015-02-26T08:53:52.000Z</published>
    <updated>2015-10-27T10:07:57.000Z</updated>
    <content type="html"><![CDATA[<p>&#x5728; Angular &#x91CC;&#x9762;&#xFF0C;&#x7ECF;&#x5E38;&#x4F7F;&#x7528; filter &#x6765;&#x5904;&#x7406;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x7684;&#x663E;&#x793A;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x5F53; filter &#x8981;&#x4F7F;&#x7528;&#x5230;&#x5F02;&#x6B65;&#x6570;&#x636E;&#x65F6;&#x5C31;&#x4F1A;&#x53D8;&#x5F97;&#x6709;&#x4E9B;&#x9EBB;&#x70E6;&#xFF0C;&#x8BD5;&#x4E86;&#x7F51;&#x4E0A;&#x5F88;&#x591A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x90FD;&#x4E0D;&#x884C;&#xFF0C;&#x624D;&#x53D1;&#x73B0;&#x548C; Angular &#x7248;&#x672C;&#x5347;&#x7EA7;&#x6709;&#x5173;&#xFF1A;</p>
<p>Angular &#x5728; 1.3.0 &#x4E4B;&#x540E;&#x7684;&#x7248;&#x672C;&#x63D0;&#x51FA;&#x4E86; <a href="https://docs.angularjs.org/guide/filter" target="_blank" rel="external">Stateful filters</a> &#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x4F46;&#x4E0D;&#x662F;&#x5F88;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x3002;</p>
<a id="more"></a>
<blockquote>
<h3 id="stateful-filters">Stateful filters</h3><p>It is strongly discouraged to write filters that are stateful, because the execution of those can&#x2019;t be optimized by Angular, which often leads to performance issues. Many stateful filters can be converted into stateless filters just by exposing the hidden state as a model and turning it into an argument for the filter.</p>
<p>If you however do need to write a stateful filter, you have to mark the filter as $stateful, which means that it will be executed one or more times during the each $digest cycle.</p>
</blockquote>
<p>&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x53EA;&#x9700;&#x5BF9; filter &#x7684;&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x52A0;&#x4E0A;&#x8FD9;&#x4E2A; <code>$stateful</code> &#x5C5E;&#x6027;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterFn.$stateful = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<p>&#x4E0B;&#x9762;&#x662F;&#x6211;&#x81EA;&#x5DF1;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;<br>

<!--￼1-->

</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">&apos;business&apos;</span>, [])</span><br><span class="line">    .factory(<span class="string">&apos;BusinessResource&apos;</span>, [</span><br><span class="line">        <span class="string">&apos;$resouce&apos;</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params">$resouce</span>) </span>{</span><br><span class="line">            <span class="keyword">return</span> $resource(<span class="string">&apos;api/business/:id&apos;</span>);</span><br><span class="line">        }</span><br><span class="line">    ])</span><br><span class="line">    .controller(<span class="string">&apos;BusinessCtrl&apos;</span>, [</span><br><span class="line">        <span class="string">&apos;$scope&apos;</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params">$scope</span>) </span>{</span><br><span class="line">            $scope.bid = <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    ])</span><br><span class="line">    .filter(<span class="string">&apos;businessDisplay&apos;</span>, [</span><br><span class="line">        <span class="string">&apos;BusinessResource&apos;</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params">BusinessResource</span>) </span>{</span><br><span class="line">            <span class="keyword">var</span> businesses = BusinessResource.query();</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="title">realFilter</span> (<span class="params">input</span>) </span>{</span><br><span class="line">                <span class="keyword">var</span> output = input;</span><br><span class="line">                input = <span class="built_in">parseInt</span>(input, <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (angular.isArray(businesses)) {</span><br><span class="line">                    businesses.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">b</span>) </span>{</span><br><span class="line">                        <span class="keyword">if</span> (b.id === input) {</span><br><span class="line">                            output = b.name;</span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                        }</span><br><span class="line">                    });</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span> output;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// Stateful filters</span></span><br><span class="line">            <span class="comment">// &#x786E;&#x4FDD; BusinessResource.query() &#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x4E4B;&#x540E; filter &#x91CD;&#x65B0;&#x6267;&#x884C;</span></span><br><span class="line">            realFilter.$stateful = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> realFilter;</span><br><span class="line">        }</span><br><span class="line">    ]);</span><br></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[<p>在 Angular 里面，经常使用 filter 来处理一些数据的显示问题。但当 filter 要使用到异步数据时就会变得有些麻烦，试了网上很多解决方案都不行，才发现和 Angular 版本升级有关：</p>
<p>Angular 在 1.3.0 之后的版本提出了 <a href="https://docs.angularjs.org/guide/filter">Stateful filters</a> 的概念，但不是很推荐使用。</p>]]>
    
    </summary>
    
      <category term="Ajax" scheme="http://csbun.github.io/blog/tags/Ajax/"/>
    
      <category term="Angular" scheme="http://csbun.github.io/blog/tags/Angular/"/>
    
      <category term="Filter" scheme="http://csbun.github.io/blog/tags/Filter/"/>
    
      <category term="Stateful" scheme="http://csbun.github.io/blog/tags/Stateful/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Fluxxor 学习笔记]]></title>
    <link href="http://csbun.github.io/blog/2015/02/fluxxor-learning-note/"/>
    <id>http://csbun.github.io/blog/2015/02/fluxxor-learning-note/</id>
    <published>2015-02-22T04:03:53.000Z</published>
    <updated>2015-10-27T10:08:01.000Z</updated>
    <content type="html"><![CDATA[<h2 id="&#x4ECE;-flux-&#x5F00;&#x59CB;">&#x4ECE; Flux &#x5F00;&#x59CB;</h2><p>&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x60F3;&#x771F;&#x6B63;&#x7528; React &#x5199;&#x4E2A;&#x8FD0;&#x8425;&#x7BA1;&#x7406;&#x540E;&#x53F0;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x6293;&#x8D77; Flux &#x5F00;&#x641E;&#xFF0C;&#x6A21;&#x5F0F;&#x57FA;&#x672C;&#x5C31;&#x662F;&#x6211;&#x4E4B;&#x524D;&#x5199;&#x7684;<a href="http://csbun.github.io/blog/flux/react/2014/12/31/flux-learning-note.html">&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;</a> &#x90A3;&#x6837;&#x3002;&#x4F46;&#x95EE;&#x9898;&#x5F88;&#x5FEB;&#x5C31;&#x51FA;&#x73B0;&#x4E86;&#xFF0C;&#x4E00;&#x4E2A;&#x5B57;&#x201C;&#x7E41;&#x7410;&#x201D;&#xFF1A;&#x6211;&#x8981;&#x5199;&#x5927;&#x91CF;&#x7684; actions &#x548C; stores&#xFF0C;&#x6BCF;&#x4E2A; store &#x8FD8;&#x8981;&#x5199;&#x4E00;&#x4E9B;&#x76F8;&#x4F3C;&#x7684;&#x903B;&#x8F91;&#x53BB; bind &#x5BF9;&#x5E94;&#x7684; actions&#x3002;</p>
<a id="more"></a>
<h2 id="&#x8F6C;&#x5411;-fluxxor">&#x8F6C;&#x5411; Fluxxor</h2><p>&#x4E8E;&#x662F;&#xFF0C;&#x51FA;&#x4E8E;&#x5077;&#x61D2;&#x7684;&#x957F;&#x8FDC;&#x8003;&#x8651;&#xFF0C;&#x6211;&#x5F00;&#x59CB;&#x5C1D;&#x8BD5;&#x7528; <a href="http://fluxxor.com/" target="_blank" rel="external">Fluxxor</a> &#x6765;&#x91CD;&#x5199;&#x6211;&#x521A;&#x521A;&#x5199;&#x597D;&#x7684;&#x5C0F;&#x6A21;&#x5757;&#xFF0C;&#x5E76;&#x5728;&#x5185;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x65B0;&#x7684;&#x529F;&#x80FD;&#x3002;</p>
<h3 id="router">Router</h3><p>&#x4F7F;&#x7528; <a href="https://github.com/rackt/react-router" target="_blank" rel="external">react-router</a> &#x8DEF;&#x7531;&#x4F5C;&#x4E3A;&#x7A0B;&#x5E8F;&#x5165;&#x53E3;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> React = <span class="built_in">require</span>(<span class="string">&apos;react&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> Router = <span class="built_in">require</span>(<span class="string">&apos;react-router&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> DefaultRoute = Router.DefaultRoute;</span><br><span class="line"><span class="keyword">var</span> Route = Router.Route;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// react-router</span></span><br><span class="line"><span class="keyword">var</span> routes = (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="title">Route</span> <span class="attribute">name</span>=<span class="value">&quot;app&quot;</span> <span class="attribute">path</span>=<span class="value">&quot;/&quot;</span> <span class="attribute">handler</span>=<span class="value">{Application}</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Route</span> <span class="attribute">name</span>=<span class="value">&quot;activity&quot;</span> <span class="attribute">handler</span>=<span class="value">{Activity}</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Route</span> <span class="attribute">name</span>=<span class="value">&quot;business&quot;</span> <span class="attribute">handler</span>=<span class="value">{Business}</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">DefaultRoute</span> <span class="attribute">handler</span>=<span class="value">{Dashboard}</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">Route</span>&gt;</span></span><br><span class="line">)</span>;</span><br><span class="line">Router.run(routes, <span class="function"><span class="keyword">function</span> (<span class="params">Handler</span>) </span>{</span><br><span class="line">    React.render(<span class="xml"><span class="tag">&lt;<span class="title">Handler</span> <span class="attribute">flux</span>=<span class="value">{flux}</span>/&gt;</span>, document.body);</span><br><span class="line">});</span></span><br></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#x7684; <code>Application</code> &#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F;&#x5168;&#x5C40;&#x7684; view&#xFF0C;&#x5FC5;&#x987B;&#x6307;&#x5B9A; <code>RouteHandler</code>&#xFF08;&#x6709;&#x70B9;&#x50CF; Angular &#x7684; ng-view&#xFF09;&#x3002;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&apos;use strict&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> React = <span class="built_in">require</span>(<span class="string">&apos;react/addons&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> Router = <span class="built_in">require</span>(<span class="string">&apos;react-router&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> cx = React.addons.classSet;</span><br><span class="line"><span class="keyword">var</span> RouteHandler = Router.RouteHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x5E94;&#x7528;&#x672C;&#x8EAB;</span></span><br><span class="line"><span class="keyword">var</span> Application = React.createClass({</span><br><span class="line">    <span class="comment">// &#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;</span></span><br><span class="line">    getInitialState: <span class="function"><span class="keyword">function</span> (<span class="params">argument</span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> {};</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// &#x6E32;&#x67D3;</span></span><br><span class="line">    render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">        <span class="comment">// id=&quot;container&quot; &#x7684; className</span></span><br><span class="line">        <span class="keyword">var</span> clazz = cx({</span><br><span class="line">            <span class="string">&apos;show-menu&apos;</span>: <span class="keyword">this</span>.state.isMenuShow</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;container&quot;</span> <span class="attribute">className</span>=<span class="value">{clazz}</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;page-content&quot;</span>&gt;</span></span><br><span class="line">                    {/** @jsx {RouteHandler} [&#x4E3B;&#x4F53;&#x5185;&#x5BB9;&#xFF1A;&#x901A;&#x8FC7; react-router &#x6E32;&#x67D3;] */}</span><br><span class="line">                    <span class="tag">&lt;<span class="title">RouteHandler</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">        )</span>;</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"><span class="built_in">module</span>.exports = Application;</span><br></pre></td></tr></table></figure>
<p>&#x53E6;&#x5916;&#x7684; <code>Activity</code>&#x3001;<code>Business</code> &#x548C; <code>Dashboard</code> &#x5747;&#x4E3A; View &#x5C42;&#x7684; React Components&#xFF0C;&#x548C;&#x5E38;&#x89C4;&#x7684; Flux &#x5199;&#x6CD5;&#x6CA1;&#x660E;&#x663E;&#x533A;&#x522B;&#xFF0C;&#x8FD9;&#x91CC;&#x6682;&#x65F6;&#x4E0D;&#x8BE6;&#x8FF0;&#x3002;</p>
<h3 id="flux">flux</h3><p>&#x6211;&#x4EEC;&#x4E3A;&#x5168;&#x5C40;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A; flux&#x3002;&#x7406;&#x8BBA;&#x4E0A;&#xFF0C;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x662F;&#x53EF;&#x4EE5;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A; flux &#x7684;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Fluxxor = <span class="built_in">require</span>(<span class="string">&apos;fluxxor&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stores = {};</span><br><span class="line"><span class="keyword">var</span> actions = {};</span><br><span class="line"><span class="keyword">var</span> flux = <span class="keyword">new</span> Fluxxor.Flux(stores, actions);</span><br><span class="line"></span><br><span class="line"><span class="comment">// react-router</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">Router.run(routes, <span class="function"><span class="keyword">function</span> (<span class="params">Handler</span>) </span>{</span><br><span class="line">    React.render(<span class="xml"><span class="tag">&lt;<span class="title">Handler</span> <span class="attribute">flux</span>=<span class="value">{flux}</span>/&gt;</span>, document.body);</span><br><span class="line">});</span></span><br></pre></td></tr></table></figure>
<p>&#x6211;&#x7406;&#x89E3;&#x8FD9;&#x91CC; <code>new Fluxxor.Flux</code> &#x662F;&#x901A;&#x8FC7; Fluxxor &#x5411; Flux &#x6CE8;&#x518C; stores &#x548C; actions&#xFF0C;&#x524D;&#x8005;&#x4F1A;&#x81EA;&#x52A8;&#x5B8C;&#x6210; <code>(actions) -&gt; Dispatcher -&gt; (registered callback) -&gt; Stores</code> &#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#x3002;</p>
<h3 id="actions">actions</h3><h4 id="&#x5B9A;&#x4E49;">&#x5B9A;&#x4E49;</h4><p>&#x5728; View &#x5C42;&#x6211;&#x4EEC;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E9B;&#x4E8B;&#x4EF6;&#xFF0C;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728; <code>SomeModuleActions.js</code> &#x4E2D;&#x5B9A;&#x4E49;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">&apos;superagent&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> ApplicationConstants = <span class="built_in">require</span>(<span class="string">&apos;../constants/ApplicationConstants&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        <span class="comment">// &#x663E;&#x793A;&#x3001;&#x6536;&#x8D77;&#x5DE6;&#x4FA7;&#x83DC;&#x5355;</span></span><br><span class="line">        toggleMainNav: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">            <span class="keyword">this</span>.dispatch(ApplicationConstants.TOGGLE_MAIN_NAV, {});</span><br><span class="line">        },</span><br><span class="line">        <span class="comment">// &#x52A0;&#x8F7D;&#x67D0;&#x4E9B;&#x6570;&#x636E;</span></span><br><span class="line">        load: <span class="function"><span class="keyword">function</span> (<span class="params">query</span>) </span>{</span><br><span class="line">            <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">            that.dispatch(ApplicationConstants.LOAD, {});</span><br><span class="line">            request.get(ApplicationConstants.URL_LOAD)</span><br><span class="line">                .type(<span class="string">&apos;application/json&apos;</span>)</span><br><span class="line">                .end(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>{</span><br><span class="line">                    <span class="keyword">if</span> (<span class="number">200</span> === res.status &amp;&amp; res.body.success) {</span><br><span class="line">                        that.dispatch(ApplicationConstants.LOAD_SUCCESS, res.body);</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        that.dispatch(ApplicationConstants.LOAD_FAIL, res);</span><br><span class="line">                    }</span><br><span class="line">                });</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<h4 id="&#x6CE8;&#x518C;">&#x6CE8;&#x518C;</h4><p>&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x5728; <code>ApplicationActions.js</code> &#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#x4E24;&#x4E2A; action&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x6CE8;&#x518C;&#x5230; Flux &#x4E2D;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stores = {};</span><br><span class="line"><span class="keyword">var</span> actions = <span class="built_in">require</span>(<span class="string">&apos;./actions/ApplicationActions&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> flux = <span class="keyword">new</span> Fluxxor.Flux(stores, actions);</span><br></pre></td></tr></table></figure>
<p>&#x6B64;&#x65F6;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> actions = {</span><br><span class="line">    toggleMainNav: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{...},</span><br><span class="line">    load: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{...}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x4F46;&#x5F88;&#x5FEB;&#xFF0C;&#x6211;&#x5C31;&#x53D1;&#x73B0;&#xFF1A;&#x5F53;&#x6A21;&#x5757;&#x53D8;&#x591A;&#x65F6;&#xFF0C;&#x5404;&#x4E2A;&#x6A21;&#x5757;&#x7684; actions&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x548C;&#x5176;&#x4ED6;&#x6A21;&#x5757;&#x91CD;&#x540D;&#xFF0C;&#x5F88;&#x4E0D;&#x5229;&#x4E8E;&#x591A;&#x4EBA;&#x5E76;&#x884C;&#x5F00;&#x53D1;&#x3002;</p>
<p>&#x8FD8;&#x597D; Fluxxor &#x63D0;&#x4F9B;&#x4E86;&#x201C;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x201D;&#x7684;&#x6A21;&#x5F0F;&#xFF0C;&#x4E8E;&#x662F;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x7528;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> actions = {</span><br><span class="line">    ApplicationActions: <span class="built_in">require</span>(<span class="string">&apos;./actions/ApplicationActions&apos;</span>),</span><br><span class="line">    SomeOtherActions: <span class="built_in">require</span>(<span class="string">&apos;./actions/SomeOtherActions&apos;</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> actions = {</span><br><span class="line">    ApplicationActions: {</span><br><span class="line">        toggleMainNav: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{...},</span><br><span class="line">        load: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{...}</span><br><span class="line">    },</span><br><span class="line">    SomeOtherActions: {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="&#x8C03;&#x7528;">&#x8C03;&#x7528;</h4><p>&#x8FD9;&#x6837;&#x770B;&#x8D77;&#x6765;&#x4F18;&#x96C5;&#x591A;&#x4E86;&#x3002;&#x4E0B;&#x9762;&#x5728; View &#x5C42;&#x5C31;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5411; <code>Application.react.js</code> &#x6DFB;&#x52A0;&#x5BF9;&#x5E94;&#x7684; action&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Application = React.createClass({</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    componentDidMount: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        <span class="comment">// &#x521B;&#x5EFA;&#x65F6;&#x52A0;&#x8F7D;&#x6570;&#x636E;</span></span><br><span class="line">        <span class="keyword">this</span>.getFlux().ApplicationActions.load();</span><br><span class="line">    },</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;container&quot;</span> <span class="attribute">className</span>=<span class="value">{clazz}</span>&gt;</span></span><br><span class="line">                ...</span><br><span class="line">                <span class="tag">&lt;<span class="title">a</span> <span class="attribute">className</span>=<span class="value">&quot;mainnav-toggle&quot;</span> <span class="attribute">href</span>=<span class="value">&quot;#&quot;</span> <span class="attribute">onClick</span>=<span class="value">{this._onToggleMainNav}</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">i</span> <span class="attribute">className</span>=<span class="value">&quot;fa fa-navicon fa-lg&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">        )</span>;</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// &#x70B9;&#x51FB; toggle &#x4E8B;&#x4EF6;</span></span><br><span class="line">    _onToggleMainNav: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>{</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        <span class="keyword">this</span>.getFlux().actions.ApplicationActions.toggleMainNav();</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h3 id="stores">stores</h3><h4 id="&#x5B9A;&#x4E49;">&#x5B9A;&#x4E49;</h4><p>&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x8981;&#x8BA9; action &#x5F71;&#x54CD;&#x5230; store &#x53BB;&#x3002;&#x5728; <code>ApplicationStore.js</code> &#x4E2D;&#x5B9A;&#x4E49;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Fluxxor = <span class="built_in">require</span>(<span class="string">&apos;fluxxor&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> ApplicationConstants = <span class="built_in">require</span>(<span class="string">&apos;../constants/ApplicationConstants&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ApplicationStore = Fluxxor.createStore({</span><br><span class="line">    initialize: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">this</span>.isMenuShow = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.loading = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.error = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.list = [];</span><br><span class="line">        <span class="keyword">this</span>.isLoaded = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.bindActions(</span><br><span class="line">            ApplicationConstants.TOGGLE_MAIN_NAV, <span class="keyword">this</span>.onToggleMainNav,</span><br><span class="line">            ApplicationConstants.LOAD, <span class="keyword">this</span>.onLoad,</span><br><span class="line">            ApplicationConstants.LOAD_SUCCESS, <span class="keyword">this</span>.onLoadSuccess,</span><br><span class="line">            ApplicationConstants.LOAD_FAIL, <span class="keyword">this</span>.onLoadFail</span><br><span class="line">        );</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    _emitChange: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">this</span>.emit(<span class="string">&apos;change&apos;</span>);</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    onToggleMainNav: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">this</span>.isMenuShow = !<span class="keyword">this</span>.isMenuShow;</span><br><span class="line">        <span class="keyword">this</span>._emitChange();</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x51C6;&#x5907;&#x52A0;&#x8F7D;&#x6570;&#x636E;</span></span><br><span class="line">    onLoad: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">this</span>.loading = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">this</span>._emitChange();</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x52A0;&#x8F7D;&#x6210;&#x529F;</span></span><br><span class="line">    onLoadSuccess: <span class="function"><span class="keyword">function</span> (<span class="params">payload</span>) </span>{</span><br><span class="line">        <span class="keyword">this</span>.loading = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.isLoaded = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.error = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.list = payload.list;</span><br><span class="line">        <span class="keyword">this</span>._emitChange();</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x52A0;&#x8F7D;&#x5931;&#x8D25;</span></span><br><span class="line">    onLoadFail: <span class="function"><span class="keyword">function</span> (<span class="params">payload</span>) </span>{</span><br><span class="line">        <span class="keyword">this</span>.loading = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.error = payload.error;</span><br><span class="line">        <span class="keyword">this</span>._emitChange();</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"><span class="built_in">module</span>.exports = ApplicationStore;</span><br></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#x7684; <code>this.bindActions</code> &#x65B9;&#x6CD5;&#x628A; action &#x7ED1;&#x5B9A;&#x4E86;&#x5BF9;&#x5E94;&#x7684; handler&#x3002;</p>
<h4 id="&#x6CE8;&#x518C;">&#x6CE8;&#x518C;</h4><p>&#x7136;&#x540E;&#x6CE8;&#x518C;&#x5230; flux &#x4E2D;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ApplicationStore = <span class="built_in">require</span>(<span class="string">&apos;./stores/ApplicationStore&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> stores = {</span><br><span class="line">    ApplicationStore: <span class="keyword">new</span> ApplicationStore()</span><br><span class="line">};</span><br><span class="line"><span class="keyword">var</span> actions = {...};</span><br><span class="line"><span class="keyword">var</span> flux = <span class="keyword">new</span> Fluxxor.Flux(stores, actions);</span><br></pre></td></tr></table></figure>
<h4 id="&#x4F7F;&#x7528;">&#x4F7F;&#x7528;</h4><p>&#x5728; View &#x5C42;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x653E;&#x5230; state &#x4E2D;&#xFF1A;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> React = <span class="built_in">require</span>(<span class="string">&apos;react/addons&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> Fluxxor = <span class="built_in">require</span>(<span class="string">&apos;fluxxor&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> FluxMixin = Fluxxor.FluxMixin(React);</span><br><span class="line"><span class="keyword">var</span> StoreWatchMixin = Fluxxor.StoreWatchMixin;</span><br><span class="line"><span class="keyword">var</span> cx = React.addons.classSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ApplicationStoreName = <span class="string">&apos;ApplicationStore&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Application = React.createClass({</span><br><span class="line">    mixins: [FluxMixin, StoreWatchMixin(ApplicationStoreName)],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;</span></span><br><span class="line">    getInitialState: <span class="function"><span class="keyword">function</span> (<span class="params">argument</span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> {};</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// &#x83B7;&#x53D6; fluxxor &#x6CE8;&#x5165;&#x7684; store</span></span><br><span class="line">    getStateFromFlux: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">var</span> flux = <span class="keyword">this</span>.getFlux();</span><br><span class="line">        <span class="keyword">return</span> flux.store(ApplicationStoreName);</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// &#x6E32;&#x67D3;</span></span><br><span class="line">    render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">var</span> clazz = cx({</span><br><span class="line">            <span class="string">&apos;show-menu&apos;</span>: <span class="keyword">this</span>.state.isMenuShow</span><br><span class="line">        });</span><br><span class="line">        <span class="keyword">return</span> ...;</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[<h2 id="从_Flux_开始">从 Flux 开始</h2><p>前段时间想真正用 React 写个运营管理后台，然后就抓起 Flux 开搞，模式基本就是我之前写的<a href="http://csbun.github.io/blog/flux/react/2014/12/31/flux-learning-note.html">这篇文章</a> 那样。但问题很快就出现了，一个字“繁琐”：我要写大量的 actions 和 stores，每个 store 还要写一些相似的逻辑去 bind 对应的 actions。</p>]]>
    
    </summary>
    
      <category term="Flux" scheme="http://csbun.github.io/blog/tags/Flux/"/>
    
      <category term="Fluxxor" scheme="http://csbun.github.io/blog/tags/Fluxxor/"/>
    
      <category term="React" scheme="http://csbun.github.io/blog/tags/React/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[AngularJS with RequireJS]]></title>
    <link href="http://csbun.github.io/blog/2015/02/ng-with-requirejs/"/>
    <id>http://csbun.github.io/blog/2015/02/ng-with-requirejs/</id>
    <published>2015-02-15T10:52:39.000Z</published>
    <updated>2015-10-27T10:08:05.000Z</updated>
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;">&#x524D;&#x8A00;</h2><p>&#x867D;&#x7136; <a href="https://angularjs.org/" target="_blank" rel="external">Angular</a> &#x672C;&#x8EAB;&#x63D0;&#x4F9B; <code>module</code> &#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x662F;&#x5979;&#x4EC5;&#x4EC5;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x5168;&#x9762;&#x7684; <strong>&#x4F9D;&#x8D56;&#x7BA1;&#x7406;</strong>&#xFF0C;&#x5E76;&#x6CA1;&#x6709; <strong>&#x52A0;&#x8F7D;</strong> &#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x7B2C;&#x4E00;&#x53CD;&#x5E94;&#x5C31;&#x662F;&#x7528;&#x4E0A; <a href="http://requirejs.org/" target="_blank" rel="external">RequireJS</a>&#x3002;</p>
<a id="more"></a>
<h2 id="&#x51C6;&#x5907;">&#x51C6;&#x5907;</h2><p>&#x6211;&#x4E60;&#x60EF;&#x7528; <a href="http://bower.io/" target="_blank" rel="external">bower</a>&#xFF0C;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E9B;&#x4E1C;&#x897F;&#x5F88;&#x7B80;&#x5355;&#xFF1A;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bower <span class="operator"><span class="keyword">install</span> <span class="comment">--save requirejs</span></span><br><span class="line">bower <span class="keyword">install</span> <span class="comment">--save angular</span></span><br><span class="line">bower <span class="keyword">install</span> <span class="comment">--save angular-route</span></span></span><br></pre></td></tr></table></figure>
<h2 id="&#x76EE;&#x5F55;&#x7ED3;&#x6784;">&#x76EE;&#x5F55;&#x7ED3;&#x6784;</h2><p>&#x8FD9;&#x6B21;&#x6211;&#x7684;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x4E0D;&#x60F3;&#x6309;&#x5B98;&#x65B9; example &#x90A3;&#x6837; <code>service, resource, controller, ...</code>&#x5212;&#x5206;&#xFF0C;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x6309; module &#x5212;&#x5206;&#xFF0C;&#x7C97;&#x7565;&#x5982;&#x4E0B;</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ape</span><br><span class="line">&#x251C;&#x2500;&#x2500; index<span class="class">.html</span></span><br><span class="line">&#x2514;&#x2500;&#x2500; public</span><br><span class="line">    &#x251C;&#x2500;&#x2500; bower_components</span><br><span class="line">    &#x2502;   &#x251C;&#x2500;&#x2500; angular</span><br><span class="line">    &#x2502;   &#x251C;&#x2500;&#x2500; angular-route</span><br><span class="line">    &#x2502;   &#x2514;&#x2500;&#x2500; requirejs</span><br><span class="line">    &#x251C;&#x2500;&#x2500; dashboard</span><br><span class="line">    &#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; dashboard<span class="class">.html</span></span><br><span class="line">    &#x251C;&#x2500;&#x2500; business</span><br><span class="line">    &#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; business<span class="class">.controller</span><span class="class">.js</span></span><br><span class="line">    &#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; business<span class="class">.html</span></span><br><span class="line">    &#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; business<span class="class">.service</span><span class="class">.js</span></span><br><span class="line">    &#x251C;&#x2500;&#x2500; modules<span class="class">.js</span></span><br><span class="line">    &#x2514;&#x2500;&#x2500; routes.js</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x55EF;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x5C31;&#x53EB; ape &#x5427;&#x3002;</p>
</blockquote>
<h2 id="&#x7F16;&#x7801;">&#x7F16;&#x7801;</h2><p>&#x6363;&#x9F13;&#x7684;&#x8FC7;&#x7A0B;&#x5E76;&#x6CA1;&#x6709;&#x6211;&#x60F3;&#x8C61;&#x4E2D;&#x7B80;&#x5355;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5C31;&#x76F4;&#x63A5;&#x5199;&#x51FA;&#x6700;&#x7EC8;&#x7684;&#x7ED3;&#x679C;&#xFF1A;</p>
<h3 id="&#x5165;&#x53E3;">&#x5165;&#x53E3;</h3><p><code>index.html</code> &#x53EA;&#x52A0;&#x8F7D; <code>require.js</code>&#x3002;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE HTML&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">&quot;Content-Type&quot;</span> <span class="attribute">content</span>=<span class="value">&quot;text/html; charset=utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>ng-RequireJS<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span> <span class="attribute">ng-controller</span>=<span class="value">&quot;AppCtrl&quot;</span> <span class="attribute">class</span>=<span class="value">&quot;nifty-ready pace-done&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">h1</span>&gt;</span>{{title}}<span class="comment">&lt;!-- &#x8FD9;&#x91CC; `&#x4E24;&#x4E2A;&#x5927;&#x62EC;&#x53F7;&#x5305;&#x7740; title` &#x663E;&#x793A;&#x4E0D;&#x51FA;&#x5F00;&#xFF0C;&#x56E7; --&gt;</span><span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-view</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">&quot;public/bower_components/requirejs/require.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="built_in">require</span>.config({</span><br><span class="line">    paths: {</span><br><span class="line">        <span class="string">&apos;angular&apos;</span>: <span class="string">&apos;public/bower_components/angular/angular&apos;</span>,</span><br><span class="line">        <span class="comment">// &apos;angular-resource&apos;: &apos;lib/angular-resource&apos;,</span></span><br><span class="line">        <span class="string">&apos;angular-route&apos;</span>: <span class="string">&apos;public/bower_components/angular-route/angular-route&apos;</span>,</span><br><span class="line">        <span class="string">&apos;modules&apos;</span>: <span class="string">&apos;public/modules&apos;</span>,</span><br><span class="line">    },</span><br><span class="line">    shim: {</span><br><span class="line">        <span class="string">&apos;angular&apos;</span>: {</span><br><span class="line">            exports : <span class="string">&apos;angular&apos;</span></span><br><span class="line">        },</span><br><span class="line">        <span class="comment">// &apos;angular-resource&apos;: { deps:[&apos;angular&apos;]},</span></span><br><span class="line">        <span class="string">&apos;angular-route&apos;</span>: {</span><br><span class="line">            deps: [<span class="string">&apos;angular&apos;</span>],</span><br><span class="line">            exports: <span class="string">&apos;angular-route&apos;</span></span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line">    deps: [<span class="string">&apos;public/routes&apos;</span>]</span><br><span class="line">});</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x91CC;&#x4E0D;&#x7528; <code>&lt;html ng-app=&quot;ape&quot;&gt;</code>&#xFF0C;&#x800C;&#x662F;&#x540E;&#x9762;&#x4F7F;&#x7528; <code>angular.bootstrap</code> &#x6765;&#x542F;&#x52A8;&#x3002;&#x800C;&#x4E14;&#x5FC5;&#x987B;&#x8981;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x4E0D;&#x7136;&#x4F1A;&#x62A5;&#x627E;&#x4E0D;&#x5230; module &#x4E4B;&#x7C7B;&#x7684;&#x9519;&#x8BEF;&#x3002;</p>
<h3 id="&#x6A21;&#x5757;&#x58F0;&#x660E;">&#x6A21;&#x5757;&#x58F0;&#x660E;</h3><p>&#x6211;&#x5728; <code>modules.js</code> &#x4E2D;&#x58F0;&#x660E;&#x4E86;&#x5168;&#x90E8;&#x7684; <code>module</code>&#xFF0C;&#x65B9;&#x4FBF;&#x4F7F;&#x7528;&#x3002;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">define([</span><br><span class="line">    <span class="string">&apos;angular&apos;</span>,</span><br><span class="line">    <span class="string">&apos;angular-route&apos;</span></span><br><span class="line">], <span class="function"><span class="keyword">function</span> (<span class="params">angular</span>) </span>{</span><br><span class="line"><span class="pi">    &apos;use strict&apos;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        business: angular.module(<span class="string">&apos;business&apos;</span>, []),</span><br><span class="line">        ape: angular.module(<span class="string">&apos;ape&apos;</span>, [</span><br><span class="line">                <span class="string">&apos;ngRoute&apos;</span>,</span><br><span class="line">                <span class="string">&apos;business&apos;</span></span><br><span class="line">            ])</span><br><span class="line">    };</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h3 id="&#x8DEF;&#x7531;">&#x8DEF;&#x7531;</h3><p><code>routes.js</code> &#x662F; <code>require.config</code> &#x5B9A;&#x4E49;&#x7684;&#x5165;&#x53E3;&#x6587;&#x4EF6;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x6307;&#x5B9A;&#x8DEF;&#x7531; hash&#xFF0C;&#x5E76;&#x7528; <code>angular.bootstrap</code> </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">define([</span><br><span class="line">    <span class="string">&apos;angular&apos;</span>,</span><br><span class="line">    <span class="string">&apos;modules&apos;</span>,</span><br><span class="line">    <span class="string">&apos;public/business/business.controller&apos;</span></span><br><span class="line">], <span class="function"><span class="keyword">function</span> (<span class="params">angular, modules</span>) </span>{</span><br><span class="line"><span class="pi">    &apos;use strict&apos;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x5176;&#x5B9E;&#x8FD9;&#x91CC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; angular.module(&apos;ape&apos;).config(...)</span></span><br><span class="line">    modules.ape</span><br><span class="line">        .config([</span><br><span class="line">            <span class="string">&apos;$routeProvider&apos;</span>,</span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">$routeProvider</span>) </span>{</span><br><span class="line">                $routeProvider</span><br><span class="line">                    .when(<span class="string">&apos;/dashboard&apos;</span>, {</span><br><span class="line">                        templateUrl: <span class="string">&apos;public/dashboard/dashboard.html&apos;</span></span><br><span class="line">                    })</span><br><span class="line">                    .when(<span class="string">&apos;/business&apos;</span>, {</span><br><span class="line">                        controller: <span class="string">&apos;BusinessCtrl&apos;</span>,</span><br><span class="line">                        templateUrl: <span class="string">&apos;public/business/business.html&apos;</span></span><br><span class="line">                    })</span><br><span class="line">                    .otherwise({</span><br><span class="line">                        redirectTo: <span class="string">&apos;/dashboard&apos;</span></span><br><span class="line">                    });</span><br><span class="line">            }</span><br><span class="line">        ])</span><br><span class="line">        .controller(<span class="string">&apos;AppCtrl&apos;</span>, [</span><br><span class="line">            <span class="string">&apos;$scope&apos;</span>, </span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">$scope</span>) </span>{</span><br><span class="line">                $scope.title = <span class="string">&apos;APE&apos;</span>;</span><br><span class="line">            }</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">    angular.bootstrap(<span class="built_in">document</span>, [<span class="string">&apos;ape&apos;</span>]);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h3 id="&#x5B50;&#x6A21;&#x5757;">&#x5B50;&#x6A21;&#x5757;</h3><p>&#x5B50;&#x6A21;&#x5757;&#x57FA;&#x672C;&#x5C31;&#x662F;&#x4E1A;&#x52A1;&#x5185;&#x5BB9;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x4EE5; business &#x6A21;&#x5757;&#x4E3A;&#x4F8B;&#xFF1A;</p>
<h4 id="businessservicejs">business.service.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">define([</span><br><span class="line">    <span class="string">&apos;angular&apos;</span>,</span><br><span class="line">    <span class="string">&apos;modules&apos;</span></span><br><span class="line">], <span class="function"><span class="keyword">function</span> (<span class="params">angular, modules</span>) </span>{</span><br><span class="line"><span class="pi">    &apos;use strict&apos;</span>;</span><br><span class="line"></span><br><span class="line">    modules.business</span><br><span class="line">        .service(<span class="string">&apos;BusinessService&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">            <span class="keyword">return</span> {</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">            };</span><br><span class="line">        });</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h4 id="businesscontrollerjs">business.controller.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">define([</span><br><span class="line">    <span class="string">&apos;modules&apos;</span>,</span><br><span class="line">    <span class="string">&apos;./business.service&apos;</span></span><br><span class="line">], <span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>{</span><br><span class="line"><span class="pi">    &apos;use strict&apos;</span>;</span><br><span class="line"></span><br><span class="line">    modules.business</span><br><span class="line">        .controller(<span class="string">&apos;BusinessCtrl&apos;</span>, [</span><br><span class="line">            <span class="string">&apos;$scope&apos;</span>,</span><br><span class="line">            <span class="string">&apos;BusinessService&apos;</span>,</span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">$scope, BusinessService</span>) </span>{</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">            }</span><br><span class="line">        ]);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h2 id="&#x540E;&#x8BB0;">&#x540E;&#x8BB0;</h2><p>&#x6309; RequireJS &#x7684;&#x903B;&#x8F91;&#xFF0C;&#x5176;&#x5B9E;&#x6839;&#x636E;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x5728;&#x8FDB;&#x5165;&#x5230; <code>router.js</code> &#x65F6;&#x5C31;&#x8981;&#x628A;&#x5168;&#x90E8;&#x6587;&#x4EF6;&#x90FD;&#x52A0;&#x8F7D;&#x4E0B;&#x6765;&#xFF0C;&#x4F46;&#x8FD9;&#x6837;&#x603B;&#x6BD4;&#x628A;&#x5168;&#x90E8;&#x7684; script &#x4E00;&#x4E2A;&#x4E2A;&#x63D2;&#x5165;&#x5230; html &#x5F3A;&#xFF08;&#x5F53;&#x7136;&#x8981;&#x662F;&#x4EE3;&#x7801;&#x5408;&#x5E76;&#x7684;&#x8BDD;&#x5C31;&#x6CA1;&#x4EC0;&#x4E48;&#x597D;&#x8BB2;&#x4E86;&#xFF09;&#x3002;</p>
<p>&#x53E6;&#x5916;&#x8FD8;&#x65E0;&#x610F;&#x4E2D;&#x53D1;&#x73B0;&#x4E00;&#x4E2A; <a href="https://github.com/ocombe/ocLazyLoad" target="_blank" rel="external">ocLazyLoad</a>&#xFF0C;&#x5B9E;&#x73B0;&#x61D2;&#x52A0;&#x8F7D; Angular &#x6A21;&#x5757;&#xFF0C;&#x6709;&#x7A7A;&#x518D;&#x7814;&#x7A76;&#x4E00;&#x4E0B;&#x3002;</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="前言">前言</h2><p>虽然 <a href="https://angularjs.org/">Angular</a> 本身提供 <code>module</code> 的方法，但是她仅仅只是一个不全面的 <strong>依赖管理</strong>，并没有 <strong>加载</strong> 的功能，于是我第一反应就是用上 <a href="http://requirejs.org/">RequireJS</a>。</p>]]>
    
    </summary>
    
      <category term="Angular" scheme="http://csbun.github.io/blog/tags/Angular/"/>
    
      <category term="RequireJS" scheme="http://csbun.github.io/blog/tags/RequireJS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用 browser-perf 测试网页性能]]></title>
    <link href="http://csbun.github.io/blog/2015/02/use-browser-perf/"/>
    <id>http://csbun.github.io/blog/2015/02/use-browser-perf/</id>
    <published>2015-02-10T01:53:01.000Z</published>
    <updated>2015-10-27T10:08:09.000Z</updated>
    <content type="html"><![CDATA[<h2 id="&#x5B89;&#x88C5;&#x73AF;&#x5883;">&#x5B89;&#x88C5;&#x73AF;&#x5883;</h2><ul>
<li>npm &#x5B89;&#x88C5; <a href="https://github.com/axemclion/browser-perf" target="_blank" rel="external">browser-perf</a></li>
<li>&#x4E0B;&#x8F7D; <a href="http://www.seleniumhq.org/download/" target="_blank" rel="external">Selenium Server</a></li>
</ul>
<a id="more"></a>
<h2 id="&#x542F;&#x52A8;-selenium-server">&#x542F;&#x52A8; Selenium Server</h2><p>&#x5728;&#x4E0B;&#x8F7D;&#x5230;&#x7684; <code>selenium-server-standalone-2.x.x.jar</code> &#x6240;&#x5728;&#x76EE;&#x5F55;&#x4E0B;&#x8FD0;&#x884C;&#xFF1A;</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar selenium-server-standalone-<span class="number">2</span><span class="class">.x</span><span class="class">.x</span><span class="class">.jar</span> -role hub</span><br></pre></td></tr></table></figure>
<p>&#x6B64;&#x65F6;&#x8BBF;&#x95EE; <code>http://localhost:4444/grid/console</code> &#x5373;&#x53EF;&#x770B;&#x5230;&#x542F;&#x52A8;&#x6548;&#x679C;&#x3002;</p>
<blockquote>
<p>&#x76F8;&#x5173; <a href="https://code.google.com/p/selenium/wiki/Grid2" target="_blank" rel="external">wiki</a></p>
</blockquote>
<p>&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x6D4B;&#x8BD5;&#xFF0C;&#x5219;&#x5F97;&#x8FD0;&#x884C;&#xFF1A;</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar selenium-server-standalone-<span class="number">2</span><span class="class">.x</span><span class="class">.x</span><span class="class">.jar</span> -browser</span><br></pre></td></tr></table></figure>
<h2 id="&#x6D4B;&#x8BD5;">&#x6D4B;&#x8BD5;</h2><p>&#x5728;&#x547D;&#x4EE4;&#x884C;&#x6267;&#x884C;&#xFF1A;</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">browser-perf </span>http://yourwebsite.com --<span class="keyword">browsers=chrome,firefox </span>--<span class="keyword">selenium=localhost:4444/wd/hub</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x524D;&#x63D0;&#x662F;&#x4F60;&#x672C;&#x673A;&#x5B89;&#x88C5;&#x4E86;&#x8FD9;&#x4E9B;&#x6D4F;&#x89C8;&#x5668;</p>
</blockquote>
<p>&#x5404;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#x5F39;&#x51FA;&#x6765;&#x6253;&#x5F00; <a href="http://yourwebsite.com" target="_blank" rel="external">http://yourwebsite.com</a> &#x4E4B;&#x540E;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x4E00;&#x4E2A;&#x6027;&#x80FD;&#x62A5;&#x8868;&#xFF0C;&#x5404;&#x9879;&#x76EE;&#x8BE6;&#x89E3;&#x89C1;<a href="https://github.com/axemclion/browser-perf/wiki/Metrics" target="_blank" rel="external">&#x8FD9;&#x91CC;</a></p>
<h2 id="&#x4F7F;&#x7528;&#x7B2C;&#x4E09;&#x65B9;-webdriver">&#x4F7F;&#x7528;&#x7B2C;&#x4E09;&#x65B9; WebDriver</h2><p><a href="http://www.seleniumhq.org/" target="_blank" rel="external">Selenium Server</a> &#x7684;<a href="http://www.seleniumhq.org/download/" target="_blank" rel="external">&#x4E0B;&#x8F7D;&#x9875;</a>&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;&#x7B2C;&#x4E09;&#x65B9; WebDriver&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4E0B;&#x8F7D;&#x4E86;&#x7B2C;&#x4E09;&#x65B9;&#x7684; <a href="https://sites.google.com/a/chromium.org/chromedriver/" target="_blank" rel="external">chromedriver</a>&#xFF0C;&#x548C; <code>selenium-server-standalone-2.x.x.jar</code> &#x653E;&#x5728;&#x540C;&#x4E00;&#x76EE;&#x5F55;&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C;&#xFF1A;</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar selenium-server-standalone-<span class="number">2</span><span class="class">.x</span><span class="class">.x</span><span class="class">.jar</span> -Dwebdriver<span class="class">.chrome</span><span class="class">.driver</span>=chromedriver</span><br></pre></td></tr></table></figure>
<p>&#x540E;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x5C31;&#x4E00;&#x6837;&#x4E86;&#x3002;</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="安装环境">安装环境</h2><ul>
<li>npm 安装 <a href="https://github.com/axemclion/browser-perf">browser-perf</a></li>
<li>下载 <a href="http://www.seleniumhq.org/download/">Selenium Server</a></li>
</ul>]]>
    
    </summary>
    
      <category term="Selenium" scheme="http://csbun.github.io/blog/tags/Selenium/"/>
    
      <category term="browser-perf" scheme="http://csbun.github.io/blog/tags/browser-perf/"/>
    
      <category term="performance" scheme="http://csbun.github.io/blog/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Flux 学习笔记]]></title>
    <link href="http://csbun.github.io/blog/2014/12/flux-learning-note/"/>
    <id>http://csbun.github.io/blog/2014/12/flux-learning-note/</id>
    <published>2014-12-31T08:43:56.000Z</published>
    <updated>2015-10-27T10:08:22.000Z</updated>
    <content type="html"><![CDATA[<p>&#x5927;&#x90E8;&#x5206;&#x548C; Flux &#x6709;&#x5173;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x80FD;&#x770B;&#x5230;&#x8FD9;&#x4E48;&#x4E00;&#x4E2A;&#x56FE;&#xFF0C;&#x8BB2;&#x8FF0; Flux &#x201C;&#x5355;&#x5411;&#x6570;&#x636E;&#x6D41;&#x201D;&#x7684;&#x6982;&#x5FF5;&#x3002;</p>
<p><img src="https://github.com/facebook/flux/raw/master/docs/img/flux-diagram-white-background.png" alt="Flux" style="max-width:630px;"></p>
<a id="more"></a>
<p>&#x76F8;&#x540C;&#x7684;&#xFF0C;Geek &#x4E00;&#x70B9;&#x7684;&#x6709;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#xFF1A;</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Views -<span class="function">--&gt;</span> <span class="function"><span class="params">(actions)</span> ---&gt;</span> Dispatcher<span class="function"> --&gt;</span> <span class="function"><span class="params">(registered callback)</span> --&gt;</span> Stores -----+</span><br><span class="line">&#x245;                                                                              |</span><br><span class="line">|                                                                              V</span><br><span class="line">+- (Controller-Views <span class="string">&quot;change&quot;</span> event handlers) - (Stores emit <span class="string">&quot;change&quot;</span> events) -+</span><br></pre></td></tr></table></figure>
<p>&#x5B98;&#x7F51;&#x8BF4; Flux &#x6709; 3 &#x4E2A;&#x4E3B;&#x8981;&#x7684;&#x7EC4;&#x6210;&#x90E8;&#x5206;&#xFF1A;<strong>dispatcher</strong>&#x3001;<strong>stores</strong> &#x548C; <strong>views</strong>&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x6211;&#x89C9;&#x5F97; <strong>action</strong> &#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x6982;&#x5FF5;&#x3002;</p>
<blockquote>
<p>&#x6CE8;&#xFF1A;&#x6587;&#x4E2D;&#x4EE3;&#x7801;&#x5927;&#x90E8;&#x5206;&#x622A;&#x53D6;&#x81EA; <a href="https://github.com/facebook/flux/tree/master/examples/flux-todomvc" target="_blank" rel="external">flux-todomvc</a></p>
</blockquote>
<h3 id="views">views</h3><p><strong>view</strong> &#x5F88;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x5C31;&#x662F;&#x4E00;&#x5927;&#x5806;&#x7684; React &#x7EC4;&#x4EF6;&#xFF0C;&#x5728;&#x6807;&#x51C6;&#x4EE3;&#x7801;&#x7ED3;&#x6784;&#x4E2D;&#x8868;&#x73B0;&#x4E3A; <code>components/*.react.js</code>&#x3002;&#x5728; <strong>view</strong> &#x521B;&#x5EFA;&#x65F6;&#x4F1A;&#x5411; <strong>stores</strong> &#x7ED1;&#x5B9A; <code>&apos;change&apos;</code> &#x4E8B;&#x4EF6;&#xFF0C;&#x5F53;&#x5176;&#x5728;&#x9500;&#x6BC1;&#x4E4B;&#x524D;&#x53D6;&#x6D88;&#x7ED1;&#x5B9A;&#x3002;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> TodoApp = React.createClass({</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  componentDidMount: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    TodoStore.addChangeListener(<span class="keyword">this</span>._onChange);</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  componentWillUnmount: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    TodoStore.removeChangeListener(<span class="keyword">this</span>._onChange);</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * Event handler for &apos;change&apos; events coming from the TodoStore</span><br><span class="line">   */</span></span><br><span class="line">  _onChange: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">this</span>.setState(getTodoState());</span><br><span class="line">  }</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;<strong>view</strong> &#x4F1A;&#x4EA7;&#x751F; <strong>action</strong>&#xFF0C;&#x4F20;&#x9012;&#x7ED9; <strong>dispatcher</strong>&#x3002;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Header = React.createClass({</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * @return {object}</span><br><span class="line">   */</span></span><br><span class="line">  render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="title">header</span> <span class="attribute">id</span>=<span class="value">&quot;header&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">h1</span>&gt;</span>todos<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">TodoTextInput</span></span><br><span class="line">          <span class="attribute">id</span>=<span class="value">&quot;new-todo&quot;</span></span><br><span class="line">          <span class="attribute">placeholder</span>=<span class="value">&quot;What needs to be done?&quot;</span></span><br><span class="line">          <span class="attribute">onSave</span>=<span class="value">{this._onSave}</span></span><br><span class="line">        /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">header</span>&gt;</span></span><br><span class="line">    )</span>;</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * Event handler called within TodoTextInput.</span><br><span class="line">   * Defining this here allows TodoTextInput to be used in multiple places</span><br><span class="line">   * in different ways.</span><br><span class="line">   * @param {string} text</span><br><span class="line">   */</span></span><br><span class="line">  _onSave: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>{</span><br><span class="line">    <span class="keyword">if</span> (text.trim()){</span><br><span class="line">      TodoActions.create(text);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h3 id="dispatcher">dispatcher</h3><p><strong>dispatcher</strong> &#x4F20;&#x9012;&#x6765;&#x81EA; <strong>view</strong> &#x6216;&#x8005;&#x670D;&#x52A1;&#x5668;&#x7684; <strong>action</strong>&#xFF0C;&#x68C0;&#x67E5;&#x5176;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x6CE8;&#x518C;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF08;registered callback&#xFF09;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x5F71;&#x54CD;&#x5230; <strong>stores</strong>&#x3002;</p>
<p>&#x56E0;&#x4E3A; <strong>dispatcher</strong> &#x53EA;&#x662F;&#x673A;&#x68B0;&#x5730;&#x4F20;&#x9012;&#xFF0C;&#x800C;&#x6CE8;&#x518C;&#x52A8;&#x4F5C;&#x662F;&#x5728; <strong>stores</strong> &#x91CC;&#x9762;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x91CC;&#x9762;&#x53EA;&#x8981;&#x4E00;&#x4E2A; <code>AppDispatcher.js</code> &#x5C31;&#x591F;&#x4E86;&#xFF0C;&#x800C;&#x4E14;&#x90FD;&#x957F;&#x4E00;&#x4E2A;&#x6837;&#xFF01;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&apos;use strict&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Dispatcher = <span class="built_in">require</span>(<span class="string">&apos;flux&apos;</span>).Dispatcher;</span><br><span class="line"><span class="keyword">var</span> assign = <span class="built_in">require</span>(<span class="string">&apos;object-assign&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> AppDispatcher = assign(<span class="keyword">new</span> Dispatcher(), {</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * @param {object} action The details of the action, including the action&apos;s</span><br><span class="line">   * type and additional data coming from the server.</span><br><span class="line">   */</span></span><br><span class="line">  handleServerAction: <span class="function"><span class="keyword">function</span> (<span class="params">action</span>) </span>{</span><br><span class="line">    <span class="keyword">this</span>.dispatch({</span><br><span class="line">      source: <span class="string">&apos;SERVER_ACTION&apos;</span>,</span><br><span class="line">      action: action</span><br><span class="line">    });</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * A bridge function between the views and the dispatcher, marking the action</span><br><span class="line">   * as a view action.  Another variant here could be handleServerAction.</span><br><span class="line">   * @param  {object} action The data coming from the view.</span><br><span class="line">   */</span></span><br><span class="line">  handleViewAction: <span class="function"><span class="keyword">function</span>(<span class="params">action</span>) </span>{</span><br><span class="line">    <span class="keyword">this</span>.dispatch({</span><br><span class="line">      source: <span class="string">&apos;VIEW_ACTION&apos;</span>,</span><br><span class="line">      action: action</span><br><span class="line">    });</span><br><span class="line">  }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = AppDispatcher;</span><br></pre></td></tr></table></figure>
<h3 id="stores">stores</h3><p>&#x611F;&#x89C9;&#x548C;&#x4E00;&#x822C; MVC &#x91CC;&#x9762;&#x7684; model &#x6BD4;&#x8F83;&#x7C7B;&#x4F3C;&#xFF0C;&#x5B98;&#x7F51;&#x8BF4;&#xFF1A;</p>
<blockquote>
<p>Their role is somewhat similar to a model in a traditional MVC, but they manage the state of many objects &#x2014; they are not instances of one object.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> TodoStore = assign({}, EventEmitter.prototype, {</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  emitChange: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">this</span>.emit(CHANGE_EVENT);</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  addChangeListener: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>{</span><br><span class="line">    <span class="keyword">this</span>.on(CHANGE_EVENT, callback);</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  removeChangeListener: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>{</span><br><span class="line">    <span class="keyword">this</span>.removeListener(CHANGE_EVENT, callback);</span><br><span class="line">  }</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>&#x5728; <strong>stores</strong> &#x91CC;&#xFF0C;&#x5C06; <strong>action</strong> &#x6CE8;&#x518C;&#x5230; <strong>dispatcher</strong>&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x76F4;&#x63A5;&#x5F71;&#x54CD;&#x5176;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x6A21;&#x578B;&#xFF0C;&#x800C;&#x5F53;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x53D8;&#x5316;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x89E6;&#x53D1; <code>&apos;change&apos;</code> &#x4E8B;&#x4EF6;&#x3002;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">AppDispatcher.register(<span class="function"><span class="keyword">function</span>(<span class="params">payload</span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> action = payload.action;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span>(action.actionType) {</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&apos;ACTION_NAME&apos;</span>:</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  TodoStore.emitChange();</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// No errors.  Needed by promise in Dispatcher.</span></span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h3 id="action">action</h3><p>&#x6211;&#x60F3;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x8BB2;&#x6E05;&#x695A;&#x4E86;&#xFF0C;<strong>view</strong> &#x6216;&#x8005;&#x670D;&#x52A1;&#x5668;&#x4EA7;&#x751F; <strong>action</strong>&#xFF0C;&#x4F20;&#x9012;&#x7ED9; <strong>dispatcher</strong>&#x3002;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> TodoActions = {</span><br><span class="line"></span><br><span class="line">  create: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>{</span><br><span class="line">    AppDispatcher.handleViewAction({</span><br><span class="line">      actionType: <span class="string">&apos;ACTION_NAME&apos;</span>,</span><br><span class="line">      text: text</span><br><span class="line">    });</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">};</span><br></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[<p>大部分和 Flux 有关的东西都能看到这么一个图，讲述 Flux “单向数据流”的概念。</p>
<p><img src="https://github.com/facebook/flux/raw/master/docs/img/flux-diagram-white-background.png" alt="Flux" style="max-width:630px;"></p>]]>
    
    </summary>
    
      <category term="Flux" scheme="http://csbun.github.io/blog/tags/Flux/"/>
    
      <category term="React" scheme="http://csbun.github.io/blog/tags/React/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[利用 sendBeacon 发送统计信息]]></title>
    <link href="http://csbun.github.io/blog/2014/12/send-beacon/"/>
    <id>http://csbun.github.io/blog/2014/12/send-beacon/</id>
    <published>2014-12-10T09:37:53.000Z</published>
    <updated>2015-10-27T10:08:25.000Z</updated>
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;">&#x524D;&#x8A00;</h2><p>&#x4ECA;&#x5929;&#x770B;&#x5230;&#x8FD9;&#x6837;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x300A;<a href="http://updates.html5rocks.com/2014/10/Send-beacon-data-in-Chrome-39" target="_blank" rel="external">Send beacon data in Chrome 39</a>&#x300B;</p>
<p>&#x5927;&#x81F4;&#x662F;&#x8BF4; <code>navigator.sendBeacon</code> &#x53EF;&#x4EE5;&#x7528;&#x6765;&#x53D1;&#x9001;&#x4E00;&#x4E9B;&#x5C0F;&#x91CF;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7279;&#x522B;&#x9002;&#x5408;&#x7EDF;&#x8BA1;&#x573A;&#x666F;&#xFF0C;&#x4E14;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x662F;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x4E0D;&#x53D7;&#x6D4F;&#x89C8;&#x5668;&#x884C;&#x4E3A;&#x9650;&#x5236;&#xFF1A;&#x5373;&#x4F7F;&#x6D4F;&#x89C8;&#x5668;&#x5173;&#x95ED;&#x8BF7;&#x6C42;&#x4E5F;&#x80FD;&#x7167;&#x6837;&#x53D1;&#x51FA;&#x3002;</p>
<a id="more"></a>
<h2 id="&#x7528;&#x6CD5;">&#x7528;&#x6CD5;</h2><p>&#x5B98;&#x7F51;&#x5B9A;&#x4E49;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">partial <span class="class"><span class="keyword">interface</span> <span class="title">Navigator</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">sendBeacon</span><span class="params">(DOMString url, optional (ArrayBufferView or Blob or DOMString or FormData)</span>? data </span>= <span class="keyword">null</span>);</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>&#x4F7F;&#x7528;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = <span class="keyword">new</span> FormData();</span><br><span class="line">navigator.sendBeacon(<span class="string">&apos;path/to/beacon&apos;</span>, data);</span><br></pre></td></tr></table></figure>
<p>&#x5C31;&#x662F;&#x8FD9;&#x6837;&#xFF0C;&#x4F1A;&#x53D1;&#x51FA;&#x4E00;&#x4E2A; <code>POST</code> &#x8BF7;&#x6C42;&#x3002;</p>
<h2 id="&#x6D4B;&#x8BD5;">&#x6D4B;&#x8BD5;</h2><p>&#x4E8E;&#x662F;&#x6211;&#x505A;&#x4E86;&#x4E2A;&#x6D4B;&#x8BD5;&#xFF0C;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#xFF1A;</p>
<ul>
<li>&#x6D4F;&#x89C8;&#x5668;&#xFF1A;Chrome&#xFF0C;&#x7248;&#x672C; 41.0.2244.0 canary (64-bit)</li>
<li>&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x5668;&#xFF1A;koa&#xFF0C;v0.11.0</li>
</ul>
<h3 id="&#x524D;&#x7AEF;">&#x524D;&#x7AEF;</h3><p>&#x524D;&#x7AEF;&#x8BBE;&#x7F6E;&#x4E86;&#x4EE5;&#x4E0B;&#x4E09;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;</p>
<h4 id="get">get</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&apos;unload&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    $.get(<span class="string">&apos;/log/get&apos;</span>, { type: <span class="string">&apos;get&apos;</span> }, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>{</span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">    });</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h4 id="post">post</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&apos;unload&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    $.post(<span class="string">&apos;/log/post&apos;</span>, { type: <span class="string">&apos;post&apos;</span> }, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>{</span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">    });</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h4 id="sendbeacon">sendBeacon</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&apos;unload&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> data = <span class="keyword">new</span> FormData();</span><br><span class="line">    data.append(<span class="string">&apos;type&apos;</span>, <span class="string">&apos;beacon&apos;</span>);</span><br><span class="line">    navigator.sendBeacon(<span class="string">&apos;/log/beacon&apos;</span>, data);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h3 id="&#x540E;&#x7AEF;">&#x540E;&#x7AEF;</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> koa = <span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>),</span><br><span class="line">    route = <span class="built_in">require</span>(<span class="string">&apos;koa-route&apos;</span>),</span><br><span class="line">    koaBody = <span class="built_in">require</span>(<span class="string">&apos;koa-body&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = koa();</span><br><span class="line">app.use(koaBody());</span><br><span class="line"></span><br><span class="line"><span class="comment">// log</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> * (<span class="params">next</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">yield</span> next;</span><br><span class="line">    <span class="keyword">var</span> ms = <span class="keyword">new</span> <span class="built_in">Date</span>() - start;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&apos;[&apos;</span> + <span class="keyword">this</span>.method + <span class="string">&apos;]&apos;</span> + ms + <span class="string">&apos;ms: &apos;</span> + <span class="keyword">this</span>.url);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x5EF6;&#x8FDF;&#x8F93;&#x51FA;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">output</span> (<span class="params">cb</span>) </span>{</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">        cb(<span class="literal">null</span>, <span class="built_in">JSON</span>.stringify({</span><br><span class="line">            success: <span class="literal">true</span></span><br><span class="line">        }));</span><br><span class="line">    }, <span class="number">1000</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x6A21;&#x62DF; sendBeacon</span></span><br><span class="line">app.use(route.post(<span class="string">&apos;/log/beacon&apos;</span>, <span class="function"><span class="keyword">function</span> * (<span class="params"></span>) </span>{</span><br><span class="line">    logger(<span class="string">&apos;beacon: &apos;</span> + <span class="keyword">this</span>.request.body);</span><br><span class="line">    <span class="keyword">this</span>.body = <span class="keyword">yield</span> output;</span><br><span class="line">}));</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x6A21;&#x62DF; post</span></span><br><span class="line">app.use(route.post(<span class="string">&apos;/log/post&apos;</span>, <span class="function"><span class="keyword">function</span> * (<span class="params"></span>) </span>{</span><br><span class="line">    logger(<span class="string">&apos;post: &apos;</span> + <span class="keyword">this</span>.request.body);</span><br><span class="line">    <span class="keyword">this</span>.body = <span class="keyword">yield</span> output;</span><br><span class="line">}));</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x6A21;&#x62DF; get</span></span><br><span class="line">app.use(route.get(<span class="string">&apos;/log/get&apos;</span>, <span class="function"><span class="keyword">function</span> * (<span class="params"></span>) </span>{</span><br><span class="line">    logger(<span class="string">&apos;get: &apos;</span> + <span class="keyword">this</span>.request.body);</span><br><span class="line">    <span class="keyword">this</span>.body = <span class="keyword">yield</span> output;</span><br><span class="line">}));</span><br></pre></td></tr></table></figure>
<h3 id="&#x7528;&#x4F8B;">&#x7528;&#x4F8B;</h3><ul>
<li>&#x70B9;&#x51FB;&#x9875;&#x9762;&#x4E2D;&#x7684;&#x94FE;&#x63A5;&#xFF08;&#x5916;&#x94FE;&#xFF09;</li>
<li>&#x5237;&#x65B0;&#x9875;&#x9762;</li>
<li>&#x5173;&#x95ED;&#x9875;&#x9762;&#xFF08;CTRL + w&#xFF09;</li>
<li>&#x5173;&#x95ED;&#x6D4F;&#x89C8;&#x5668;&#xFF08;CTRL + q&#xFF09;</li>
</ul>
<h3 id="&#x7ED3;&#x679C;">&#x7ED3;&#x679C;</h3><ul>
<li>get: &#x65E0;&#x7EDF;&#x8BA1;&#x65E5;&#x5FD7;</li>
<li>post: &#x65E0;&#x7EDF;&#x8BA1;&#x65E5;&#x5FD7;</li>
<li>beacon: 4&#x79CD;&#x60C5;&#x51B5;&#x90FD;&#x6709;&#x7EDF;&#x8BA1;&#x65E5;&#x5FD7;</li>
</ul>
<p>&#x867D;&#x7136;&#x5728; beacon &#x4E2D;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x7EDF;&#x8BA1;&#x65E5;&#x5FD7;&#xFF0C;&#x4F46; body &#x4E2D;&#x6CA1;&#x6709;&#x83B7;&#x5F97;&#x4FE1;&#x606F;&#x3002;&#x5728; Inspector &#x4E2D;&#x770B;&#x5230;&#x8BF7;&#x6C42;&#x7684;&#x4FE1;&#x606F;&#x662F;&#x5728; <code>Request Payload</code> &#x4E2D;&#xFF0C;&#x6709;&#x5F85;&#x8003;&#x5BDF;&#x3002;</p>
<h2 id="&#x5947;&#x602A;&#x73B0;&#x8C61;">&#x5947;&#x602A;&#x73B0;&#x8C61;</h2><p>&#x5C06;&#x4E0A;&#x8FF0;&#x524D;&#x7AEF;&#x4EE3;&#x7801;&#x6539;&#x6210;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&apos;unload&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    $.get(<span class="string">&apos;/log/get&apos;</span>, { type: <span class="string">&apos;get&apos;</span> }, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>{</span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">    });</span><br><span class="line">    $.post(<span class="string">&apos;/log/post&apos;</span>, { type: <span class="string">&apos;post&apos;</span> }, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>{</span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">    });</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>&#x90A3;&#x4E48;&#x540E;&#x7AEF;&#x901A;&#x5E38;&#x80FD;&#x83B7;&#x5F97;&#x7B2C;&#x4E00;&#x4E2A; <code>get</code> &#x7684;&#x8BF7;&#x6C42;&#x3002;&#x5047;&#x5982;&#x5148;&#x5199; <code>$.post</code> &#x5219;&#x540C;&#x6837;&#x4F1A;&#x6709; <code>post</code> &#x8BF7;&#x6C42;&#x3002;</p>
<h3 id="zepto-&#x7684;&#x95EE;&#x9898;">zepto &#x7684;&#x95EE;&#x9898;&#xFF1F;</h3><p>&#x4E8E;&#x662F;&#x6211;&#x81EA;&#x5DF1;&#x5199;&#x4E00;&#x4E2A; XMLHttpRequest&#xFF0C;&#x8FD9;&#x4E2A;&#x73B0;&#x8C61;&#x5C31;&#x6D88;&#x5931;&#x4E86;&#x3002;&#x6709;&#x5F85;&#x8003;&#x5BDF;&#x3002;</p>
<h2 id="&#x540E;&#x8BB0;">&#x540E;&#x8BB0;</h2><p>&#x636E;&#x8BF4;&#x53EA;&#x6709; Chrome 37 &#x4EE5;&#x4E0A;&#x53EF;&#x4EE5;&#x7528;&#xFF0C;&#x6211;&#x8BD5;&#x4E86;&#x4E00;&#x4E0B; UC&#x6D4F;&#x89C8;&#x5668; &#x4E0D;&#x884C;&#xFF0C;&#x5475;&#x5475;&#x3002;</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="前言">前言</h2><p>今天看到这样一篇文章《<a href="http://updates.html5rocks.com/2014/10/Send-beacon-data-in-Chrome-39">Send beacon data in Chrome 39</a>》</p>
<p>大致是说 <code>navigator.sendBeacon</code> 可以用来发送一些小量的数据，特别适合统计场景，且这个请求是异步的，不受浏览器行为限制：即使浏览器关闭请求也能照样发出。</p>]]>
    
    </summary>
    
      <category term="async" scheme="http://csbun.github.io/blog/tags/async/"/>
    
      <category term="log" scheme="http://csbun.github.io/blog/tags/log/"/>
    
  </entry>
  
</feed>
